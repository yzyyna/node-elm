webpackJsonp([36],{Mn87:function(e,t){},cxxR:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s("Dd8w"),r=s.n(o),n=s("Xxa5"),i=s.n(n),a=s("exGp"),l=s.n(a),c=s("prnJ"),d=s("Ayik"),u={name:"GensetProgressRecordsDialog",props:{recordParmas:{type:Object,default:null},RecordId:{type:Number,default:null},OperateType:{type:Number,default:null}},components:{RecordFormDialog:c.a},watch:{recordParmas:{handler:function(e,t){console.log("recordParmas",e),this.projectStatus=e.projectStatus,this.ProjectId=e.ProjectId,this.ProjectProgressId=e.ProjectProgressId,this.IsGensetMult=e.IsGensetMult},deep:!0,immediate:!0}},data:function(){return{loading:!1,dialigVisible:!0,title:"第一步：关联机组",projectStatus:null,ProjectId:null,ProjectProgressId:null,IsGensetMult:null,columns:d.a.GensetRalatedColumns(this),options:{index:!0,labelIndex:"序号",selection:!0,props:{width:80}},gensetTableData:[],selectList:[],RecordFormDialogVisible:!1}},computed:{selectText:function(){return this.selectList.map(function(e){return e.CollectorToken}).join(" 、 ")},GensetList:function(){return this.selectList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}})}},mounted:function(){console.log(this.recordParmas),1==this.OperateType?this.title="第一步：关联机组":this.title="关联机组",this.queryTableData()},methods:{querySelectList:function(){var e=this;return l()(i.a.mark(function t(){var s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s={RecordId:e.RecordId},t.next=3,e.$api.project.GetGensetProjectProgressRecordDetail({},s).then(function(e){if(1===e.Code){var t=e.Data;return t.GensetList?t.GensetList.map(function(e){return r()({},e.GeneratorSet)}):[]}});case 3:o=t.sent,e.$set(e,"selectList",o);case 5:case"end":return t.stop()}},t,e)}))()},queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectJoinGensetByAll(t).then(function(t){1===t.Code&&(e.gensetTableData=t.Data.map(function(e){return r()({ID:e.ProjectJoinGensetId,IsParallel:e.IsParallel},e.GeneratorSet)}),2==e.OperateType&&e.querySelectList()),e.loading=!1}).catch(function(){e.loading=!1})},handleBatchRelated:function(e){var t=this,s={id:this.RecordId},o={GensetList:this.GensetList};this.$api.project.EditGensetProjectProgressRecordGenset(o,s).then(function(e){1===e.Code&&(t.$message.success(e.Message),t.$emit("closeDialog",{refresh:!0}))})},handleSelectionChange:function(e){this.selectList=e},nextStep:function(){0!=this.selectList.length?this.selectList.length>1&&"false"==this.IsGensetMult?this.$message.warning("请选择一台机组！"):this.RecordFormDialogVisible=!0:this.$message.warning("请选择机组！")},close:function(){this.$emit("closeDialog")},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.$emit("closeDialog",{refresh:!0})}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{staticClass:"progress-records-dialog",attrs:{title:e.title,width:"60%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[s("div",{staticClass:"dialog-content"},[s("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"genset-list-table",attrs:{options:e.options,columns:e.columns,dataSource:e.gensetTableData,defaultSelectData:e.selectList,border:""},on:{handleSelectionChange:e.handleSelectionChange}})],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("p",{staticClass:"select-text SingleLineHiding"},[s("em",[e._v("当前已选择：")]),e._v(" "),s("span",{attrs:{title:e.selectText}},[e._v(e._s(e.selectText))])]),e._v(" "),s("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),1==e.OperateType?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]):e._e(),e._v(" "),2==e.OperateType&&3!==e.projectStatus?s("el-button",{attrs:{type:"primary",disabled:!(this.selectList&&this.selectList.length>0)},on:{click:function(t){return e.handleBatchRelated()}}},[e._v("保存")]):e._e()],1)]),e._v(" "),e.RecordFormDialogVisible?s("RecordFormDialog",{attrs:{recordParmas:e.recordParmas,RecordId:e.RecordId,OperateType:e.OperateType,GensetList:e.selectList},on:{closeDialog:function(t){return e.closeDialog("RecordFormDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var p=s("VU/8")(u,g,!1,function(e){s("jgFS")},"data-v-3983b970",null).exports,h=s("oCG/"),f={name:"ProjectProgressRecords",props:{recordParmas:{type:Object,default:null}},components:{GensetRelatedDialog:p,RecordFormDialog:c.a,GensetProgressRecordsDialog:h.a},data:function(){return{loading:!1,loading_1:!1,dialigVisible:!0,projectStatus:null,ProjectId:null,ProjectProgressId:null,IsGenset:null,IsGensetMult:null,GensetId:null,columns:d.a.projectProgressRecordsColumns(this),gensetRecord:d.a.progressRecordsColumns(this),options:{index:!0,labelIndex:"序号",props:{width:240}},dataSource:[],data:[],GensetRelatedDialogVisible:!1,RecordFormDialogVisible:!1,OperateType:null,RecordId:null,RecordsDialogVisible:!1}},watch:{recordParmas:{handler:function(e,t){console.log("recordParmas",e),this.projectStatus=e.projectStatus,this.ProjectId=e.ProjectId,this.ProjectProgressId=e.ProjectProgressId,this.IsGenset=e.IsGenset,this.IsGensetMult=e.IsGensetMult},deep:!0,immediate:!0}},mounted:function(){this.queryTableData()},methods:{queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId,ProgressId:this.ProjectProgressId};this.$api.project.GetGensetProjectProgressRecord(t).then(function(t){1===t.Code&&(console.log(t),e.$set(e,"dataSource",t.Data)),e.loading=!1}).catch(function(){e.loading=!1})},queryGensetTableData:function(){var e=this;this.loading_1=!0;var t={ProjectId:this.ProjectId,ProgressId:this.ProjectProgressId};this.$api.project.GetGensetProjectProgressGensetByAll(t).then(function(t){if(1===t.Code){console.log(t);var s=t.Data.map(function(e){return r()({IsParallel:e.IsParallel,ProgressName:e.ProgressName,ProjectJoinGensetId:e.ProjectJoinGensetId,RecordCount:e.RecordCount,Type:e.Type},e.GeneratorSet)});e.$set(e,"data",s)}e.loading_1=!1})},close:function(){this.$emit("closeDialog")},addProgressRecord:function(){this.RecordId=null,this.OperateType=1,1==this.IsGenset?this.GensetRelatedDialogVisible=!0:this.RecordFormDialogVisible=!0},showProgressRecord:function(e){this.RecordId=e.RecordId,this.OperateType=2,this.RecordFormDialogVisible=!0},deleteProgressRecord:function(e){var t=this,s=this.$createElement;this.$confirm("操作提示",{title:"删除记录",message:s("div",[s("p",[s("span","确定删除当前记录吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s={id:e.RecordId};t.$api.project.DeleteGensetProjectProgressRecord(s).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除记录成功!"}),t.queryTableData()):t.$message({type:"error",message:"删除记录失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleDownloadClick:function(e){console.log(e)},relatedGenset:function(e){this.RecordId=e.RecordId,this.OperateType=2,this.GensetRelatedDialogVisible=!0},showGensetProgressRecord:function(e){console.log(e),this.GensetId=e.GeneratorSetId,this.RecordsDialogVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleBackClick:function(){this.$router.push({path:"/project/project-detail",query:{active:4}})}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"project-progress-records"},[s("p",{staticClass:"content-title"},[e._v("\n      项目工程进度记录\n      "),s("el-button",{staticClass:"comColor",attrs:{type:"primary",disabled:3===e.projectStatus},on:{click:function(t){return e.addProgressRecord()}}},[e._v("添 加")])],1),e._v(" "),s("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"record-list-table",attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,border:""}},[s("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"operate-group"},[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showProgressRecord(t.row)}}},[e._v(" 查看 ")]),e._v(" "),s("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(s){return e.deleteProgressRecord(t.row)}}},[e._v("\n              删除\n            ")]),e._v(" "),1==e.IsGenset?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.relatedGenset(t.row)}}},[e._v("\n              关联机组\n            ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1),e._v(" "),e.GensetRelatedDialogVisible?s("GensetRelatedDialog",{attrs:{recordParmas:e.recordParmas,ProjectProgressId:e.ProjectProgressId,RecordId:e.RecordId,OperateType:e.OperateType},on:{closeDialog:function(t){return e.closeDialog("GensetRelatedDialogVisible",t)}}}):e._e(),e._v(" "),e.RecordFormDialogVisible?s("RecordFormDialog",{attrs:{recordParmas:e.recordParmas,RecordId:e.RecordId,OperateType:e.OperateType},on:{closeDialog:function(t){return e.closeDialog("RecordFormDialogVisible",t)}}}):e._e(),e._v(" "),e.RecordsDialogVisible?s("GensetProgressRecordsDialog",{attrs:{ProjectProgressId:e.ProjectProgressId,GensetId:e.GensetId},on:{closeDialog:function(t){return e.closeDialog("RecordsDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var P=s("VU/8")(f,m,!1,function(e){s("Mn87")},"data-v-792d8dea",null);t.default=P.exports},jgFS:function(e,t){}});
//# sourceMappingURL=36.8fe1c21c8f8fe9be052e.js.map