{"version":3,"sources":["webpack:///src/views/equipment/crew-monitor/crew-location/index.vue","webpack:///./src/views/equipment/crew-monitor/crew-location/index.vue?fb1a","webpack:///./src/views/equipment/crew-monitor/crew-location/index.vue"],"names":["crew_location","name","components","ToggleCrew","data","id","fenceFlag","dialogVisible","fenceRadius","fenceCenterPoint","beginDate","this","$moment","add","format","endTime","dataObj","bMap","fenceMap","centerPoint","infoWindow","loading","loadingMsg","backBtnShow","isOpen","computed","extends_default","Object","vuex_esm","watch","newVal","oldVal","_this","renderFenceMap","$confirm","then","value","commitHandler","catch","result","selectCrew","renderBMap","methods","_this2","loadBMap","e","$api","project","GetGensetFenceSetting","ID","res","Data","BMap","map","Size","Map","enableMapClick","GensetMap","Point","_ref","Genset","Longitude","Latitude","x","y","marker","Marker","opts","width","height","title","DisplayName","offset","InfoWindow","InstallationSite","addEventListener","_","openInfoWindow","addOverlay","enableScrollWheelZoom","centerAndZoom","IsOpen","center","Range","circle","Circle","strokeColor","strokeWeight","strokeOpacity","fillOpacity","fillColor","err","_this3","undefined","gensetMap","point","circleOpt","fixedMarker","clickEvent","params","newPoint","clearOverlays","setOverlayEditing","target","getRadius","toFixed","getCenter","disableDoubleClickZoom","disableMassClear","setAnimation","BMAP_ANIMATION_BOUNCE","alert","$message","setTimeout","flag","lng","lat","query","console","info","handleClose","_this4","closeHandler","overlay","enableEditing","queryByTime","diff","message","type","backHandler","closeInfoWindow","panTo","mounted","crew_monitor_crew_location","render","_vm","_h","$createElement","_c","_self","_v","attrs","staticClass","align","span","justify","push","active-text","inactive-text","model","callback","$$v","expression","directives","rawName","icon","on","click","element-loading-text","element-loading-background","visible","before-close","destroy-on-close","update:visible","$event","_s","slot","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/46.d3788eb08481b525f389.js","sourcesContent":["<!--\r\n * @Author Demon3443002624@qq.com\r\n * @Date 2021-12-10 10:19:29\r\n * @Description 设备-机组监控-机组定位（机组定位、机组轨迹、机组防盗三合一）===>更改为机组防盗\r\n * @LastEditors: linxu\r\n * @LastEditTime: 2022-06-01 14:27:20\r\n * @Version 2022-5-5 11:29:00 接口调试\r\n-->\r\n<template>\r\n  <div>\r\n    <BMainTopComponent />\r\n    <el-container>\r\n      <el-main>\r\n        <div :id=\"id\">\r\n          <!-- <toggle-crew></toggle-crew> -->\r\n          <el-row type=\"flex\" align=\"middle\" class=\"time-fixed-box\">\r\n            <el-col :span=\"20\" class=\"no-warp\">\r\n              <el-row type=\"flex\" align=\"middle\" justify=\"start\" class=\"fence-fixed-box\">\r\n                <el-col :span=\"10\" :push=\"2\">电子围栏：</el-col>\r\n                <el-col :span=\"12\" :push=\"0\">\r\n                  <el-switch v-model=\"fenceFlag\" active-text=\"开启\" inactive-text=\"关闭\">\r\n                  </el-switch>\r\n                </el-col>\r\n              </el-row>\r\n            </el-col>\r\n            <el-col :span=\"4\"></el-col>\r\n          </el-row>\r\n          <el-button\r\n            @click=\"backHandler\"\r\n            title=\"返回机组当前位置\"\r\n            class=\"back-to-center\"\r\n            v-show=\"backBtnShow\"\r\n            icon=\"el-icon-refresh-left\"\r\n          ></el-button>\r\n          <div\r\n            :id=\"id + '-map-box'\"\r\n            v-loading=\"loading\"\r\n            :element-loading-text=\"loadingMsg\"\r\n            element-loading-background=\"rgba(0, 0, 0, 0.6)\"\r\n          ></div>\r\n          <el-dialog\r\n            title=\"设置电子围栏\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"70%\"\r\n            :before-close=\"handleClose\"\r\n            :destroy-on-close=\"true\"\r\n            :center=\"true\"\r\n          >\r\n            <h3 class=\"current-radius\">当前半径:{{ fenceRadius }}米</h3>\r\n            <div :id=\"id + '-fence-box'\"></div>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n              <el-button\r\n                @click=\"\r\n                  dialogVisible = false\r\n                  closeHandler()\r\n                \"\r\n                >取 消</el-button\r\n              >\r\n              <el-button type=\"primary\" @click=\"commitHandler\">确 定</el-button>\r\n            </span>\r\n          </el-dialog>\r\n        </div>\r\n      </el-main>\r\n      <toggle-crew></toggle-crew>\r\n    </el-container>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\n\r\n// import _data from './data'\r\nimport loadBMap from '@/utils/loadBMap'\r\nimport { formatTime } from '@/utils/common.js'\r\nimport ToggleCrew from '@/components/toggleCrew/list'\r\n\r\nexport default {\r\n  name: 'crew-location',\r\n  components: {\r\n    ToggleCrew\r\n  },\r\n  data() {\r\n    return {\r\n      id: `crew-location`,\r\n      fenceFlag: false,\r\n      dialogVisible: false,\r\n      // 电子围栏的半径,默认500米\r\n      fenceRadius: 500,\r\n      // 电子围栏的中心点，默认当前位置\r\n      fenceCenterPoint: null,\r\n      beginDate: this.$moment().add(-3, 'days').format(`YYYY-MM-DD`),\r\n      endTime: this.$moment().format(`YYYY-MM-DD HH:mm`),\r\n      dataObj: null,\r\n      bMap: null,\r\n      fenceMap: null,\r\n      centerPoint: null,\r\n      infoWindow: null,\r\n      loading: false,\r\n      loadingMsg: '地图加载中，请您稍候...',\r\n      backBtnShow: false,\r\n      // 电子围栏是否打开\r\n      isOpen: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['selectCrew'])\r\n  },\r\n  watch: {\r\n    fenceFlag(newVal, oldVal) {\r\n      if (newVal && this.isOpen == false) {\r\n        this.dialogVisible = true\r\n        this.renderFenceMap()\r\n      }\r\n      if (!newVal && this.isOpen == true) {\r\n        this.$confirm('是否确定关闭电子围栏？')\r\n          .then((value) => {\r\n            this.commitHandler(false)\r\n          })\r\n          .catch((result) => {\r\n            this.fenceFlag = true\r\n          })\r\n      }\r\n    },\r\n    selectCrew(newVal, oldVal) {\r\n      this.renderBMap()\r\n    }\r\n  },\r\n  methods: {\r\n    // 渲染机组轨迹地图\r\n    renderBMap() {\r\n      this.loadingMsg = '地图加载中，请您稍候...'\r\n      this.loading = true\r\n      loadBMap().then((e) => {\r\n        this.$api.project\r\n          .GetGensetFenceSetting({\r\n            // id: 7297\r\n            id: this.selectCrew.ID\r\n          })\r\n          .then((res) => {\r\n            this.loading = false\r\n            // res = _data.track\r\n            this.dataObj = !!res & !!res.Data && res.Data\r\n            const BMap = e\r\n            // Size\r\n            // 此处百度地图设置的 size 必须和 icon 图标的大小一致，百度地图只是绘制了一个 size 大小的容器，然后将图标原封不动得放进去而已\r\n            const size = new BMap.Size(48, 48)\r\n            const map = new BMap.Map(`${this.id}-map-box`, {\r\n              enableMapClick: false\r\n            })\r\n            const dataObj = this.dataObj\r\n            dataObj.GensetMap = {}\r\n            let centerPoint = new BMap.Point(103, 31)\r\n            if (dataObj) {\r\n              const [x, y] = [dataObj.Genset.Longitude, dataObj.Genset.Latitude]\r\n              dataObj.GensetMap = {\r\n                Longitude: dataObj.Genset.Longitude,\r\n                Latitude: dataObj.Genset.Latitude\r\n              }\r\n              // 当前定位\r\n              centerPoint = new BMap.Point(x, y)\r\n              this.centerPoint = centerPoint\r\n              const marker = new BMap.Marker(centerPoint)\r\n              const opts = {\r\n                width: 300,\r\n                height: 100,\r\n                title: `<div style='font-size:1.2rem;font-weight:600'>${dataObj.Genset.DisplayName}</div>`,\r\n                offset: new BMap.Size(0, -10)\r\n              }\r\n              const infoWindow = new BMap.InfoWindow(\r\n                `<el-card class=\"box-card\">\r\n                    <div  class=\"text item\">\r\n                        经度：${x}\r\n                    </div>\r\n                    <div  class=\"text item\">\r\n                        纬度：${y}\r\n                    </div>\r\n                    <div  class=\"text item\">\r\n                        ${dataObj.Genset.InstallationSite}\r\n                    </div>\r\n                  </el-card>\r\n                  `,\r\n                opts\r\n              )\r\n              this.infoWindow = infoWindow\r\n              marker.addEventListener(`click`, (_) => {\r\n                map.openInfoWindow(infoWindow, centerPoint)\r\n              })\r\n              map.openInfoWindow(infoWindow, centerPoint)\r\n              map.addOverlay(marker)\r\n              map.enableScrollWheelZoom()\r\n              map.centerAndZoom(centerPoint, 16)\r\n              // 获取电子围栏信息\r\n              if (dataObj.IsOpen) {\r\n                const center = new BMap.Point(dataObj.Longitude, dataObj.Latitude)\r\n\r\n                this.fenceFlag = true\r\n                this.isOpen = true\r\n                this.fenceRadius = dataObj.Range\r\n                // 存在围栏信息，画圈\r\n                const circle = new BMap.Circle(center, this.fenceRadius, {\r\n                  strokeColor: 'red',\r\n                  strokeWeight: 2,\r\n                  strokeOpacity: 0.5,\r\n                  fillOpacity: 0.1,\r\n                  fillColor: 'tomato'\r\n                })\r\n                map.addOverlay(circle)\r\n              }\r\n            } else {\r\n              map.centerAndZoom(centerPoint, 5)\r\n            }\r\n          })\r\n          .catch((err) => {})\r\n      })\r\n    },\r\n    // 渲染电子围栏地图\r\n    renderFenceMap() {\r\n      if (!this.dataObj.GensetMap.Longitude) {\r\n        this.$message('未获取到该机组位置信息！')\r\n        this.dialogVisible = false\r\n        setTimeout((_) => {\r\n          this.fenceFlag = false\r\n        }, 300)\r\n      } else\r\n      /* global BMAP_ANIMATION_BOUNCE */\r\n        loadBMap(`o7gALXwtch6SNk9jjH4DmFffcFt1PhFL`)\r\n          .then((e) => {\r\n            const BMap = e || undefined\r\n            const map = new BMap.Map('crew-location-fence-box', {\r\n              enableMapClick: false\r\n            })\r\n            const gensetMap = this.dataObj.GensetMap\r\n            const point = new BMap.Point(gensetMap.Longitude, gensetMap.Latitude)\r\n            this.fenceCenterPoint = point\r\n            const circleOpt = {\r\n              opt: {\r\n                strokeColor: 'red',\r\n                strokeWeight: 2,\r\n                strokeOpacity: 0.5,\r\n                fillOpacity: 0.1,\r\n                fillColor: 'tomato'\r\n              }\r\n            }\r\n            const fixedMarker = new BMap.Marker(point, {\r\n              offset: new BMap.Size(0, 5)\r\n            })\r\n            const clickEvent = (params) => {\r\n              const newPoint = params.point\r\n              const circle = new BMap.Circle(newPoint, this.fenceRadius, circleOpt.opt)\r\n              map.clearOverlays()\r\n              map.addOverlay(circle)\r\n              this.setOverlayEditing(circle)\r\n              circle.addEventListener(`lineupdate`, (e) => {\r\n                this.fenceRadius = e.target.getRadius().toFixed(0)\r\n                this.fenceCenterPoint = e.target.getCenter()\r\n              })\r\n            }\r\n            map.disableDoubleClickZoom()\r\n            map.enableScrollWheelZoom()\r\n            map.centerAndZoom(point, 15)\r\n            clickEvent({ point })\r\n            map.addEventListener(`click`, clickEvent)\r\n            // 固定当前机组的位置，禁止被清除\r\n            fixedMarker.disableMassClear()\r\n            fixedMarker.setAnimation(BMAP_ANIMATION_BOUNCE)\r\n            map.addOverlay(fixedMarker)\r\n            // document.querySelector(`.crew-location-fence-box`).append(html)\r\n            this.fenceMap = map\r\n          })\r\n          .catch((err) => {\r\n            alert(err)\r\n          })\r\n    },\r\n    // 提交围栏数据\r\n    commitHandler(flag) {\r\n      // 关闭窗口，显示遮罩\r\n      this.dialogVisible = false\r\n      this.loadingMsg = `数据提交中，请您稍候...`\r\n      this.loading = true\r\n\r\n      let params = {\r\n        IsOpen: false\r\n      }\r\n      if (flag) {\r\n        params = {\r\n          IsOpen: true,\r\n          Range: this.fenceRadius,\r\n          Longitude: this.fenceCenterPoint.lng,\r\n          Latitude: this.fenceCenterPoint.lat\r\n        }\r\n      }\r\n      const query = { id: this.selectCrew.ID || 0 }\r\n      console.info('%c提交参数', 'color:red;background:yellow;font-size:1.1rem', { params, query }),\r\n        // 返回成功后需进行的操作\r\n        (this.loading = false),\r\n        (this.isOpen = false)\r\n      // TODO 暂未开启设置电子围栏\r\n      // this.$api.project\r\n      //   .GensetFenceSetting(params, query)\r\n      //   .then((res) => {\r\n      //     this.$message.success(res.Message)\r\n      //     this.closeHandler()\r\n      //   })\r\n      //   .catch((error) => {\r\n      //     this.$message.error(error)\r\n      //     this.closeHandler()\r\n      //   })\r\n    },\r\n    // 机组围栏弹窗关闭事件\r\n    handleClose(e) {\r\n      this.$confirm('确认关闭？')\r\n        .then((_) => {\r\n          this.closeHandler()\r\n          e()\r\n        })\r\n        .catch((_) => {})\r\n    },\r\n    closeHandler() {\r\n      // 重置地图\r\n      this.loading = false\r\n      this.fenceMap = null\r\n      this.fenceFlag = false\r\n      this.fenceRadius = 500\r\n    },\r\n    // 设置地图覆盖物可编辑\r\n    setOverlayEditing(overlay) {\r\n      setTimeout(() => {\r\n        overlay.enableEditing()\r\n      }, 0)\r\n    },\r\n    // 根据时间条件重载地图\r\n    queryByTime() {\r\n      // 验证时间有效性\r\n      const flag = this.$moment(this.endTime).diff(this.$moment(this.beginDate), 'seconds')\r\n      if (flag > 0) {\r\n        this.renderBMap()\r\n      } else {\r\n        this.$message({\r\n          message: '开始日期必须在结束时间之前！请检查。',\r\n          type: 'warning'\r\n        })\r\n      }\r\n    },\r\n    // 返回当前位置\r\n    backHandler() {\r\n      // 有动画的移动\r\n      this.bMap.closeInfoWindow()\r\n      this.bMap.panTo(this.centerPoint)\r\n      this.bMap.openInfoWindow(this.infoWindow, this.centerPoint)\r\n      this.backBtnShow = false\r\n    }\r\n  },\r\n  mounted() {\r\n    this.renderBMap()\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n#crew-location {\r\n  display: undefined;\r\n  // 百分比占比盒子\r\n  .box100percent {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  // 强制盒子子元素不换行，若不生效，需尝试子元素添加 display:inline; 属性\r\n  .no-warp {\r\n    white-space: nowrap;\r\n  }\r\n  // 搜索按钮\r\n  .search-btn {\r\n    height: 32px;\r\n    // width: 60px;\r\n    display: inline-block;\r\n    line-height: 1;\r\n    white-space: nowrap;\r\n    cursor: pointer;\r\n    // background: #fff;\r\n    // border: 1px solid #dcdfe6;\r\n    // color: #606266;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n    outline: 0;\r\n    margin: 0;\r\n    transition: 0.1s;\r\n    font-weight: 500;\r\n    font-size: 14px;\r\n    border-radius: 4px;\r\n    // &:hover {\r\n    //   background-color: #ecf5ff;\r\n    //   color: #409eff;\r\n    // }\r\n  }\r\n  .box100percent();\r\n  // position: absolute;\r\n  &-map-box {\r\n    .box100percent();\r\n  }\r\n  // 电子围栏开关盒子\r\n  .fence-fixed-box {\r\n    // position: absolute;\r\n    width: 260px;\r\n    height: 32px;\r\n    background-color: transparent;\r\n    border: 1px solid #80808066;\r\n    border-radius: 4px;\r\n    display: inline-flex;\r\n    // top: 208px;\r\n    // left: 40px;\r\n  }\r\n  // 时间筛选\r\n  .time-fixed-box {\r\n    width: 100%;\r\n    // margin: -24px 0 0 0px;\r\n    padding: 0 0 10px 15px;\r\n  }\r\n  // 电子围栏地图\r\n  &-fence-box {\r\n    height: 500px;\r\n  }\r\n  // 返回当前机组定位按钮\r\n  .back-to-center {\r\n    width: 80px;\r\n    position: absolute;\r\n    right: 20px;\r\n    top: 240px;\r\n    z-index: 2;\r\n    background: transparent;\r\n    border: 0;\r\n    font-size: 2.3rem;\r\n  }\r\n  .current-radius {\r\n    position: absolute;\r\n    color: #ff0000;\r\n    z-index: 2;\r\n    top: 3px;\r\n    left: 5px;\r\n  }\r\n  /** 对组件样式的复写 */\r\n  // 去除 dialog 的padding\r\n  /deep/ .el-dialog__body {\r\n    padding: 0;\r\n  }\r\n  // 去除底部的百度地图版权信息\r\n  /deep/ .BMap_cpyCtrl {\r\n    display: none;\r\n  }\r\n  /deep/ .anchorBL {\r\n    display: none;\r\n  }\r\n  /deep/ .BMap_vectex_node {\r\n    cursor: all-scroll;\r\n    background: #ff0000;\r\n    border-radius: 2px;\r\n  }\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/equipment/crew-monitor/crew-location/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('BMainTopComponent'),_vm._v(\" \"),_c('el-container',[_c('el-main',[_c('div',{attrs:{\"id\":_vm.id}},[_c('el-row',{staticClass:\"time-fixed-box\",attrs:{\"type\":\"flex\",\"align\":\"middle\"}},[_c('el-col',{staticClass:\"no-warp\",attrs:{\"span\":20}},[_c('el-row',{staticClass:\"fence-fixed-box\",attrs:{\"type\":\"flex\",\"align\":\"middle\",\"justify\":\"start\"}},[_c('el-col',{attrs:{\"span\":10,\"push\":2}},[_vm._v(\"电子围栏：\")]),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12,\"push\":0}},[_c('el-switch',{attrs:{\"active-text\":\"开启\",\"inactive-text\":\"关闭\"},model:{value:(_vm.fenceFlag),callback:function ($$v) {_vm.fenceFlag=$$v},expression:\"fenceFlag\"}})],1)],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":4}})],1),_vm._v(\" \"),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.backBtnShow),expression:\"backBtnShow\"}],staticClass:\"back-to-center\",attrs:{\"title\":\"返回机组当前位置\",\"icon\":\"el-icon-refresh-left\"},on:{\"click\":_vm.backHandler}}),_vm._v(\" \"),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"id\":_vm.id + '-map-box',\"element-loading-text\":_vm.loadingMsg,\"element-loading-background\":\"rgba(0, 0, 0, 0.6)\"}}),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":\"设置电子围栏\",\"visible\":_vm.dialogVisible,\"width\":\"70%\",\"before-close\":_vm.handleClose,\"destroy-on-close\":true,\"center\":true},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('h3',{staticClass:\"current-radius\"},[_vm._v(\"当前半径:\"+_vm._s(_vm.fenceRadius)+\"米\")]),_vm._v(\" \"),_c('div',{attrs:{\"id\":_vm.id + '-fence-box'}}),_vm._v(\" \"),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogVisible = false\n                _vm.closeHandler()}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.commitHandler}},[_vm._v(\"确 定\")])],1)])],1)]),_vm._v(\" \"),_c('toggle-crew')],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-745ba394\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/equipment/crew-monitor/crew-location/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-745ba394\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-745ba394\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-745ba394\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/equipment/crew-monitor/crew-location/index.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}