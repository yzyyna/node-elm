webpackJsonp([40],{"9yHF":function(e,t){},FkJj:function(e,t,a){"use strict";var i=[{value:0,label:"项目建议"},{value:1,label:"投诉"},{value:2,label:"其他"}],l=[{value:1,label:"待处理"},{value:2,label:"待确认"},{value:3,label:"已关闭"}];t.a={WorkOrderTypeEnum:i,WorkOrderStatusEnum:l,userFeedbackColumns:function(e){return[{label:"工单分类",prop:"Sort",minWidth:"15%",formatter:function(e,t,a){return i.find(function(t){return t.value==e.Sort}).label}},{label:"问题标题",prop:"FeedbackTitle",minWidth:"25%"},{label:"反馈人",prop:"CreateUserName",minWidth:"15%"},{label:"提交时间",prop:"CreateTime",minWidth:"20%",formatter:function(t,a,i){return t.CreateTime?e.$moment(t.CreateTime).format("yyyy-MM-DD HH:mm:ss"):""}},{label:"工单状态",prop:"Status",minWidth:"15%",formatter:function(e,t,a){return e.Status?l.find(function(t){return t.value==e.Status}).label:""}}]}}},"d+1b":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("//Fk"),l=a.n(i),r=a("Dd8w"),n=a.n(r),s=a("FkJj"),c=a("X2Oc"),d=s.a.WorkOrderTypeEnum,o=s.a.WorkOrderStatusEnum,p={name:"userFeedbackDetail",data:function(){return{feedbackId:parseInt(this.$route.query.feedbackId),feedBackInfo:this.$route.query.feedBackInfo,WorkOrderTypeList:d.map(function(e){return e.label}),WorkOrderStatusList:o.map(function(e){return e.label}),feedbackDetail:{},reply:"",replyType:"text",replyFiles:[],feedbackThisHead:"",dialogImageUrl:"",dialogVisiblePic:!1,disabled:!1,picLimit:3,picSizeLimit:5242880}},mounted:function(){this.checkDetail()},methods:{checkDetail:function(){var e=this;this.feedbackThisHead=this.feedBackInfo.CreateUserHeadImgUrl,this.$api.monitoringScreenOperation.GetGensetProjectFeedback({},{id:this.feedbackId}).then(function(t){var a=!!t&&!!t.Data&&t.Data;if(a){var i=n()({},a),l=[];i.ReplyList&&i.ReplyList.forEach(function(t){t.FileUrl&&!t.ReplyDetail&&l.push(e.handlePicUrl(t.FileUrl))}),i.FileUrlArray&&(i.FileUrlArray=i.FileUrlArray.map(function(t){return e.handlePicUrl(t)})),i.replyPicList=l,i.CreateTime&&(i.CreateTime=Object(c.c)(i.CreateTime).format("yyyy-MM-DD HH:mm:ss")),e.$set(e,"feedbackDetail",i)}else e.mes()}).catch(function(t){e.mes(),console.error("ERROR in monitoringScreenOperation get feedback detail data =>",t)})},handlePicUrl:function(e){return"http://www.fortrustyun.com:8022/"+e},handlePicUrlOld:function(e){return"http://www.fortrustyun.com:8022/"+e},sendFeedbackReply:function(){var e=this,t=this.$message,a=(!!this.$refs.refUploadPics&&this.$refs.refUploadPics||{uploadFiles:[]}).uploadFiles;"text"!=this.replyType||this.reply?"text"==this.replyType||0!==a.length?this.$confirm("确认发送？").then(function(){var i=e.$loading({lock:!0,text:"数据提交中，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=new FormData;r.append("FeedbackId",e.feedbackId),r.append("ReplyDetail",e.reply),r.append("FileUrl",""),r.append("Remark","");var n=[];a.length>0?a.forEach(function(t,a){var i=new FormData;i.append("FeedbackId",e.feedbackId),i.append("ReplyDetail",e.reply),i.append("FileUrl",t.raw),i.append("Remark",""),n.push(e.sendFeedbackReplyFunc(i))}):n.push(e.sendFeedbackReplyFunc(r)),l.a.all(n).then(function(l){t({message:"发送成功！",type:"success"}),i.close(),e.reply="",a.length=0,e.checkDetail()})}).catch(function(e){}):t({message:"至少上传一张图片！",type:"error"}):t({message:"请输入回复信息！",type:"error"})},sendFeedbackReplyFunc:function(e){var t=this;return new l.a(function(a,i){t.$api.monitoringScreenOperation.AddGGensetProjectFeedbackReply(e).then(function(e){1===e.Code?a("success"):i(e)})})},formatTime:function(e){return Object(c.c)(e)},handleRemove:function(e){var t=e.uid,a=this.$refs.refUploadPics.uploadFiles;try{a.forEach(function(e,i){e.uid===t&&a.splice(i,1)})}catch(e){this.$message({type:"error",message:"删除失败！"}),console.error(e)}},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisiblePic=!0},handleDownload:function(e){},handleExceed:function(){this.$message("仅限上传"+this.picLimit+"张图片！")},onChangePic:function(e,t){if(!(e.size/1024<=5120))return t.splice(t.indexOf(e),1),this.$message.warning("上传文件大小不能超过 5MB!"),!1},handleBackClick:function(){this.$router.push({path:"/operation/feedback"})}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BMainTopComponent",{attrs:{isShowBackBtn:!0,isHandleBackClick:!0},on:{handleBackClick:e.handleBackClick}}),e._v(" "),a("div",{staticClass:"user-feedback-detail"},[a("p",{staticClass:"content-title"},[e._v("工单详情")]),e._v(" "),a("el-row",{class:["feedback-detail-container",3===e.feedBackInfo.Status?"feedback-detail-container__show":""]},[a("el-row",{staticClass:"feedback-detail-container-info"},[a("div",{staticClass:"feedback-detail-container-info-title"},[a("div",[e._v(e._s(e.WorkOrderTypeList[e.feedbackDetail.Sort]))]),e._v(" "),a("div",{staticClass:"feedback-detail-title"},[e._v("  "+e._s(e.feedbackDetail.FeedbackTitle))]),e._v(" "),a("p",{staticClass:"feedback-detail-status"},[e._v("\n            工单状态： "),a("span",[e._v(e._s(e.WorkOrderStatusList[e.feedbackDetail.Sort]))])])]),e._v(" "),a("div",{staticClass:"feedback-detail-container-info-info"},[a("el-avatar",{attrs:{src:e.handlePicUrlOld(e.feedbackThisHead),size:20}}),e._v("  \n          "+e._s(e.feedbackDetail.CreateUserName)+" "+e._s(e.feedbackDetail.CreateUserCompanyName)+"\n          "+e._s(e.feedbackDetail.CreateUserPhone)+"\n          "),a("span",{staticClass:"time"},[e._v(e._s(e.feedbackDetail.CreateTime))])],1),e._v(" "),a("div",{staticClass:"feedback-detail-container-info-content"},[e._v("\n          "+e._s(e.feedbackDetail.FeedbackDetail)+"\n        ")]),e._v(" "),e.feedbackDetail.FileUrlArray&&e.feedbackDetail.FileUrlArray.length>0?a("div",{staticClass:"feedback-detail-container-info-pics"},e._l(e.feedbackDetail.FileUrlArray,function(t,i){return a("el-image",{key:i,attrs:{src:t,fit:"contain","preview-src-list":e.feedbackDetail.FileUrlArray}})}),1):e._e(),e._v(" "),a("el-divider"),e._v(" "),a("div",{staticClass:"feedback-detail-container-info-project"},[a("span",[e._v("工单号："+e._s(e.feedbackId))]),e._v(" "),a("span",[e._v("联系电话："+e._s(e.feedbackDetail.CreateUserPhone))]),e._v(" "),a("span",[e._v("所属企业："+e._s(e.feedbackDetail.CreateUserCompanyName))])]),e._v(" "),a("el-divider")],1),e._v(" "),a("el-row",{staticClass:"feedback-detail-container-reply"},e._l(e.feedbackDetail.ReplyList,function(t,i){return a("div",{key:i,staticClass:"feedback-detail-container-reply-item"},[a("div",[a("el-avatar",{key:t.FeedbackReplyId,attrs:{src:e.handlePicUrlOld(t.CreateUserHeadImgUrl),size:30}})],1),e._v(" "),a("div",[a("div",[e._v("\n              "+e._s(t.CreateUserName)+"\n              "),a("span",{staticClass:"time"},[e._v("\n                "+e._s(e.formatTime(t.CreateTime).format("yyyy-MM-DD HH:mm:ss"))+"\n              ")])]),e._v(" "),a("div",{staticClass:"reply-content"},[t.ReplyDetail?a("el-input",{attrs:{resize:"none",readonly:"",width:"100%",type:"textarea",value:t.ReplyDetail}}):a("el-image",{attrs:{src:e.handlePicUrl(t.FileUrl),"preview-src-list":e.feedbackDetail.replyPicList,fit:"contain"}})],1)])])}),0),e._v(" "),a("el-divider"),e._v(" "),3!==e.feedBackInfo.Status?a("el-row",{staticClass:"feedback-detail-container-text",attrs:{type:"flex"}},[a("el-col",{attrs:{span:21}},["text"==e.replyType?a("el-input",{attrs:{type:"textarea",placeholder:"字数不超过100个字符",maxlength:100,rows:"4"},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}}):a("el-upload",{ref:"refUploadPics",attrs:{accept:".jpg, .jpeg, .png",action:"#","list-type":"picture-card","auto-upload":!1,limit:e.picLimit,"on-exceed":e.handleExceed,multiple:!0,"on-change":e.onChangePic},scopedSlots:e._u([{key:"file",fn:function(t){var i=t.file;return a("div",{},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:i.url,alt:""}}),e._v(" "),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){return e.handlePictureCardPreview(i)}}},[a("i",{staticClass:"el-icon-zoom-in"})]),e._v(" "),e.disabled?e._e():a("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(i)}}},[a("i",{staticClass:"el-icon-delete"})])])])}}],null,!1,3790609042)},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),e._v(" "),a("el-dialog",{attrs:{"modal-append-to-body":!1,visible:e.dialogVisiblePic},on:{"update:visible":function(t){e.dialogVisiblePic=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),a("el-col",{staticClass:"type-btns",attrs:{span:2,push:1}},[a("el-radio",{attrs:{label:"text"},model:{value:e.replyType,callback:function(t){e.replyType=t},expression:"replyType"}},[e._v("文本")]),e._v(" "),a("el-radio",{attrs:{label:"pic"},model:{value:e.replyType,callback:function(t){e.replyType=t},expression:"replyType"}},[e._v("图片")])],1)],1):e._e()],1),e._v(" "),3!==e.feedBackInfo.Status?a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:e.handleBackClick}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.sendFeedbackReply}},[e._v("发 送")])],1):e._e()],1)],1)},staticRenderFns:[]};var f=a("VU/8")(p,u,!1,function(e){a("9yHF")},"data-v-42ec170f",null);t.default=f.exports}});
//# sourceMappingURL=40.c430340fc222721fa710.js.map