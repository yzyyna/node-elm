webpackJsonp([4,36,48],{"+9gy":function(e,t){},"1QME":function(e,t){},"5XzJ":function(e,t){},"9uFn":function(e,t){},ARIM:function(e,t,a){"use strict";var s=a("Dd8w"),n=a.n(s),o=a("/eJN"),i={name:"OpenProjectDialog",props:{projectInfo:{type:Object,default:{}}},watch:{projectInfo:{handler:function(e,t){console.log("projectInfo",e,t),this.project=e},deep:!0}},computed:{allNum:function(){return this.gensetTableData.length},selectNum:function(){return this.gensetTableData.filter(function(e){return 1==e.checked}).length}},data:function(){return{ProjectTypeEnum:o.a.ProjectTypeEnum,ProjectStatusEnum:o.a.ProjectStatusEnum,loading:!1,dialigVisible:!0,project:this.projectInfo,gensetTableData:[]}},mounted:function(){this.queryGensetData()},methods:{queryGensetData:function(){var e=this,t={ProjectId:this.project.ProjectId};this.$api.project.GetGensetProjectJoinGensetManageExpand(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.gensetTableData=t.Data.Data.map(function(e){return n()({ID:e.ProjectJoinGensetId,IsParallel:e.IsParallel,IsFenceOpen:e.IsFenceOpen,IsStrategy:e.IsStrategy},e.GeneratorSet,{checked:!1})}),console.log(e.gensetTableData))})},submitForm:function(){this.$emit("handleOpenConfirm",{projectId:this.project.ProjectId,status:2})},close:function(){this.$emit("closeDialog")}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"open-project-dialog",attrs:{title:"开启项目",width:"70%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"project-baseinfo"},[a("p",[a("span",[e._v("项目名称：")]),e._v(" "),a("span",[e._v(e._s(e.project.ProjectName))])]),e._v(" "),a("p",[a("span",[e._v("项目编号：")]),e._v(" "),a("span",[e._v(e._s(e.project.ProjectNumber))])]),e._v(" "),a("p",[a("span",[e._v("项目状态：")]),e._v(" "),a("span",[e._v(e._s(e.ProjectStatusEnum.find(function(t){return t.value==e.project.Status}).label))])]),e._v(" "),a("p",[a("span",[e._v("项目创建时间：")]),e._v(" "),a("span",[e._v(e._s(e.$moment(e.project.CreateTime).format("yyyy-MM-DD HH:mm:ss")))])])]),e._v(" "),e.gensetTableData&&e.gensetTableData.length>0?a("p",{staticClass:"clear-tip"},[e._v("\n      提示：请先选择需要重置累计数据的机组，提交确认开启项目后将同时执行数据重置\n    ")]):e._e(),e._v(" "),a("div",{staticClass:"genset-list-container"},e._l(e.gensetTableData,function(t){return a("div",{key:t.GeneratorSetId,staticClass:"genset-item-container",class:{"genset-checked":t.checked}},[a("div",{staticClass:"genset-box genset-info"},[a("el-checkbox",{staticClass:"checkbox",model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"gensetItem.checked"}},[e._v("确认重置")]),e._v(" "),a("p",[a("span",[e._v("机组名称："+e._s(t.DisplayName))])]),e._v(" "),a("p",[a("span",[e._v("机组编号："+e._s(t.CollectorToken))])])],1),e._v(" "),a("div",{staticClass:"genset-box genset-data"},[a("p",[e._v("期初底座油箱油量：300L")]),e._v(" "),a("p",[e._v("期末底座油箱油量：30L")]),e._v(" "),a("p",[e._v("加油次数：3")]),e._v(" "),a("p",[e._v("机组燃油用量：470L")]),e._v(" "),a("p",[e._v("机组平均油耗：33.33g/Kwh")]),e._v(" "),a("p",[e._v("机组平均运行时间：480 h 35 min")]),e._v(" "),a("p",[e._v("机组发电量：2345.55Kwh")]),e._v(" "),a("p",[e._v("机组无故障时间：2000 h 35 min")]),e._v(" "),a("p",[e._v("机组超功率运行时间：72 h 35 min")])])])}),0)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.gensetTableData&&e.gensetTableData.length>0?a("p",{staticClass:"tip"},[a("span",[e._v("已选择"+e._s(e.selectNum)+"台，")]),e._v(" "),a("span",[e._v("共"+e._s(e.allNum)+"台")])]):e._e(),e._v(" "),a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确认开启项目")])],1)])},staticRenderFns:[]};var l=a("VU/8")(i,r,!1,function(e){a("pzGC")},"data-v-b37923c2",null);t.a=l.exports},BeAg:function(e,t){},EThk:function(e,t){},"G5/o":function(e,t,a){a("uqUo")("getOwnPropertyNames",function(){return a("Rrel").f})},GP0A:function(e,t){},"H+o5":function(e,t){},"I/CR":function(e,t){},LYfj:function(e,t){},Mn87:function(e,t){},PoLq:function(e,t){},"Qv3+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("aFK5"),n=a.n(s),o=a("Dd8w"),i=a.n(o),r=a("NYxO"),l=a("Gu7T"),c=a.n(l),u=a("X2Oc"),d=[{value:1,label:"准备中"},{value:2,label:"进行中"},{value:3,label:"已完成"}],p=[{value:1,label:"运维"},{value:2,label:"代运维"}],f={name:"ProjectInfo",inject:["reload"],props:{hasBackBtn:{type:Boolean,default:null}},data:function(){return{basicInfo:null,alertShowFlag:!0,warningDatas:{}}},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e,t){var a=i()({},e,{ProjectType:e.ProjectType&&p.find(function(t){return t.value==e.ProjectType}).label,Status:e.Status&&d.find(function(t){return t.value==e.Status}).label,CreateTime:this.$moment(e.CreateTime).format("yyyy-MM-DD HH:mm:ss")});this.$set(this,"basicInfo",a),this.getMchInfo()},deep:!0,immediate:!0}},mounted:function(){var e=this;this.animation=setInterval(function(){e.getMchInfo()},3e4)},methods:i()({},Object(r.b)(["toggleSelectCrew"]),{handleClickLinkTo:function(e,t){var a=this;this.$api.operation.FindGeneratorSet({id:e}).then(function(t){var s=t.Data;a.toggleSelectCrew(s),window.open("/#/operation/operationalChart/operationalChartDaily?type=newPage&crewId="+e+"&projectId="+a.currentProject.ProjectId)})},getMchInfo:function(){var e=this;this.$api.project.getGensetProjectJoinGensetNowData({ProjectId:this.currentProject.ProjectId||3}).then(function(t){var a=t.Data;if(a){var s=a.GensetAlarmList;if(s){var n=s||[];0===n.length?e.alertShowFlag=!1:e.alertShowFlag=!0;var o=[],i=[];n.forEach(function(e,t){var a={order:t,time:Object(u.d)(e.Time).format("yyyy-MM-DD HH:mm:ss"),mchname:e.GensetName,divisionmch:"测试分机组",warningcontent:e.Content,warningtype:e.Type,operation:"查看",GeneratorSetId:e.GeneratorSetId};o.push(a)}),[].forEach(function(e,t){var a={order:t,unit:e.GensetName,plandate:Object(u.d)(e.Time).format("YYYY-MM-DD"),type:e.Type,operation:"查看",keepContent:e.Content};i.push(a)}),e.warningDatas={d1:[].concat(c()(o.map(function(e){return{msg:"实时报警："+e.mchname+"-"+e.warningcontent,id:e.GeneratorSetId}}))),d2:[].concat(c()(i.map(function(e){return"保养提醒："+e.unit+e.keepContent})))}}}})},handleRefresh:function(){this.reload()},handleBackClick:function(){this.$router.go(-1)}}),beforeDestroy:function(){clearInterval(this.animation)}},m={render:function(){var e=this,t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"project-info"},[n("el-row",{attrs:{type:"flex"}},[n("el-col",{staticClass:"project-info-items project-info-basic",attrs:{span:18}},[n("span",{staticClass:"project-info-item project-name"},[t._v("\n        "+t._s(t.basicInfo&&t.basicInfo.ProjectName))]),t._v(" "),n("el-tag",{staticClass:"project-info-item project-tag"},[t._v("\n        "+t._s(t.basicInfo&&t.basicInfo.ProjectType)+"\n      ")]),t._v(" "),n("el-tag",{staticClass:"project-info-item project-tag"},[t._v("\n        "+t._s(t.basicInfo&&t.basicInfo.Status)+"\n      ")]),t._v(" "),n("el-tag",{staticClass:"project-info-item project-tag time"},[t._v("\n        "+t._s(t.basicInfo&&(t.basicInfo.EndDateLast?t.basicInfo.EndDateLast+" 天后到期":"已到期"))+"\n      ")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.alertShowFlag,expression:"alertShowFlag"}],staticClass:"alert-container"},[n("el-carousel",{ref:"carousel",attrs:{height:"30px",interval:3e3,direction:"vertical","indicator-position":"none"}},[t._l(t.warningDatas.d1,function(e,s){return n("el-carousel-item",{key:"warningKey"+s},[n("el-row",{attrs:{align:"middle",justify:"start",type:"flex"}},[n("img",{staticClass:"img-warning",attrs:{src:a("x2cw")}}),t._v(" "),n("span",[t._v(t._s(e.msg))])]),t._v(" "),n("el-button",{staticStyle:{position:"absolute",right:"5px"},attrs:{type:"text",title:"点击跳转日运维图"},on:{click:function(a){return t.handleClickLinkTo(e.id,e)}}},[t._v("故障诊断")])],1)}),t._v(" "),t._l(t.warningDatas.d2,function(e,s){return n("el-carousel-item",{key:"warningKeys"+s},[n("el-row",{attrs:{align:"middle",justify:"start",type:"flex"}},[n("img",{staticClass:"img-warning",attrs:{src:a("pheV")}}),t._v(" "),n("span",[t._v(t._s(e))]),t._v(" "),n("el-button",{attrs:{type:"text",title:"点击跳转日运维图"}},[t._v("故障诊断")])],1)],1)})],2)],1)],1),t._v(" "),n("el-col",{staticClass:"project-info-items operate-btns",attrs:{span:6}},[n("i",{staticClass:"project-info-item el-icon-refresh",attrs:{title:"点击刷新页面"},on:{click:function(){return e.$emit("handleRefresh")}}}),t._v(" "),n("i",{directives:[{name:"show",rawName:"v-show",value:t.hasBackBtn,expression:"hasBackBtn"}],staticClass:"project-info-item back-btn el-icon-arrow-left",attrs:{title:"返回"},on:{click:function(e){return t.handleBackClick()}}},[n("span",[t._v("返回")])])])],1),t._v(" "),n("el-row",{attrs:{type:"flex"}},[n("el-col",{staticClass:"project-info-items project-info-more"},[n("span",[t._v("项目机组功率（Kw）："+t._s(t.basicInfo&&t.basicInfo.TotalPower))]),t._v(" "),n("span",[t._v("项目机组数量（台）："+t._s(t.basicInfo&&t.basicInfo.Quantity))]),t._v(" "),n("span",[t._v("项目创建时间："+t._s(t.basicInfo&&t.basicInfo.CreateTime))]),t._v(" "),n("span",[t._v("项目地址："+t._s(t.basicInfo&&t.basicInfo.ProjectAddress))])])],1)],1)},staticRenderFns:[]};var v=a("VU/8")(f,m,!1,function(e){a("nAqi")},"data-v-678fa127",null).exports,g=a("Xxa5"),h=a.n(g),b=a("exGp"),y=a.n(b),C=a("/eJN"),I=C.a.ProjectStatusEnum,P=C.a.ProjectTypeEnum,j={name:"BasicInfoList",props:{projectBasicInfo:{type:Object,default:function(){}}},data:function(){return{basicInfo:{}}},watch:{projectBasicInfo:{handler:function(e,t){var a=i()({},e,{ProjectType:e.ProjectType&&P.find(function(t){return t.value==e.ProjectType}).label,Status:e.Status&&I.find(function(t){return t.value==e.Status}).label,contractTime:e.StartDate&&e.EndDate?this.$moment(e.StartDate).format("YYYY.MM.DD")+" - "+this.$moment(e.EndDate).format("YYYY.MM.DD"):"",CreateTime:this.$moment(e.CreateTime).format("yyyy-MM-DD HH:mm:ss")});this.$set(this,"basicInfo",a)},deep:!0}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-content basic-info"},[a("el-row",[a("el-col",{attrs:{span:8}},[a("span",[e._v("项目名称:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.ProjectName)+" ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("项目编号:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.ProjectNumber)+" ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("项目类型:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.ProjectType)+" ")])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("span",[e._v("项目地址:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.ProjectAddress)+" ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("项目起止时间:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.contractTime)+" ")])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("span",[e._v("功率需求:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.TotalPower)+" Kw")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("租赁台数:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.Quantity)+" 台")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("项目租金:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.TotalMoney)+" 元")])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("span",[e._v("创建时间:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.CreateTime)+" ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",[e._v("合同状态:")]),e._v(" "),a("span",[e._v(" "+e._s(e.basicInfo.Status)+" ")])])],1)],1)},staticRenderFns:[]};var w=a("VU/8")(j,D,!1,function(e){a("eu7e")},"data-v-410de0f9",null).exports,S=a("oVaw"),T=a("ARIM"),x=C.a.ProjectFileTypeEnum,G={name:"FileUploadDialog",props:{projectId:{type:Number,default:null}},data:function(){return{dialigVisible:!0,formLabelWidth:"100px",form:{FileType:"",FileName:"",fileList:[],FileDetail:""},rules:{FileType:[{required:!0,message:"文件类型",trigger:"change"}],fileList:[{required:!0,message:"请选择文件",trigger:"change"}],FileName:[{type:"string",required:!0,message:"请输入文件名称",trigger:"blur"},{max:15,message:"长度不超过 15 个字符",trigger:"blur"}]},limit:3,ProjectFileTypeEnum:x}},mounted:function(){},methods:{exceedLimit:function(e,t){console.log(e,t),this.$message.error("上传文件个数不能超过"+this.limit+"个")},getValChange:function(e,t){console.log("getValChange",e.type,t,this.limit);var a=e.raw.type,s=["image/jpeg","image/png","image/bmp","image/gif","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/pdf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/msword","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint"].includes(a),n=e.size/1024<=10240;return s?n?void this.$set(this.form,"fileList",t):(t.splice(t.indexOf(e),1),this.$message.warning("上传文件大小不能超过 10MB!"),!1):(t.splice(t.indexOf(e),1),this.$message.warning("上传文件格式有误!"),!1)},handleRemove:function(e,t){console.log(e,t),this.$set(this.form,"fileList",t)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;console.log(t.form);var a=new FormData;t.form.fileList.forEach(function(e){a.append("file",e.raw)}),a.append("ProjectId",t.projectId),a.append("FileType",t.form.FileType),a.append("FileName",t.form.FileName),a.append("FileDetail",t.form.FileDetail),t.$api.project.AddGensetProjectFile(a).then(function(e){1===e.Code?t.$message({type:"success",message:"文件上传成功!"}):t.$message({type:"error",message:"文件上传失败，请重新提交!"}),t.$emit("closeDialog",{refresh:!0})})})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},close:function(){this.$emit("closeDialog")}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"upload-file-dialog",attrs:{title:"上传合同文件",width:"52%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"文件类型",prop:"FileType"}},[a("el-select",{attrs:{placeholder:"请选择文件类型"},model:{value:e.form.FileType,callback:function(t){e.$set(e.form,"FileType",t)},expression:"form.FileType"}},e._l(e.ProjectFileTypeEnum,function(e,t){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"文件上传",prop:"fileList"}},[a("el-upload",{ref:"upload",staticClass:"upload-file",attrs:{action:"#","file-list":e.form.fileList,"auto-upload":!1,"on-change":e.getValChange,"on-exceed":e.exceedLimit,"on-remove":e.handleRemove,limit:e.limit,multiple:""}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n          (支持不超过10M的.doc、docx、xls、xlsx、pdf、rar、zip、jpg、jpge、png文件；最多上传10个文件)\n        ")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"文件名称",prop:"FileName"}},[a("el-input",{attrs:{placeholder:"请输入文件名称",autocomplete:"off"},model:{value:e.form.FileName,callback:function(t){e.$set(e.form,"FileName",t)},expression:"form.FileName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"FileDetail"}},[a("el-input",{attrs:{placeholder:"请输入备注",autocomplete:"off"},model:{value:e.form.FileDetail,callback:function(t){e.$set(e.form,"FileDetail",t)},expression:"form.FileDetail"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("projectForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("projectForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var k=a("VU/8")(G,$,!1,function(e){a("eJM+")},"data-v-fc8f1194",null).exports,F=a("oFuF"),L=C.a.ProjectFileTypeEnum,R={name:"FileListDialog",props:{fileRecordInfo:{type:Object,default:null}},data:function(){return{loading:!1,dialigVisible:!0,ProjectFileTypeEnum:L,fileListColumns:C.a.fileListColumns(this),options:{index:!0,labelIndex:"序号",props:{width:120}},dataSource:[],previewDialogVisible:!1,dialogImageUrl:""}},mounted:function(){console.log(this.fileRecordInfo),this.getFileList()},methods:{getFileList:function(){var e=this;this.loading=!0;var t={id:this.fileRecordInfo.ProjectFileId};this.$api.project.GetGensetProjectFile(t).then(function(t){1===t.Code&&(console.log(t),e.fileDetails=t.Data,e.$set(e,"dataSource",t.Data.FileUrlList)),e.loading=!1})},IsImgType:function(e){return["png","jpg","jpge","gif"].includes(e)},close:function(){this.$emit("closeDialog")},handleDownloadClick:function(e){var t={id:e.ProjectFileUrlId};this.$api.project.DoDownloadGensetProjectFile(t).then(function(t){console.log(t),Object(F.a)(t,e.FileName)})},handlePreviewClick:function(e){this.previewDialogVisible=!0,this.dialogImageUrl="http://www.fortrustyun.com:8022/"+e.FileUrl}}},V={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"show-file-dialog",attrs:{title:"合同文件查看",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("el-row",[a("el-col",[a("span",[e._v("文件类型：")]),a("span",[e._v(e._s(e.ProjectFileTypeEnum.find(function(t){return t.value==e.fileRecordInfo.FileType}).label))])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("文件名称：")]),a("span",[e._v(e._s(e.fileRecordInfo.FileName))])]),e._v(" "),a("el-col",{attrs:{span:12}},[a("span",[e._v("文件备注：")]),a("span",[e._v(e._s(e.fileRecordInfo.FileDetail))])])],1),e._v(" "),a("p",[a("span",[e._v("文件列表：")])]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"file-list-table",attrs:{options:e.options,columns:e.fileListColumns,dataSource:e.dataSource,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[e.IsImgType(t.row.FileType)?e._e():a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDownloadClick(t.row)}}},[e._v("\n                下载\n              ")]),e._v(" "),e.IsImgType(t.row.FileType)?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handlePreviewClick(t.row)}}},[e._v("\n                预览\n              ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.close()}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{staticClass:"previewDialog",attrs:{title:"图片预览",visible:e.previewDialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var E=a("VU/8")(R,V,!1,function(e){a("SyOr")},"data-v-1878186e",null).exports,M=a("woOf"),N=a.n(M),O={name:"AddOrEditPersonnelDialog",props:{CustomerTypeEnum:Array,UserTypeEnum:Array,projectId:{type:Number,default:null},personnelInfo:{type:Object,default:null}},data:function(){return{dialigVisible:!0,formLabelWidth:"100px",form:{CustomerType:"",CustomerId:"",CustomerAddress:"",UserId:""},rules:{CustomerType:[{required:!0,message:"请选择公司类型",trigger:"change"}],CustomerId:[{required:!0,message:"请选择公司",trigger:"change"}],UserId:[{required:!0,message:"请选择负责人",trigger:"change"}]},customerList:[],userList:[]}},mounted:function(){this.getAllCustomers(),this.personnelInfo&&(this.form=N()({},this.personnelInfo,{CustomerId:this.personnelInfo.CustomerID}),this.getAllUsers(this.personnelInfo.CustomerID))},methods:{getAllCustomers:function(){var e=this;this.$api.project.getAllCustomers().then(function(t){1===t.Code&&(e.customerList=t.Data,console.log(e.customerList))})},customerChange:function(e){this.form.CustomerAddress=this.customerList.find(function(t){return t.ID==e}).Address,this.form.UserId="",this.getAllUsers()},getAllUsers:function(e){var t=this;return y()(h.a.mark(function a(){var s,n;return h.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:s={customerId:e||t.form.CustomerId,departmentId:0},n={DisplayMode:1,IsContainSelf:!0},t.$api.project.GetUsersV1(n,s).then(function(e){1===e.Code&&(t.userList=e.Data)});case 3:case"end":return a.stop()}},a,t)}))()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.personnelInfo?t.editUser():t.addUser()})},addUser:function(){var e=this,t=i()({},this.form,{ProjectId:this.projectId});this.$api.project.AddGensetProjectJoinUser(t).then(function(t){1===t.Code?e.$message({type:"success",message:"添加用户成功!"}):e.$message({type:"error",message:"添加用户失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},editUser:function(){var e=this,t={CustomerType:this.form.CustomerType,ProjectId:this.projectId},a={id:this.personnelInfo.ID};this.$api.project.EditGensetProjectJoinUser(t,a).then(function(t){1===t.Code?e.$message({type:"success",message:"编辑用户成功!"}):e.$message({type:"error",message:"编辑用户失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},close:function(){this.$emit("closeDialog")}}},A={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"personnel-addedit-dialog",attrs:{title:e.personnelInfo?"编辑人员":"添加人员",width:"400px",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"公司类型",prop:"CustomerType"}},[a("el-select",{attrs:{placeholder:"请选择公司类型"},model:{value:e.form.CustomerType,callback:function(t){e.$set(e.form,"CustomerType",t)},expression:"form.CustomerType"}},e._l(e.CustomerTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"公司名称",prop:"CustomerId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择公司",disabled:e.personnelInfo},on:{change:e.customerChange},model:{value:e.form.CustomerId,callback:function(t){e.$set(e.form,"CustomerId",t)},expression:"form.CustomerId"}},e._l(e.customerList,function(e){return a("el-option",{key:e.ID,attrs:{label:e.CompanyName,value:e.ID}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人",prop:"UserId"}},[a("el-select",{attrs:{filterable:"",disabled:e.personnelInfo?e.personnelInfo:!e.form.CustomerId,placeholder:"请选择负责人"},model:{value:e.form.UserId,callback:function(t){e.$set(e.form,"UserId",t)},expression:"form.UserId"}},e._l(e.userList,function(e){return a("el-option",{key:e.ID,attrs:{label:e.DisplayName,value:e.ID}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("projectForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("projectForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var U=a("VU/8")(O,A,!1,function(e){a("1QME")},"data-v-bdb10fe4",null).exports,B={name:"ProjectDetails",components:{AddOrEditProjectDialog:S.a,OpenProjectDialog:T.a,BasicInfoList:w,FileUploadDialog:k,FileListDialog:E,AddOrEditPersonnelDialog:U},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&(this.$set(this,"ProjectId",e.ProjectId),this.$set(this,"projectStatus",e.Status))},deep:!0,immediate:!0}},data:function(){return{loading_1:!1,loading_2:!1,loading_3:!1,dialogEditVisible:!1,dialogOpenVisible:!1,ProjectId:null,projectBasicInfo:{},projectStatus:null,contractColumns:C.a.contractColumns(this),fileTableData:[],fileUploadVisible:!1,fileListVisible:!1,fileRecordInfo:null,CustomerTypeEnum:null,UserTypeEnum:null,personnelColumns:C.a.personnelColumns(this),userTableData:[],personnelManageVisible:!1,personnelInfo:null,options:{index:!0,labelIndex:"序号",props:{width:120}}}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,this.projectStatus=this.currentProject.Status,this.initData()},methods:{initData:function(){var e=this;this.getProjectBasicInfo(),this.getProjectFileList(),this.getCustomerAddUserType().then(function(){e.getProjectUserList()})},getProjectBasicInfo:function(){var e=this;this.loading_1=!0;var t={id:this.ProjectId};this.$api.project.GetGensetProject(t).then(function(t){1===t.Code&&(e.$set(e,"projectBasicInfo",t.Data),e.$set(e,"projectStatus",t.Data.Status)),e.loading_1=!1})},handleEditProject:function(){this.dialogEditVisible=!0},handleOpen:function(){var e=this,t=this.$createElement;this.$confirm("操作提示",{title:"开启项目",message:t("div",[t("p",[t("span","确定开启项目“"),t("em",{style:"color: #1ABC9C;margin: 0 4px;"},this.projectBasicInfo.ProjectName),t("span","”吗？")]),t("p","开启操作不可取消，请谨慎操作。")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.changeProjectStatus(e.projectBasicInfo.ProjectId,2)}).catch(function(){e.$message({type:"info",message:"已取消"})})},handleOpenConfirm:function(e){this.changeProjectStatus(e.projectId,e.status)},handleClose:function(){var e=this,t=this.$createElement;this.$confirm("操作提示",{title:"完结项目",message:t("div",[t("p",[t("span","确定完结项目“"),t("em",{style:"color: #1ABC9C,margin: 0 4px;"},this.projectBasicInfo.ProjectName),t("span","”吗？")]),t("p","完结后，项目相关信息将不再支持编辑，操作不可取消，请谨慎操作。")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.changeProjectStatus(e.ProjectId,3)}).catch(function(){e.$message({type:"info",message:"已取消"})})},changeProjectStatus:function(e,t){var a=this,s={id:e,status:t};this.$api.project.ChangeGensetProjectStatus(s).then(function(e){1===e.Code&&(a.queryTableData(),a.$message({type:"success",message:e.Message}))})},getProjectFileList:function(){var e=this;this.loading_2=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectFileManage(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.fileTableData=t.Data.Data),e.loading_2=!1})},handleUploadFile:function(){this.fileUploadVisible=!0},handleShowFileList:function(e){this.fileRecordInfo=e,this.fileListVisible=!0},handleDeleteFile:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"删除文件",message:a("div",[a("p",[a("span","确定删除当前文件吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.ProjectFileId};t.$api.project.DeleteGensetProjectFile(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除文件成功!"}),t.getProjectFileList()):t.$message({type:"error",message:"删除文件失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},getCustomerAddUserType:function(){var e=this;return y()(h.a.mark(function t(){return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.project.GetCustomerType().then(function(t){1===t.Code&&(e.CustomerTypeEnum=t.Data.map(function(e){return{value:e.Type,label:e.TypeName}}))});case 2:return t.next=4,e.$api.project.GetUserType().then(function(t){1===t.Code&&(e.UserTypeEnum=t.Data.map(function(e){return{value:e.Type,label:e.TypeName}}))});case 4:case"end":return t.stop()}},t,e)}))()},getProjectUserList:function(){var e=this;this.loading_3=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectJoinUserManage(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.userTableData=t.Data.Data.map(function(e){return i()({ID:e.ProjectJoinUserId,CustomerType:e.CustomerType,UserType:e.UserType},e.JoinUser)})),e.loading_3=!1})},handleAddPersonnel:function(){this.personnelInfo=null,this.personnelManageVisible=!0},handleEditPersonnel:function(e){this.personnelInfo=e,this.personnelManageVisible=!0},handleDeletePersonnel:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"删除人员",message:a("div",[a("p",[a("span","确定删除当前项目人员吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.ID};t.$api.project.DeleteGensetProjectJoinUser(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除人员成功!"}),t.getProjectUserList()):t.$message({type:"error",message:"删除人员失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleBackClick:function(){this.$router.push({path:"/project/project-list"})},closeDialog:function(e,t){if(this[e]=!1,t&&t.refresh)switch(e){case"dialogEditVisible":this.getProjectBasicInfo();break;case"fileUploadVisible":this.getProjectFileList();break;case"personnelManageVisible":this.getProjectUserList();break;case"crewManageVisible":this.getProjectGensetList();break;case"parallelCerwManageVisible":this.getProjectParallelList(),this.getProjectGensetList()}}}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"project-detail"},[a("div",{staticClass:"project-info-item"},[a("p",{staticClass:"content-title"},[e._v("\n        基本信息\n        "),3!==e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleEditProject()}}},[e._v("编辑")]):e._e(),e._v(" "),1===e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleOpen()}}},[e._v("\n          开启项目\n        ")]):e._e(),e._v(" "),2===e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleClose()}}},[e._v("\n          完结项目\n        ")]):e._e()],1),e._v(" "),a("BasicInfoList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_1,expression:"loading_1"}],attrs:{projectBasicInfo:e.projectBasicInfo}})],1),e._v(" "),a("div",{staticClass:"project-info-item"},[a("p",{staticClass:"content-title"},[e._v("\n        合同文件\n        "),3!==e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleUploadFile()}}},[e._v("\n          上传文件\n        ")]):e._e()],1),e._v(" "),a("div",{staticClass:"item-content contract-document"},[a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_2,expression:"loading_2"}],attrs:{options:e.options,columns:e.contractColumns,dataSource:e.fileTableData}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleShowFileList(t.row)}}},[e._v(" 查看 ")]),e._v(" "),3!==e.projectStatus?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDeleteFile(t.row)}}},[e._v("\n                  删除\n                ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1)]),e._v(" "),a("div",{staticClass:"project-info-item"},[a("p",{staticClass:"content-title"},[e._v("\n        项目人员\n        "),3!==e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleAddPersonnel()}}},[e._v("\n          添加人员\n        ")]):e._e()],1),e._v(" "),a("div",{staticClass:"item-content personnel-list"},[a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_3,expression:"loading_3"}],attrs:{options:e.options,columns:e.personnelColumns,dataSource:e.userTableData}},[3!==e.projectStatus?a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.handleEditPersonnel(t.row)}}},[e._v("\n                  编辑\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.handleDeletePersonnel(t.row)}}},[e._v("\n                  删除\n                ")])],1)]}}],null,!1,1023728011)},"el-table-column",e.options&&e.options.props,!1)):e._e()],1)],1)])]),e._v(" "),e.dialogEditVisible?a("AddOrEditProjectDialog",{attrs:{projectId:e.ProjectId},on:{closeDialog:function(t){return e.closeDialog("dialogEditVisible",t)}}}):e._e(),e._v(" "),e.fileUploadVisible?a("FileUploadDialog",{attrs:{projectId:e.ProjectId},on:{closeDialog:function(t){return e.closeDialog("fileUploadVisible",t)}}}):e._e(),e._v(" "),e.fileListVisible?a("FileListDialog",{attrs:{fileRecordInfo:e.fileRecordInfo},on:{closeDialog:function(t){return e.closeDialog("fileListVisible",t)}}}):e._e(),e._v(" "),e.personnelManageVisible?a("AddOrEditPersonnelDialog",{attrs:{projectId:e.ProjectId,personnelInfo:e.personnelInfo,CustomerTypeEnum:e.CustomerTypeEnum,UserTypeEnum:e.UserTypeEnum},on:{closeDialog:function(t){return e.closeDialog("personnelManageVisible",t)}}}):e._e(),e._v(" "),e.dialogOpenVisible?a("OpenProjectDialog",{attrs:{projectInfo:e.projectBasicInfo},on:{handleOpenConfirm:e.handleOpenConfirm,closeDialog:function(t){return e.closeDialog("dialogOpenVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var H=a("VU/8")(B,q,!1,function(e){a("GP0A")},"data-v-0cd6364f",null).exports,Y=a("j9eq"),W=a("fALy"),z={name:"AddCrewDialog",mixins:[W.a],components:{PositionCascader:Y.a},props:{projectId:{type:Number,default:null}},data:function(){return{loading:!1,dialigVisible:!0,searchForm:{InstallationSite:"",EngineModel:"",RatedPowerMin:"",RatedPowerMax:""},columns:C.a.selectCrewColumns(this),dataSource:[],selectData:[],options:{index:!0,labelIndex:"序号",props:{width:60}},searchData:[],dataTotal:0,paginationCfg:{currentPage:1,pageSize:10,layout:"prev, pager, next,jumper",pageSizes:[10,20,30,40],pagerCount:5}}},mounted:function(){this.queryTableData()},methods:{queryTableData:function(){var e=this;this.loading=!0;var t=i()({},this.searchForm);this.$api.project.GetGensetProjectGensetInfoByAll(t).then(function(t){if(1===t.Code){console.log(t);var a=t.Data.map(function(e){return i()({},e.GeneratorSet)});e.$set(e,"dataSource",a),e.dataTotal=t.Data.length,e.loadData()}e.loading=!1}).catch(function(){e.loading=!1})},loadData:function(){console.log("loadData",this.dataSource,this.paginationCfg);var e=this.dataSource.slice(this.paginationCfg.pageSize*(this.paginationCfg.currentPage-1),this.paginationCfg.pageSize*this.paginationCfg.currentPage);this.$set(this,"searchData",e),console.log(this.searchData)},reset:function(){this.$set(this,"searchForm",{InstallationSite:"",EngineModel:"",RatedPowerMin:"",RatedPowerMax:""})},handleSelect:function(e){this.selectData.push(e),this.dataSource.splice(this.dataSource.indexOf(e),1,i()({},e,{isSelect:!0})),this.$set(this,"dataSource",this.dataSource),this.searchData.splice(this.searchData.indexOf(e),1,i()({},e,{isSelect:!0})),this.$set(this,"searchData",this.searchData)},handleRemove:function(e){this.selectData.splice(this.selectData.indexOf(e),1),this.dataSource.splice(this.dataSource.findIndex(function(t){return t.GeneratorSetId==e.GeneratorSetId}),1,i()({},e,{isSelect:!1})),this.searchData.splice(this.searchData.findIndex(function(t){return t.GeneratorSetId==e.GeneratorSetId}),1,i()({},e,{isSelect:!1}))},submitForm:function(){var e=this,t={ProjectId:this.projectId,JoinGensetList:this.selectData.map(function(e){return{GeneratorSetId:e.GeneratorSetId}})};this.$api.project.AddGensetProjectJoinGenset(t).then(function(t){1===t.Code?e.$message({type:"success",message:"添加机组成功!"}):e.$message({type:"error",message:"添加机组失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},close:function(){this.$emit("closeDialog")},handleChangePage:function(e){this.paginationCfg.currentPage=e,this.$set(this.paginationCfg,"currentPage",e),this.lastSearchForm&&(this.searchForm=_.cloneDeep(this.lastSearchForm)),this.loadData()},handleChangeSize:function(e){console.log(111111111),this.paginationCfg.currentPage=1,this.paginationCfg.pageSize=e,this.$set(this.paginationCfg,"currentPage",1),this.$set(this.paginationCfg,"pageSize",e),this.lastSearchForm&&(this.searchForm=_.cloneDeep(this.lastSearchForm)),this.loadData()},positionChange:function(e){this.searchForm.InstallationSite=e.crewPosition}}},J={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"add-crew-dialog",attrs:{title:"添加机组",width:"90%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"left-box"},[a("p",{staticClass:"title"},[e._v("全部可选机组")]),e._v(" "),a("div",{staticClass:"search-box"},[a("div",{staticClass:"search-item"},[a("span",[e._v("机组位置:")]),e._v(" "),a("position-cascader",{attrs:{placeholder:"请选择机组位置",defaultPosition:e.searchForm.InstallationSite},on:{positionChange:e.positionChange}})],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("发动机型号:")]),e._v(" "),a("el-input",{attrs:{placeholder:"请输入发动机型号",maxlength:"20"},model:{value:e.searchForm.EngineModel,callback:function(t){e.$set(e.searchForm,"EngineModel",t)},expression:"searchForm.EngineModel"}})],1),e._v(" "),a("div",{staticClass:"search-item power-item"},[a("span",[e._v("功率:")]),e._v(" "),a("el-input",{attrs:{type:"number",placeholder:"最低功率"},model:{value:e.searchForm.RatedPowerMin,callback:function(t){e.$set(e.searchForm,"RatedPowerMin",t)},expression:"searchForm.RatedPowerMin"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input",{attrs:{type:"number",placeholder:"最高功率"},model:{value:e.searchForm.RatedPowerMax,callback:function(t){e.$set(e.searchForm,"RatedPowerMax",t)},expression:"searchForm.RatedPowerMax"}})],1),e._v(" "),a("div",{staticClass:"search-btn-box"},[a("el-button",{staticClass:"reset-btn",attrs:{type:"text"},on:{click:function(t){return e.reset()}}},[e._v("清空筛选")]),e._v(" "),a("el-button",{staticClass:"query-btn",attrs:{type:"primary"},on:{click:function(t){return e.queryTableData()}}},[e._v("\n            查 询\n          ")])],1)]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{options:e.options,columns:e.columns,dataSource:e.searchData,dataTotal:e.dataTotal,border:"",pagination:e.paginationCfg},on:{handleChangePage:e.handleChangePage,handleChangeSize:e.handleChangeSize}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{disabled:t.row.isSelect,type:"text"},on:{click:function(a){return e.handleSelect(t.row)}}},[e._v("\n                选中\n              ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1),e._v(" "),a("div",{staticClass:"right-box"},[a("p",{staticClass:"title"},[e._v("已选择机组")]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.columns,dataSource:e.selectData,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleRemove(t.row)}}},[e._v(" 移除 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确 定")])],1)])},staticRenderFns:[]};var K=a("VU/8")(z,J,!1,function(e){a("I/CR")},"data-v-633fbf9e",null).exports,Q={name:"AddOrEditParallelCrewDialog",components:{PositionCascader:Y.a},props:{projectId:{type:Number,default:null},parallelCerwInfo:{type:Object,default:null}},data:function(){return{loading:!1,dialigVisible:!0,searchForm:{InstallationSite:"",EngineModel:"",RatedPowerMin:"",RatedPowerMax:""},columns:C.a.setParallelCrewColumns(this),dataSource:[],selectHostData:[],selectExtensionData:[],options:{index:!0,labelIndex:"序号",props:{width:60}},ParallelName:"",TotalPower:0}},mounted:function(){this.queryTableData()},methods:{queryTableData:function(){var e=this;this.loading=!0;var t=i()({},this.searchForm,{ProjectId:this.projectId,ParallelType:0});this.$api.project.GetGensetProjectJoinGensetByAll(t).then(function(t){if(1===t.Code){var a=t.Data.map(function(e){return i()({},e.GeneratorSet,{IsParallel:e.IsParallel,isSelect:!1})}),s=[],n=[],o=[];e.parallelCerwInfo?(console.log("edit"),a.forEach(function(t){t.IsParallel?e.parallelCerwInfo.selectHostIds.includes(t.GeneratorSetId)?(s.push(i()({},t,{isSelect:!0})),n.push(i()({},t,{isSelect:!0}))):e.parallelCerwInfo.selectExtensionIds.includes(t.GeneratorSetId)&&(s.push(i()({},t,{isSelect:!0})),o.push(i()({},t,{isSelect:!0}))):s.push(t)}),console.log(e.parallelCerwInfo,n,o),e.$set(e,"selectHostData",n),e.$set(e,"selectExtensionData",o),e.countTotalPower()):a.forEach(function(e){e.IsParallel||s.push(e)}),e.$set(e,"dataSource",s)}e.loading=!1}).catch(function(){e.loading=!1})},reset:function(){this.$set(this,"searchForm",{InstallationSite:"",EngineModel:"",RatedPowerMin:"",RatedPowerMax:""})},handleSelect:function(e,t){if(1===t){if(this.selectHostData.length>0)return void this.$message.warning("并机组只能设置一个主机！");this.selectHostData.push(e)}else this.selectExtensionData.push(e);this.dataSource.splice(this.dataSource.indexOf(e),1,i()({},e,{isSelect:!0})),this.$set(this,"dataSource",this.dataSource),this.countTotalPower()},handleRemove:function(e,t){1===t?this.selectHostData.splice(this.selectHostData.indexOf(e),1):this.selectExtensionData.splice(this.selectExtensionData.indexOf(e),1),this.dataSource.splice(this.dataSource.findIndex(function(t){return t.GeneratorSetId==e.GeneratorSetId}),1,i()({},e,{isSelect:!1})),this.countTotalPower()},countTotalPower:function(){console.log(this.selectHostData,this.selectExtensionData);var e=0;this.selectHostData.concat(this.selectExtensionData).forEach(function(t){e+=t.RatedPower}),this.TotalPower=e},submitForm:function(){if(0!=this.selectHostData.length)if(0!=this.selectExtensionData.length){if(this.parallelCerwInfo)return console.log("save----编辑"),void this.editProjectParallel();console.log("save----新建"),this.addProjectParallel()}else this.$message.warning("并机组必须设置一个分机！");else this.$message.warning("并机组必须设置一个主机！")},addProjectParallel:function(){var e=this,t={ProjectId:this.projectId,JoinGensetIsMainList:this.selectHostData.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),JoinGensetIsNotMainList:this.selectExtensionData.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),ParallelName:this.ParallelName,TotalPower:this.TotalPower};this.$api.project.AddGensetProjectParallel(t).then(function(t){1===t.Code?e.$message({type:"success",message:"添加并机组成功!"}):e.$message({type:"error",message:"添加并机组失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},editProjectParallel:function(){var e=this,t={id:this.parallelCerwInfo.ID},a={JoinGensetIsMainList:this.selectHostData.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),JoinGensetIsNotMainList:this.selectExtensionData.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),ParallelName:this.ParallelName,TotalPower:this.TotalPower};this.$api.project.EditGensetProjectParallel(a,t).then(function(t){1===t.Code?e.$message({type:"success",message:"编辑并机组成功!"}):e.$message({type:"error",message:"编辑并机组失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},close:function(){this.$emit("closeDialog")},positionChange:function(e){this.searchForm.InstallationSite=e.crewPosition}}},X={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"add-crew-dialog",attrs:{title:e.parallelCerwInfo?"编辑并机组":"添加并机组",width:"90%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"left-box"},[a("p",{staticClass:"title"},[e._v("当前项目全部机组")]),e._v(" "),a("div",{staticClass:"search-box"},[a("div",{staticClass:"search-item"},[a("span",[e._v("机组位置:")]),e._v(" "),a("position-cascader",{attrs:{placeholder:"请选择机组位置",defaultPosition:e.searchForm.InstallationSite},on:{positionChange:e.positionChange}})],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("发动机型号:")]),e._v(" "),a("el-input",{attrs:{placeholder:"请输入发动机型号",maxlength:"20"},model:{value:e.searchForm.EngineModel,callback:function(t){e.$set(e.searchForm,"EngineModel",t)},expression:"searchForm.EngineModel"}})],1),e._v(" "),a("div",{staticClass:"search-item power-item"},[a("span",[e._v("功率:")]),e._v(" "),a("el-input",{attrs:{type:"number",placeholder:"最低功率"},model:{value:e.searchForm.RatedPowerMin,callback:function(t){e.$set(e.searchForm,"RatedPowerMin",t)},expression:"searchForm.RatedPowerMin"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input",{attrs:{type:"number",placeholder:"最高功率"},model:{value:e.searchForm.RatedPowerMax,callback:function(t){e.$set(e.searchForm,"RatedPowerMax",t)},expression:"searchForm.RatedPowerMax"}})],1),e._v(" "),a("div",{staticClass:"search-btn-box"},[a("el-button",{staticClass:"reset-btn",attrs:{type:"text"},on:{click:function(t){return e.reset()}}},[e._v("清空筛选")]),e._v(" "),a("el-button",{staticClass:"query-btn",attrs:{type:"primary"},on:{click:function(t){return e.queryTableData()}}},[e._v("查 询")])],1)]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,border:""}},[a("el-table-column",{attrs:{slot:"operation",label:"操作",align:"center",width:"100"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{disabled:t.row.isSelect,type:"text"},on:{click:function(a){return e.handleSelect(t.row,1)}}},[e._v("\n                添加为主机\n              ")]),e._v(" "),a("el-button",{attrs:{disabled:t.row.isSelect,type:"text"},on:{click:function(a){return e.handleSelect(t.row,2)}}},[e._v("\n                添加为分机\n              ")])],1)]}}])})],1)],1),e._v(" "),a("div",{staticClass:"right-box"},[a("p",{staticClass:"title"},[e._v("当前并机组")]),e._v(" "),a("p",{staticClass:"select-type"},[a("span"),e._v("并机组主机")]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.columns,dataSource:e.selectHostData,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleRemove(t.row,1)}}},[e._v(" 移除 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("p",{staticClass:"select-type"},[a("span"),e._v(" 并机组分机")]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.columns,dataSource:e.selectExtensionData,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleRemove(t.row,2)}}},[e._v(" 移除 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("p",{staticClass:"all-power"},[e._v("\n        当前总功率："),a("span",[e._v(e._s(e.TotalPower))]),e._v("Kw\n      ")])],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确 定")])],1)])},staticRenderFns:[]};var Z=a("VU/8")(Q,X,!1,function(e){a("9uFn")},"data-v-ed9d5176",null).exports,ee=a("0Yr5"),te={name:"AddOrEditPersonnelDialog",props:{gensetId:{type:Number,default:null},setFenceType:String},data:function(){return{dialigVisible:!0,formLabelWidth:"100px",form:{longitude:"",latitude:"",radius:""},rules:{longitude:[{required:!0,message:"请输入中心点经度",trigger:"blur"}],latitude:[{required:!0,message:"请输入中心点纬度",trigger:"blur"}],radius:[{required:!0,message:"请输入围栏半径",trigger:"blur"}]},loading:!1,loadingMsg:"地图加载中，请您稍候...",gensetMap:null,fenceRadius:500,fenceCenterPoint:null,beginDate:this.$moment().add(-3,"days").format("YYYY-MM-DD"),endTime:this.$moment().format("YYYY-MM-DD HH:mm"),dataObj:null,fenceMap:null}},mounted:function(){this.renderFenceMap()},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;console.log(t.form),t.commitHandler()})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},renderFenceMap:function(e){var t=this;this.loading=!0,this.$api.project.GetGensetFenceSetting({id:this.gensetId}).then(function(a){t.loading=!1,t.dataObj=a.Data;var s=t;Object(ee.a)("o7gALXwtch6SNk9jjH4DmFffcFt1PhFL").then(function(a){var n=a||void 0,o=new n.Map("crew-location-fence-box",{enableMapClick:!1});s.gensetMap=s.dataObj.Genset;var i=new n.Point(s.gensetMap.Longitude,s.gensetMap.Latitude),r=null;"add"==t.setFenceType||"reset"==e?r=new n.Point(s.gensetMap.Longitude,s.gensetMap.Latitude):(s.fenceRadius=s.dataObj.Range,r=new n.Point(s.dataObj.Longitude,s.dataObj.Latitude)),s.fenceCenterPoint=r,s.setFormData();var l={strokeColor:"red",strokeWeight:2,strokeOpacity:.5,fillOpacity:.1,fillColor:"tomato"},c=new n.Marker(i,{offset:new n.Size(0,5)}),u=function(e){var t=e.point;s.fenceCenterPoint=t;var a=new n.Circle(t,s.fenceRadius,l);o.clearOverlays(),o.addOverlay(a),s.setOverlayEditing(a),a.addEventListener("lineupdate",function(e){s.fenceRadius=e.target.getRadius().toFixed(0),s.fenceCenterPoint=e.target.getCenter(),s.setFormData()}),s.setFormData()};o.disableDoubleClickZoom(),o.enableScrollWheelZoom(),o.centerAndZoom(r,15),u({point:r}),o.addEventListener("click",u),c.disableMassClear(),c.setAnimation(BMAP_ANIMATION_BOUNCE),o.addOverlay(c),s.fenceMap=o}).catch(function(e){alert(e)})})},setOverlayEditing:function(e){setTimeout(function(){e.enableEditing()},0)},setFormData:function(){this.$set(this,"form",{longitude:this.fenceCenterPoint.lng,latitude:this.fenceCenterPoint.lat,radius:this.fenceRadius})},commitHandler:function(){var e=this,t=u.a.bd_gps_encrypt(this.form.latitude,this.form.longitude),a=u.a.gcj02_gps_encrypt(t.Longitude,t.Latitude),s={IsOpen:!0,Range:this.form.radius,Longitude:a.Longitude,Latitude:a.Latitude},n={id:this.gensetId};this.$api.project.GensetFenceSetting(s,n).then(function(t){e.$message.success(t.Message),e.close(!0)}).catch(function(t){e.$message.error(t),e.close()})},close:function(e){this.loading=!1,this.fenceMap=null,e?this.$emit("closeDialog",{refresh:!0}):this.$emit("closeDialog")},formInput:function(){var e=this,t=this.form,a={lat:t.latitude,lng:t.longitude},s=t.radius,n=new BMap.Circle(a,s,{strokeColor:"red",strokeWeight:2,strokeOpacity:.5,fillOpacity:.1,fillColor:"tomato"});this.fenceMap.clearOverlays(),this.fenceMap.addOverlay(n),this.setOverlayEditing(n),n.addEventListener("lineupdate",function(t){e.fenceRadius=t.target.getRadius().toFixed(0),e.fenceCenterPoint=t.target.getCenter(),e.setFormData()})}}},ae={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"electronic-fence-dialog",attrs:{title:"修改电子围栏设置",width:"70%","element-loading-text":e.loadingMsg,visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("i",{staticClass:"resetBtn el-icon-aim",attrs:{title:"重置"},on:{click:function(t){return e.renderFenceMap("reset")}}}),e._v(" "),a("div",{attrs:{id:"crew-location-fence-box"}}),e._v(" "),a("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"围栏中心:"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("span",[a("i",{staticClass:"require_tip"},[e._v("*")]),e._v("围栏中心:")])]),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"",prop:"longitude"}},[a("el-input",{attrs:{placeholder:"请输入中心点经度",autocomplete:"off"},on:{input:function(t){return e.formInput()}},model:{value:e.form.longitude,callback:function(t){e.$set(e.form,"longitude",t)},expression:"form.longitude"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("经度")])],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"",prop:"latitude"}},[a("el-input",{attrs:{placeholder:"请输入中心点纬度",autocomplete:"off"},on:{input:function(t){return e.formInput()}},model:{value:e.form.latitude,callback:function(t){e.$set(e.form,"latitude",t)},expression:"form.latitude"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("纬度")])],1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"围栏半径:",prop:"radius"}},[a("el-input",{attrs:{placeholder:"请输入围栏半径",autocomplete:"off"},on:{input:function(t){return e.formInput()}},model:{value:e.form.radius,callback:function(t){e.$set(e.form,"radius",t)},expression:"form.radius"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("米")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("projectForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("projectForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var se=a("VU/8")(te,ae,!1,function(e){a("XMeO")},"data-v-0ff99e31",null).exports,ne=a("mvHQ"),oe=a.n(ne),ie=[{value:1,label:"运维"},{value:2,label:"代运维"}],re=[{value:1,label:"准备中"},{value:2,label:"进行中"},{value:3,label:"已完成"}],le=[{value:1,label:"备用机"},{value:2,label:"主用机"}],ce={StrategyTypeEnum:le,strategyColumns:function(e){return[{label:"维保策略名称",prop:"StrategyName",minWidth:"40%"},{label:"发动机品牌",prop:"EngineBrandName",minWidth:"20%"},{label:"发动机系列",prop:"EngineModelName",minWidth:"20%"},{label:"策略主备分类",prop:"Type",minWidth:"20%",formatter:function(e,t,a){return e.Type?le.find(function(t){return t.value==e.Type}).label:""}}]},listOperates:function(e){return[{label:"选中",method:function(t){e.handleSelect(t)},setStyle:function(t){if(e.selectItem&&t.StrategyId==e.selectItem.StrategyId)return"color: red;"},disabled:function(e){return!e.IsUsing}}]},ProjectTypeEnum:ie,ProjectStatusEnum:re,projectInfoColumns:function(e){return[{label:"项目名称",prop:"ProjectName",minWidth:"35%"},{label:"项目类型",prop:"ProjectType",minWidth:"20%",formatter:function(e,t,a){return e.ProjectType?ie.find(function(t){return t.value==e.ProjectType}).label:""}},{label:"项目编号",prop:"ProjectNumber",minWidth:"35%"},{label:"功率需求",prop:"TotalPower",minWidth:"20%",unit:"Kw"},{label:"机组数量",prop:"Quantity",minWidth:"20%",unit:"台"},{label:"项目地址",prop:"ProjectArea",minWidth:"40%"},{label:"项目状态",prop:"Status",minWidth:"20%",formatter:function(e,t,a){return e.Status?re.find(function(t){return t.value==e.Status}).label:""}},{label:"项目开始时间",prop:"StartDate",minWidth:"30%",formatter:function(t,a,s){return t.StartDate?e.$moment(t.StartDate).format("YYYY.MM.DD"):""}},{label:"项目结束时间",prop:"EndDate",minWidth:"30%",formatter:function(t,a,s){return t.EndDate?e.$moment(t.EndDate).format("YYYY.MM.DD"):""}},{label:"到期剩余时间",prop:"EndDateLast",minWidth:"25%",formatter:function(e,t,a){return e.EndDateLast||"已到期"}}]},gensetInfoColumns:function(e){return[{label:"机组名称",prop:"DisplayName",minWidth:"25%"},{label:"标识",prop:"CollectorToken",minWidth:"25%"},{label:"发动机型号",prop:"EngineModel",minWidth:"20%"},{label:"功率",prop:"RatedPower",minWidth:"15%",unit:"Kw"},{label:"运行时间",prop:"RunHourTotal",minWidth:"15%",unit:"h"},{label:"机组位置",prop:"InstallationSite",minWidth:"25%",render:function(e,t){return e("span",{class:"text-overflow-ellipsis MulLineHiding",attrs:{title:t.row.InstallationSite||""}},t.row.InstallationSite)}},{label:"是否并机",prop:"IsParallel",minWidth:"15%",formatter:function(e,t,a){return e.IsParallel?"是":"否"}},{label:"电子围栏开启情况",prop:"IsFenceOpen",minWidth:"18%",formatter:function(e,t,a){return e.IsFenceOpen?"已开启":"未开启"}},{label:"维保策略录入情况",prop:"IsStrategy",minWidth:"18%",formatter:function(e,t,a){return e.IsStrategy?"已录入":"未录入"}}]}},ue=ce.StrategyTypeEnum,de={name:"StrategyEditDialog",mixins:[W.a],props:{gensetId:{type:Number,default:null},setStrategyType:String},computed:i()({},Object(r.c)(["currentProject"])),data:function(){return{ProjectId:null,loading:!1,dialigVisible:!0,title:"第一步：选择维保策略",step:1,EngineBrandList:[],StrategyTypeEnum:ue,searchForm:{StrategyName:"",EngineBrandId:"",Type:""},columns:ce.strategyColumns(this),operates:ce.listOperates(this),dataSource:[],options:{index:!0,labelIndex:"序号",props:{width:86}},StrategyItemList:[],selectItem:null,GensetSettingDetail:null}},watch:{currentProject:{handler:function(e){1!==n()(e).length&&(console.log(e),this.$set(this,"projectId",e.ProjectId),this.$set(this,"projectStatus",e.Status))},deep:!0,immediate:!0},searchForm:{handler:function(e,t){},deep:!0}},mounted:function(){var e=this;this.ProjectId=this.currentProject.ProjectId,this.getEngineBrandList(),"edit"==this.setStrategyType?this.$api.project.GetMaintenanceGensetSettingDetail({},{GensetId:this.gensetId}).then(function(t){1===t.Code&&(e.$set(e,"GensetSettingDetail",t.Data),e.queryTableData(1))}):this.queryTableData()},methods:{getEngineBrandList:function(){var e=this;this.$api.operation.GetMaintenanceGensetEngineBrand().then(function(t){1===t.Code&&e.$set(e,"EngineBrandList",t.Data)})},queryTableData:function(e){var t=this;this.loading=!0;var a={Page:this.paginationCfg.currentPage,PageSize:this.paginationCfg.pageSize},s=i()({},this.searchForm);this.$api.operation.GetMaintenanceGensetStrategyManage(s,a).then(function(a){1===a.Code&&(t.dataTotal=a.Data.TotalItemCount,t.$set(t,"dataSource",a.Data.Data),1==e&&a.Data.Data.forEach(function(e){e.StrategyId==t.GensetSettingDetail.StrategyId&&t.$set(t,"selectItem",e)})),t.loading=!1}).catch(function(){t.loading=!1})},handleSelect:function(e){console.log(e),this.selectItem=e},nextStep:function(){var e=this;this.selectItem?"add"==this.setStrategyType||"edit"==this.setStrategyType&&this.selectItem.StrategyId!=this.GensetSettingDetail.StrategyId?this.$api.operation.GetMaintenanceGensetStrategyDetail({},{StrategyId:this.selectItem.StrategyId}).then(function(t){if(1===t.Code){var a=t.Data.StrategyItemList.map(function(e){return{ItemContent:e.ItemContent,DefaultHourSetting:e.DefaultHourSetting,DefaultDaySetting:e.DefaultDaySetting,MaintenanceProgramId:null,MaintenanceItemId:null,add:!0}});e.$router.push({path:"/project/controller-configuration",query:{projectId:e.ProjectId,gensetId:e.gensetId,activeTab:14,setStrategyType:"add",StrategyId:e.selectItem.StrategyId,StrategyItemList:oe()(a)}})}}):(this.$set(this,"StrategyItemList",this.GensetSettingDetail.ProgramList),this.$router.push({path:"/project/controller-configuration",query:{projectId:this.ProjectId,gensetId:this.gensetId,activeTab:14,setStrategyType:"edit",StrategyId:this.selectItem.StrategyId,StrategyItemList:oe()(this.GensetSettingDetail.ProgramList)}})):this.$message.warning("请选择维保策略")},prevStep:function(){this.title="第一步：选择维保策略",this.step=1},saveAsMould:function(){console.log(this.StrategyItemList),this.$router.push({path:"/setting/agreement-management/maintenance-strategy-new-add",query:{list:this.StrategyItemList}})},handleSave:function(){console.log(this.StrategyItemList),"add"==this.setStrategyType||"edit"==this.setStrategyType&&this.selectItem.StrategyId!=this.GensetSettingDetail.StrategyId?this.addSave():this.editSave()},addSave:function(){var e=this,t={GensetId:this.gensetId},a={StrategyId:this.selectItem.StrategyId,Remark:"",ItemList:this.StrategyItemList.map(function(e){return{OrderBy:e.OrderBy,ItemContent:e.ItemContent,DefaultHourSetting:e.DefaultHourSetting,DefaultDaySetting:e.DefaultDaySetting,Remark:e.Remark}})};this.$api.project.AddMaintenanceGensetSetting(a,t).then(function(t){1===t.Code?(console.log(t),e.$message({type:"success",message:"添加机组维保策略成功!"})):e.$message({type:"error",message:"添加机组维保策略失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},editSave:function(){var e=this,t={GensetId:this.gensetId},a={StrategyId:this.selectItem.StrategyId,ProgramList:this.StrategyItemList.map(function(e){return{MaintenanceProgramId:e.MaintenanceProgramId,MaintenanceItemId:e.MaintenanceItemId,ItemContent:e.ItemContent,DefaultHourSetting:e.DefaultHourSetting,DefaultDaySetting:e.DefaultDaySetting}})};this.$api.project.EditMaintenanceGensetSetting(a,t).then(function(t){1===t.Code?(console.log(t),e.$message({type:"success",message:"编辑机组维保策略成功!"})):e.$message({type:"error",message:"编辑机组维保策略失败，请重新提交!"}),e.$emit("closeDialog",{refresh:!0})})},close:function(){this.$emit("closeDialog")}}},pe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"edit-strategy-dialog",attrs:{title:e.title,width:"880px",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[1===e.step?a("div",{staticClass:"select-strategy"},[a("div",{staticClass:"search-box"},[a("div",{staticClass:"search-item"},[a("span",[e._v("维保策略名称:")]),e._v(" "),a("el-input",{attrs:{placeholder:"请输入维保策略名称"},on:{change:function(t){return e.resetCurrentParams()}},model:{value:e.searchForm.StrategyName,callback:function(t){e.$set(e.searchForm,"StrategyName",t)},expression:"searchForm.StrategyName"}})],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("发动机品牌:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择发动机品牌"},on:{change:function(t){return e.resetCurrentParams()}},model:{value:e.searchForm.EngineBrandId,callback:function(t){e.$set(e.searchForm,"EngineBrandId",t)},expression:"searchForm.EngineBrandId"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.EngineBrandList,function(e){return a("el-option",{key:e.EngineBrandId,attrs:{label:e.BrandName,value:e.EngineBrandId}})})],2)],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("策略主备分类:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择策略主备分类"},on:{change:function(t){return e.resetCurrentParams()}},model:{value:e.searchForm.Type,callback:function(t){e.$set(e.searchForm,"Type",t)},expression:"searchForm.Type"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.StrategyTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1)]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,dataTotal:e.dataTotal,operates:e.operates,pagination:e.paginationCfg,border:""},on:{handleChangePage:e.handleChangePage,handleChangeSize:e.handleChangeSize}})],1):a("div",{staticClass:"edit-strategy"},[a("div",{staticClass:"operation-box"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.prevStep()}}},[e._v("上一步")]),e._v(" "),a("el-button",{staticClass:"right-btn",attrs:{type:"primary"},on:{click:function(t){return e.saveAsMould()}}},[e._v("\n          储存当前策略为新模板\n        ")])],1),e._v(" "),a("div",[a("ul",{staticClass:"title"},[a("li",[e._v("序号")]),e._v(" "),a("li",[e._v("维保事项")]),e._v(" "),a("li",[e._v("运行时间")]),e._v(" "),a("li",[e._v("绝对时间")])]),e._v(" "),a("ul",{staticClass:"content"},e._l(e.StrategyItemList,function(t,s){return a("li",{key:s,staticClass:"content-item"},[a("div",[a("span",[e._v(e._s(s+1))])]),e._v(" "),a("div",[a("span",[e._v(e._s(t.ItemContent))])]),e._v(" "),a("div",[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.DefaultHourSetting,callback:function(a){e.$set(t,"DefaultHourSetting",a)},expression:"item.DefaultHourSetting"}}),a("em",[e._v("小时")])],1),e._v(" "),a("div",[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.DefaultDaySetting,callback:function(a){e.$set(t,"DefaultDaySetting",a)},expression:"item.DefaultDaySetting"}}),a("em",[e._v("天")])],1)])}),0)])]),e._v(" "),1===e.step?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("p",{staticClass:"select-text"},[e._v("\n        当前已选择："),a("span",[e._v(e._s(e.selectItem&&e.selectItem.StrategyName))])]),e._v(" "),a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")])],1):a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSave()}}},[e._v("保 存")])],1)])],1)},staticRenderFns:[]};var fe=a("VU/8")(de,pe,!1,function(e){a("H+o5")},"data-v-57efda02",null).exports,me=[{name:"更换润滑油",100:72,200:120,800:720},{name:"更换防冻液",100:72,200:120,600:600},{name:"更换空气滤清器",100:100,200:120},{name:"更换机油滤清器",100:100,200:120,700:648}],ve=[{name:"更换润滑油",5:3,10:8,40:35},{name:"更换防冻液",5:3,10:8,30:30},{name:"更换空气滤清器",5:5,10:10},{name:"更换机油滤清器",5:5,10:10,35:32}],ge={name:"StrategyShowDialog",props:{gensetId:{type:Number,default:null}},data:function(){return{loading:!1,dialigVisible:!0,dataSource:null,activeName:"first",columnHead:[]}},mounted:function(){this.queryTableData()},methods:{queryTableData:function(){this.$set(this,"columnHead",[100,200,300,400,500,600,700,800,900,1e3]),this.dataSource=me},handleClick:function(e,t){console.log(e,t),"first"===this.activeName?(this.$set(this,"columnHead",[100,200,300,400,500,600,700,800,900,1e3]),this.dataSource=me):(this.$set(this,"columnHead",[5,10,15,20,25,30,35,40,45,50]),this.dataSource=ve)},confirmClick:function(){this.$emit("closeDialog")}}},he={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"show-strategy-dialog",attrs:{title:"查看维保策略",width:"880px",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.confirmClick()}}},[a("div",{staticClass:"strategy-box"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"运行时间维度",name:"first"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"绝对时间维度",name:"second"}})],1),e._v(" "),a("div",{staticClass:"data-table"},[a("ul",{staticClass:"title"},[a("li",[e._v("维保事项\\节拍时间")]),e._v(" "),e._l(e.columnHead,function(t,s){return a("li",{key:s},[e._v("\n            "+e._s(t+" "+("first"===e.activeName?"h":"天"))+"\n          ")])})],2),e._v(" "),a("ul",{staticClass:"content"},e._l(e.dataSource,function(t,s){return a("li",{key:s,staticClass:"content-item"},[a("div",[a("span",[e._v(e._s(s+1))])]),e._v(" "),e._l(e.columnHead,function(s,n){return a("div",{key:n},[t[s]?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t[s]+" "+("first"===e.activeName?"h":"天"),placement:"top"}},[a("div",{staticClass:"circle-tip"})]):e._e()],1)})],2)}),0)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.confirmClick()}}},[e._v("确定")])],1)])],1)},staticRenderFns:[]};var _e=a("VU/8")(ge,he,!1,function(e){a("ciO/")},"data-v-6458ed7e",null).exports,be={name:"GensetInfo",inject:["reload"],props:{configData:{type:Object,default:null}},data:function(){return{GensetInfo:null,showByCrewStatus:u.g,url:a("3xIo"),isShowDrawer:!1,direction:"rtl",activeName:"1"}},watch:{},mounted:function(){this.getGeneratorSet()},methods:{getGeneratorSet:function(){var e=this;this.$api.operation.FindGeneratorSet({id:this.configData.gensetId}).then(function(t){1==t.Code&&(e.GensetInfo=t.Data)})},getUrl:function(e){return a("fO1v")("./signal_"+e+".png")}}},ye={render:function(){var e=this,t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"genset-info"},[s("el-row",{attrs:{type:"flex"}},[s("el-col",{staticClass:"genset-info-items genset-info-basic",attrs:{span:12}},[s("span",{staticClass:"genset-info-item genset-name"},[t._v(t._s(t.GensetInfo&&t.GensetInfo.DisplayName))]),t._v(" "),t.GensetInfo&&0!=t.GensetInfo.Status?s("div",{staticClass:"genset-info-item"},[t.GensetInfo&&2==t.GensetInfo.NetworkType?s("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:t.url}}):t.GensetInfo&&1==t.GensetInfo.NetworkType?s("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:t.getUrl(""+t.GensetInfo.NetworkValue)}}):t._e()],1):t._e(),t._v(" "),s("el-tag",{staticClass:"genset-info-item genset-tag",style:{background:t.showByCrewStatus(t.GensetInfo&&t.GensetInfo.Status).color,color:!t.GensetInfo||1!=t.GensetInfo.Status&&2!=t.GensetInfo.Status?"#fff":"#000"}},[t._v(t._s(t.showByCrewStatus(t.GensetInfo&&t.GensetInfo.Status).text)+"\n      ")]),t._v(" "),s("el-tag",{staticClass:"genset-info-item genset-tag genset-altitude"},[t._v("\n        海拔"+t._s(t.GensetInfo&&t.GensetInfo.Altitude||"-")+"m\n      ")])],1),t._v(" "),s("el-col",{staticClass:"genset-info-items operate-btns",attrs:{span:12}},[s("i",{staticClass:"genset-info-item el-icon-close",attrs:{title:"关闭"},on:{click:function(){return e.$emit("handleClose")}}})])],1),t._v(" "),s("el-row",{attrs:{type:"flex"}},[s("el-col",{staticClass:"genset-info-items genset-info-more"},[s("span",[t._v("机组编号："+t._s(t.GensetInfo&&t.GensetInfo.CollectorToken))]),t._v(" "),s("span",[t._v("发动机型号："+t._s(t.GensetInfo&&t.GensetInfo.EngineModel||"-"))]),t._v(" "),s("span",[t._v("功率(KW)："+t._s(t.GensetInfo&&t.GensetInfo.RatedPower||"-"))]),t._v(" "),s("span",[t._v("累计运行时长："+t._s(t.GensetInfo&&t.GensetInfo.TotalRunTime||"-"))]),t._v(" "),s("span",[t._v("当前位置："+t._s(t.GensetInfo&&t.GensetInfo.InstallationSite||"-"))])])],1)],1)},staticRenderFns:[]};var Ce=a("VU/8")(be,ye,!1,function(e){a("BeAg")},"data-v-12d9de0e",null).exports,Ie=a("I4G/"),Pe=a("YTY5"),je={name:"ProjectGensets",components:{AddCrewDialog:K,AddOrEditParallelCrewDialog:Z,SetElectronicFenceDialog:se,StrategyEditDialog:fe,StrategyShowDialog:_e,GensetInfo:Ce,ControllerConfiguration:Ie.default,GensetProgress:Pe.default},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&(this.$set(this,"ProjectId",e.ProjectId),this.$set(this,"projectStatus",e.Status))},deep:!0,immediate:!0}},data:function(){return{loading_4:!1,loading_5:!1,dialogEditVisible:!1,ProjectId:null,projectStatus:null,crewColumns:C.a.crewColumns(this),gensetTableData:[],crewManageVisible:!1,parallelColumns:C.a.parallelColumns(this),parallelTableData:[],parallelCerwManageVisible:!1,parallelCerwInfo:null,options:{index:!0,labelIndex:"序号",props:{width:120}},gensetId:null,electronicFenceDialogVisible:!1,setFenceType:null,editStrategyDialogVisible:!1,setStrategyType:null,showStrategyDialogVisible:!1,isExpand:!1,direction:"rtl",activeName:"1",configData:{},isExpandProgress:!1}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,this.projectStatus=this.currentProject.Status,this.initData()},methods:{initData:function(){this.getProjectGensetList(),this.getProjectParallelList()},getProjectGensetList:function(){var e=this;this.loading_4=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectJoinGensetManageExpand(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.dataTotal=t.Data.TotalItemCount,e.gensetTableData=t.Data.Data.map(function(e){return i()({ID:e.ProjectJoinGensetId,IsParallel:e.IsParallel,IsFenceOpen:e.IsFenceOpen,IsStrategy:e.IsStrategy},e.GeneratorSet)})),e.loading_4=!1})},handleAddCrew:function(){this.crewManageVisible=!0},handleLimitCrew:function(e){},handleControllerConfiguration:function(e,t){this.configData={activeTab:0==t?11:15,projectId:this.ProjectId,gensetId:e.GeneratorSetId,type:t},this.isExpand=!0},handleDeleteCrew:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"移除机组",message:a("div",[a("p",[a("span","确定从当前项目移除"),a("em",{style:"color: #1ABC9C;margin: 0 4px;"},e.CollectorToken),a("span","吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.ID};t.$api.project.DeleteGensetProjectJoinGenset(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"移除机组成功!"}),t.getProjectGensetList()):t.$message({type:"error",message:"移除机组失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},setElectronicFenceSwitch:function(e,t){var a=this;if(t)this.setElectronicFenceInfo(e,"add");else{var s=this.$createElement;this.$confirm("操作提示",{title:"关闭电子围栏",message:s("div",[s("p",[s("span","确定关闭当前机组电子围栏吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.closeFenceClick(e)}).catch(function(){a.$message({type:"info",message:"已取消"})})}},closeFenceClick:function(e){var t=this,a={id:e.GeneratorSetId};this.$api.project.GensetFenceSetting({IsOpen:!1},a).then(function(a){t.$message.success(a.Message),e.IsFenceOpen=!1}).catch(function(e){t.$message.error(e)})},setElectronicFenceInfo:function(e,t){this.setFenceType=t,this.gensetId=e.GeneratorSetId,this.electronicFenceDialogVisible=!0},setStrategySwitch:function(e,t){this.handleAddStrategy(e)},handleAddStrategy:function(e){this.configData={activeTab:14,projectId:this.ProjectId,gensetId:e.GeneratorSetId,type:1},this.isExpand=!0},handleEditStrategy:function(e){this.configData={activeTab:14,projectId:this.ProjectId,gensetId:e.GeneratorSetId,type:1},this.isExpand=!0},handleCloseStrategy:function(e){var t=this,a={GensetId:e.GeneratorSetId};this.$api.project.CloseMaintenanceGensetSetting({},a).then(function(a){t.$message.success(a.Message),e.IsStrategy=!1}).catch(function(e){t.$message.error(e)})},handleShowStrategy:function(e){this.gensetId=e.GeneratorSetId,this.showStrategyDialogVisible=!0},handleClose:function(e){this.isExpand=!1,this.initData()},handleManageCrewProgress:function(e){this.configData={projectId:this.ProjectId,gensetId:e.GeneratorSetId},this.isExpandProgress=!0},handleCloseDrawer:function(){this.isExpandProgress=!1},closeCrewDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.getProjectGensetList()},getProjectParallelList:function(){var e=this;this.loading_5=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectParallelManage(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.parallelTableData=t.Data.Data.map(function(e){return{ID:e.ProjectParallelId,ParallelName:e.ParallelName,ParallelJoinGensetIsMain:e.ParallelJoinGensetIsMain.map(function(e){return e.Genset.DisplayName}).join(),ParallelJoinGensetIsNotMain:e.ParallelJoinGensetIsNotMain.map(function(e){return e.Genset.DisplayName}).join(),GensetTotal:e.ParallelJoinGensetIsMain.length+e.ParallelJoinGensetIsNotMain.length,selectHostIds:e.ParallelJoinGensetIsMain.map(function(e){return e.Genset.GeneratorSetId}),selectExtensionIds:e.ParallelJoinGensetIsNotMain.map(function(e){return e.Genset.GeneratorSetId})}})),e.loading_5=!1})},handleAddParallelCrew:function(){this.parallelCerwInfo=null,this.parallelCerwManageVisible=!0},handleEditParallelCrew:function(e){this.parallelCerwInfo=e,this.parallelCerwManageVisible=!0},handleDeleteParallelCrew:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"解除并机",message:a("div",[a("p","确定解除当前并机吗？"),a("p",[a("span","解除后，相关并机将变更为"),a("em",{style:"color: #1ABC9C;margin: 0 4px;"},"单机组"),a("span","状态，仍存在于本项目。")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.ID};t.$api.project.DeleteGensetProjectParallel(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"解除并机成功!"}),t.getProjectParallelList(),t.getProjectGensetList()):t.$message({type:"error",message:"解除并机失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleBackClick:function(){this.$router.push({path:"/project/project-list"})},closeDialog:function(e,t){if(this[e]=!1,t&&t.refresh)switch(e){case"dialogEditVisible":this.getProjectBasicInfo();break;case"fileUploadVisible":this.getProjectFileList();break;case"personnelManageVisible":this.getProjectUserList();break;case"crewManageVisible":this.getProjectGensetList();break;case"parallelCerwManageVisible":this.getProjectParallelList(),this.getProjectGensetList()}}}},De={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"project-detail"},[a("div",{staticClass:"project-info-item"},[a("p",{staticClass:"content-title"},[e._v("\n        项目机组\n        "),3!==e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleAddCrew()}}},[e._v("添加机组")]):e._e()],1),e._v(" "),a("div",{staticClass:"item-content crew-list"},[a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_4,expression:"loading_4"}],attrs:{options:e.options,columns:e.crewColumns,dataSource:e.gensetTableData}},[a("el-table-column",{attrs:{slot:"gensetConfig",label:"机组配置情况 ",width:"280px",align:"center"},slot:"gensetConfig",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"config-list"},[a("div",{class:t.row.IsStrategy?"Completed":"noComplete"},[a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.setStrategySwitch(t.row,!t.row.IsStrategy)}}},[a("span",{staticClass:"text"},[e._v("\n                      维保策略"+e._s(t.row.IsStrategy?"已配置":"未配置")+"\n                      "),a("i",{staticClass:"el-icon-arrow-right"})])])],1),e._v(" "),a("div",{class:t.row.IsFenceOpen?"Completed":"noComplete"},[a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.setElectronicFenceSwitch(t.row,!t.row.IsFenceOpen)}}},[a("span",{staticClass:"text"},[e._v("\n                      电子围栏"+e._s(t.row.IsFenceOpen?"已开启":"未开启")+"\n                      "),a("i",{staticClass:"el-icon-arrow-right"})])])],1)])]}}])}),e._v(" "),a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",width:"208px",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"left"}},[a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.handleControllerConfiguration(t.row,0)}}},[e._v("\n                  控制器配置\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:t.row.IsParallel||3===e.projectStatus},on:{click:function(a){return e.handleDeleteCrew(t.row)}}},[e._v("\n                  移除\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleManageCrewProgress(t.row)}}},[e._v("\n                  工程进度\n                ")]),e._v(" "),t.row.IsFenceOpen&&3!==e.projectStatus?a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.setElectronicFenceInfo(t.row,"edit")}}},[e._v("\n                  修改围栏\n                ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1)]),e._v(" "),a("div",{staticClass:"project-info-item"},[a("p",{staticClass:"content-title"},[e._v("\n        并机组配置\n        "),3!==e.projectStatus?a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleAddParallelCrew()}}},[e._v("\n          新建并机\n        ")]):e._e()],1),e._v(" "),a("div",{staticClass:"item-content parallel-list"},[a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_5,expression:"loading_5"}],attrs:{options:e.options,columns:e.parallelColumns,dataSource:e.parallelTableData}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.handleEditParallelCrew(t.row)}}},[e._v("\n                  编辑\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.handleDeleteParallelCrew(t.row)}}},[e._v("\n                  解除并机\n                ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1)])]),e._v(" "),e.crewManageVisible?a("AddCrewDialog",{attrs:{projectId:e.ProjectId},on:{closeDialog:function(t){return e.closeDialog("crewManageVisible",t)}}}):e._e(),e._v(" "),e.parallelCerwManageVisible?a("AddOrEditParallelCrewDialog",{attrs:{projectId:e.ProjectId,parallelCerwInfo:e.parallelCerwInfo},on:{closeDialog:function(t){return e.closeDialog("parallelCerwManageVisible",t)}}}):e._e(),e._v(" "),e.electronicFenceDialogVisible?a("SetElectronicFenceDialog",{attrs:{setFenceType:e.setFenceType,gensetId:e.gensetId},on:{closeDialog:function(t){return e.closeCrewDialog("electronicFenceDialogVisible",t)}}}):e._e(),e._v(" "),e.editStrategyDialogVisible?a("StrategyEditDialog",{attrs:{setStrategyType:e.setStrategyType,gensetId:e.gensetId},on:{closeDialog:function(t){return e.closeCrewDialog("editStrategyDialogVisible",t)}}}):e._e(),e._v(" "),e.showStrategyDialogVisible?a("StrategyShowDialog",{attrs:{gensetId:e.gensetId},on:{closeDialog:function(t){return e.closeCrewDialog("showStrategyDialogVisible",t)}}}):e._e(),e._v(" "),e.isExpand?a("el-drawer",{staticClass:"genset-config-drawer",attrs:{title:"",visible:e.isExpand,direction:e.direction,"with-header":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.isExpand=t}}},[a("genset-info",{ref:"gensetInfo",attrs:{configData:e.configData},on:{handleClose:e.handleClose}}),e._v(" "),a("el-tabs",{staticClass:"genset-tabs",model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{key:"1",attrs:{label:"机组配置",name:"1"}})],1),e._v(" "),a("ControllerConfiguration",{attrs:{configData:e.configData}})],1):e._e(),e._v(" "),e.isExpandProgress?a("el-drawer",{attrs:{title:"",visible:e.isExpandProgress,direction:e.direction,"with-header":!1,"before-close":e.handleCloseDrawer},on:{"update:visible":function(t){e.isExpandProgress=t}}},[a("genset-info",{ref:"gensetInfo",attrs:{configData:e.configData},on:{handleClose:e.handleCloseDrawer}}),e._v(" "),a("GensetProgress",{attrs:{configData:e.configData}})],1):e._e()],1)},staticRenderFns:[]};var we=a("VU/8")(je,De,!1,function(e){a("ylaL")},"data-v-a225a530",null).exports,Se=a("1mzX"),Te={name:"ProjectMonitoringNew",components:{ProjectSelect:a("6Vh6").a},data:function(){return{times:0,crewList:[],myCharts:[],crewListMu:[],realTimeData:{},projectInfo:{},editType:!1,animation:null,resizeFun:null,ecuCodeData:{flag:!1,dataArr:[],dataObj:{}},projectInfo2:{},warningDatas:{},defaultGensetData:{},refreshInterval:1e4,firstRenderChartFlag:!1,nowTime:(new Date).toLocaleString(),mapping:{projectType:["","运维","代运维"],projectStatus:["","准备中","进行中","已完成"],crewStatus:["离线","停机","警告","报警","运行"],crewStatusColor:[Se.a.crewStatusMapping.offline,Se.a.crewStatusMapping.stop,Se.a.crewStatusMapping.warning,Se.a.crewStatusMapping.error,Se.a.crewStatusMapping.running]},queryOpt:{workType:[{label:"电站管理模式",value:0},{label:"就地并机模式",value:1},{label:"单机模式",value:2},{label:"单机并网模式",value:3},{label:"单机AMF模式",value:4}],dispatchType:[{label:"默认调度",value:0},{label:"云端+本地调度",value:1},{label:"多台开机调度",value:2}]},option_1:{grid:{top:"16px",right:"16px",bottom:"16px",left:"16px",containLabel:!0},series:[{type:"gauge",radius:"90%",min:0,max:2e3,axisLine:{lineStyle:{width:5,color:[[.3,"#67e0e3"],[.7,"#37a2da"],[1,"#fd666d"]]}},pointer:{width:2,itemStyle:{color:"auto"}},axisTick:{distance:-5,length:2,lineStyle:{color:"#fff",width:1}},splitLine:{distance:-5,length:5,lineStyle:{color:"#fff",width:2}},axisLabel:{color:"#0099FF",distance:8,fontSize:8,formatter:function(e){return e.toFixed(0)}},detail:{valueAnimation:!0,formatter:" {value} RPM",color:"inherit",fontSize:10,width:60,lineHeight:16,overflow:"break",offsetCenter:[0,"40%"]},data:[{value:0,name:"",title:{fontSize:10,offsetCenter:["0%","40%"]}}]}]},queryForm:{workType:"",dispatchType:"",dispatchNumber:0}}},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&(e&&(this.projectInfo=e),this.projectInfo.timeStr=Object(u.d)(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),this.firstRenderChartFlag=!1,this.getMchInfo())},deep:!0,immediate:!0}},methods:i()({checkEcuInfo:function(e){var t=this;this.$api.project.SearchGensetConfigureEcuCodeByNowData({},{type:1,value:"000100000001"}).then(function(e){var a=e.Data;if(a){var s={flag:!1,dataArr:[],dataObj:{}};a.List&&a.List.length>0?(s.flag=!0,s.dataArr=a.List):(s.flag=!1,s.dataObj=a),t.ecuCodeData=s}})},initData:function(){this.getMchInfo()},progressFormat:function(e){return 5*e+"kw"},linkTo:function(e,t){window.open("/#"+t+"?type=newPage&crewId="+e)}},Object(r.b)(["toggleSelectCrew"]),{getMchInfo:function(){var e=this;this.$api.project.getGensetProjectJoinGensetNowData({ProjectId:this.projectInfo.ProjectId||3}).then(function(t){var a=t.Data;if(a){e.realTimeData=a,e.defaultGensetData=a.DefaultGenset,e.projectInfo.allP=e.defaultGensetData.RatedPower,e.projectInfo.realP=Number(e.defaultGensetData.PowerSection)||0,e.projectInfo.percentageP=0===Number(e.projectInfo.allP)?0:Number((100*e.projectInfo.realP/e.projectInfo.allP).toFixed(0));var s=a.GensetAlarmList,n=a.ProjectGenSetList,o=a.ProjectGenSetParallelList;if(n){var r=new Array;if(n.forEach(function(e){var t=i()({},e,{DisplayName:e.GeneratorSet.DisplayName},e.GeneratorSet,e.NowData),a="";t.fpie_001_11&&"1"==t.fpie_001_11.Value&&(a="磨合期"),t.fpie_001_11&&"1"==t.fpie_001_12.Value&&(a="健康期"),t.fpie_001_11&&"1"==t.fpie_001_13.Value&&(a="老化期"),t.fpie_001_11&&"1"==t.fpie_001_14.Value&&(a="延寿期"),t.statusFlagLabel=a,r.push(t)}),e.crewList=r,r.length>0)r[0]}if(o){var l=new Array;o.forEach(function(e){var t=[];e.ParallelJoinGensetIsMain&&e.ParallelJoinGensetIsMain.forEach(function(e){var a=i()({},e,{DisplayName:e.Genset.DisplayName},e.NowData,e.Genset),s="";a.fpie_001_11&&"1"==a.fpie_001_11.Value&&(s="磨合期"),a.fpie_001_11&&"1"==a.fpie_001_12.Value&&(s="健康期"),a.fpie_001_11&&"1"==a.fpie_001_13.Value&&(s="老化期"),a.fpie_001_11&&"1"==a.fpie_001_14.Value&&(s="延寿期"),a.statusFlagLabel=s,t.push(a)}),e.ParallelJoinGensetIsNotMain&&e.ParallelJoinGensetIsNotMain.forEach(function(e){var a=i()({},e,{DisplayName:e.Genset.DisplayName},e.NowData,e.Genset),s="";a.fpie_001_11&&"1"==a.fpie_001_11.Value&&(s="磨合期"),a.fpie_001_12&&"1"==a.fpie_001_12.Value&&(s="健康期"),a.fpie_001_13&&"1"==a.fpie_001_13.Value&&(s="老化期"),a.fpie_001_14&&"1"==a.fpie_001_14.Value&&(s="延寿期"),a.statusFlagLabel=s,t.push(a)}),l.push(t)}),e.crewListMu=l}if(s){var d=[],p=[];(s||[]).forEach(function(e,t){var a={order:t,time:Object(u.d)(e.Time).format("yyyy-MM-DD HH:mm:ss"),mchname:e.GensetName,divisionmch:"测试分机组",warningcontent:e.Content,warningtype:e.Type,operation:"查看"};d.push(a)}),[].forEach(function(e,t){var a={order:t,unit:e.GensetName,plandate:Object(u.d)(e.Time).format("YYYY-MM-DD"),type:e.Type,operation:"查看",keepContent:e.Content};p.push(a)}),e.warningDatas={d1:[].concat(c()(d.map(function(e){return"实时报警："+e.mchname+"&nbsp;-&nbsp;"+e.warningcontent}))),d2:[].concat(c()(p.map(function(e){return"保养提醒："+e.unit+e.keepContent})))}}}e.$nextTick(function(){e.firstRenderChartFlag||(e.init(),e.firstRenderChartFlag=!0),e.firstRenderChartFlag&&e.refreshData()})})},init:function(){var e=this;this.crewList.forEach(function(t){var a=document.getElementById("crew-speed-echart-"+t.GeneratorSetId),s=e.$echarts.init(a);e.option_1.series[0].data[0].value=t.r_032&&t.r_032.Value||0,e.option_1.series[0].detail.formatter=function(e){return e.toFixed(0)+(t.r_032&&t.r_032.Unit||"")},s.setOption(e.option_1),e.myCharts.push(s)}),this.crewListMu.forEach(function(t){t.forEach(function(t){var a=document.getElementById("crew-speed-echart-"+t.GeneratorSetId),s=e.$echarts.init(a);e.option_1.series[0].data[0].value=t.r_032&&t.r_032.Value||0,e.option_1.series[0].detail.formatter=function(e){return e.toFixed(0)+(t.r_032&&t.r_032.Unit||"")},s.setOption(e.option_1),e.myCharts.push(s)})})},refreshData:function(){var e=this;this.crewList.forEach(function(t,a){e.option_1.series[0].data[0].value=t.r_032&&t.r_032.Value||0,e.myCharts[a].setOption(e.option_1)}),this.crewListMu.forEach(function(t){t.forEach(function(t,a){e.option_1.series[0].data[0].value=t.r_032&&t.r_032.Value||0,e.myCharts[a].setOption(e.option_1)})})}}),mounted:function(){var e=this;this.animation&&(clearInterval(this.animation),this.animation=null),this.animation=setInterval(function(){e.times++,console.info("%crefresh %c"+e.times+"%c times","color:green;","color:tomato;font-weight:bold","color:green;"),e.getMchInfo()},this.refreshInterval),this.resizeFun=function(){e.myCharts.forEach(function(e){e.resize()})},window.addEventListener("resize",this.resizeFun)},beforeDestroy:function(){clearInterval(this.animation),window.removeEventListener("resize",this.resizeFun),this.resizeFun=null}},xe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{attrs:{id:"project-monitoring-new"}},[a("div",{staticClass:"project-select"},[a("project-select")],1),e._v(" "),a("div",{staticClass:"query-box",attrs:{hidden:""}},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"a-items"},[a("div",{staticClass:"label"},[e._v("项目工作模式：")]),e._v(" "),e.editType?a("div",{staticClass:"form-item"},[a("el-select",{model:{value:e.queryForm.workType,callback:function(t){e.$set(e.queryForm,"workType",t)},expression:"queryForm.workType"}},e._l(e.queryOpt.workType,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):a("div",{staticClass:"value"},[e._v("就地并机模式")])])]),e._v(" "),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"a-items"},[a("div",{staticClass:"label"},[e._v("云调度模式：")]),e._v(" "),e.editType?a("div",{staticClass:"form-item"},[a("el-select",{model:{value:e.queryForm.dispatchType,callback:function(t){e.$set(e.queryForm,"dispatchType",t)},expression:"queryForm.dispatchType"}},e._l(e.queryOpt.dispatchType,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):a("div",{staticClass:"value"},[e._v("云端+本地调度")])])]),e._v(" "),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"a-items"},[a("div",{staticClass:"label"},[e._v("调度启动台数：")]),e._v(" "),e.editType?a("div",{staticClass:"form-item"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.queryForm.dispatchNumber,callback:function(t){e.$set(e.queryForm,"dispatchNumber",t)},expression:"queryForm.dispatchNumber"}})],1):a("div",{staticClass:"value"},[e._v("2")])])]),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.editType,expression:"!editType"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){e.editType=!0}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editType,expression:"editType"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){e.editType=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editType,expression:"editType"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){e.editType=!1}}},[e._v("保存")])],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"time-info",attrs:{align:"middle",type:"flex",justify:"end"}},[e._v("\n            数据最近更新时间："+e._s(e.nowTime)+"\n            "),a("svg-icon",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{"icon-class":"refresh"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"statistical-data-box"},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",{staticClass:"data-item-box",attrs:{span:8}},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",{staticClass:"data-item",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetAll))]),e._v(" "),a("p",[e._v("机组总数")])]),e._v(" "),a("el-col",{staticClass:"data-item",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetSingleCount))]),e._v(" "),a("p",[e._v("单机台数")])]),e._v(" "),a("el-col",{staticClass:"data-item",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetParallelCount))]),e._v(" "),a("p",[e._v("并机组数")])]),e._v(" "),a("el-col",{staticClass:"data-item",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetCloseCount))]),e._v(" "),a("p",[e._v("合闸总数")])]),e._v(" "),a("el-col",{staticClass:"data-item",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetGroupCount))]),e._v(" "),a("p",[e._v("机组群容量")])])],1)],1),e._v(" "),a("el-col",{staticClass:"data-item-box",attrs:{span:8}},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",{staticClass:"data-item color-alarm",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetStatusAlarm))]),e._v(" "),a("p",[e._v("报警")])]),e._v(" "),a("el-col",{staticClass:"data-item color-warning",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetStatusWarn))]),e._v(" "),a("p",[e._v("警告")])]),e._v(" "),a("el-col",{staticClass:"data-item color-run",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetStatusRun))]),e._v(" "),a("p",[e._v("运行")])]),e._v(" "),a("el-col",{staticClass:"data-item color-stop",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetStatusStop))]),e._v(" "),a("p",[e._v("停机")])]),e._v(" "),a("el-col",{staticClass:"data-item color-offline",attrs:{span:6}},[a("p",[e._v(e._s(e.realTimeData.GensetStatusOffline))]),e._v(" "),a("p",[e._v("离线")])])],1)],1),e._v(" "),a("el-col",{staticClass:"data-item-box",attrs:{span:8}},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("div",{staticClass:"item",attrs:{title:""}},[a("p",[e._v("- h")]),e._v(" "),a("p",[e._v("平均无故障时长")])]),e._v(" "),a("div",{staticClass:"item",attrs:{title:"=机组超功率运行时长之和"}},[a("p",[e._v("- h")]),e._v(" "),a("p",[e._v("超功率运行时长")])]),e._v(" "),a("div",{staticClass:"item",attrs:{title:"=机组平均负荷率之和/机组数"}},[a("p",[e._v("-")]),e._v(" "),a("p",[e._v("平均负荷率")])]),e._v(" "),a("div",{staticClass:"item",attrs:{title:"=机组平均负荷之和/机组数量"}},[a("p",[e._v("-")]),e._v(" "),a("p",[e._v("平均负荷")])]),e._v(" "),a("div",{staticClass:"item",attrs:{title:"=机组负荷强度之和/机组数量"}},[a("p",[e._v("-")]),e._v(" "),a("p",[e._v("负荷强度")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"middle"},[a("div",{staticClass:"progress"},[a("div",{staticClass:"a-progress"},[a("div",{staticClass:"label",attrs:{title:"=机组功率之和"}},[e._v("\n            项目总功率："+e._s(e.projectInfo.allP||" - ")+"Kw(测试，接口获取)\n          ")]),e._v(" "),a("div",{staticClass:"label2",attrs:{title:"=机组实时功率之和/机组总功率之和"}},[e._v("实时负荷率：-")]),e._v(" "),a("div",{staticClass:"chart"},[a("div",{staticClass:"inner",style:{width:"40%"}})]),e._v(" "),a("div",{staticClass:"real-label"},[a("span",{style:{left:"30%"}},[e._v("实际功率："+e._s("108")+"Kw(测试)")])])]),e._v(" "),a("div",{staticClass:"a-progress",attrs:{hidden:""}},[a("div",{staticClass:"label"},[e._v("项目总负荷率：0%")]),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"real-label"},[a("span",{style:{color:"#84d4f7",left:0===e.defaultGensetData.Fpie_002_05?0:e.defaultGensetData.fpie_002_05-12+"%"}},[e._v("实际负荷率："+e._s(e.defaultGensetData.Fpie_002_05||" - ")+"%")])])]),e._v(" "),a("div",{staticClass:"all-time"},[a("div",{staticClass:"label",attrs:{title:"机组运行时长之和"}},[e._v("\n            项目累计运行时长："+e._s(e.defaultGensetData.RunHourTotal)+"h(测试，接口获取)\n          ")]),e._v(" "),a("div",{staticClass:"chart"},[a("div",{staticClass:"inner1",style:{width:"5%"}}),e._v(" "),a("div",{staticClass:"tri",style:{left:"calc(5% - 17px)"}}),e._v(" "),a("div",{staticClass:"inner2",style:{width:"85%"}}),e._v(" "),a("div",{staticClass:"tri2",style:{left:"calc(90% - 17px)"}}),e._v(" "),a("div",{staticClass:"inner3",style:{width:"10%"}})]),e._v(" "),e._m(1)])]),e._v(" "),a("div",{staticClass:"progress-chart",attrs:{hidden:""}},[a("div",{staticClass:"crew-info-echarts"},[a("div",{staticClass:"crew-info-power"},[e._m(2),e._v(" "),a("div",{staticClass:"progress-box effective-power-box"},[a("el-progress",{attrs:{"show-text":!1,"stroke-width":12,percentage:0,color:"#84d4f7"}}),e._v(" "),a("p",[e._v("总有功峰值负荷率："+e._s(e.defaultGensetData.Fpie_002_07||" - ")+"%")])],1),e._v(" "),a("div",{staticClass:"progress-box invalid-power-box"},[a("el-progress",{attrs:{"show-text":!1,"stroke-width":12,percentage:0,color:"#d7d7d7"}}),e._v(" "),a("p",[e._v("总无功峰值负荷率："+e._s(e.defaultGensetData.Fpie_002_08||" - ")+"%")])],1)]),e._v(" "),a("div",{staticClass:"inner-label"},[e._v("平均负荷率：0%")])])]),e._v(" "),a("div",{staticClass:"triangle"},[e._m(3),e._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"top"},[a("div",[a("div",{staticClass:"value"},[e._v(e._s(e.defaultGensetData.R_064||" - ")+"L")]),e._v(" "),a("div",{staticClass:"label"},[e._v("总燃油用量")])])]),e._v(" "),a("div",{staticClass:"bottom"},[a("div",[a("div",{staticClass:"value"},[e._v(e._s(e.defaultGensetData.R_076||" - ")+"Kwh")]),e._v(" "),a("div",{staticClass:"label"},[e._v("总发电量")])])])])])]),e._v(" "),a("div",{staticClass:"crewInfo-box"},[e._l(e.crewListMu,function(t,s){return a("div",{key:"main-"+s,staticClass:"mu-crew-info-item"},e._l(t,function(t,n){return a("div",{key:"sub-"+s+"&nbsp;-&nbsp;"+n,staticClass:"mu-crew-info-item-one"},[a("div",[a("div",{staticClass:"crew-info-echarts"},[a("div",{staticClass:"crew-info-power"},[e._m(4,!0),e._v(" "),a("div",{staticClass:"progress-box effective-power-box"},[a("el-progress",{attrs:{percentage:Number((Number(t.r_032&&t.r_032.Value||0)/5).toFixed(0)),format:e.progressFormat,color:"#ec808d"}}),e._v(" "),a("p",[e._v("有效功率")])],1),e._v(" "),a("div",{staticClass:"progress-box invalid-power-box"},[a("el-progress",{attrs:{percentage:Number((Number(t.r_036&&t.r_036.Value||0)/5).toFixed(0)),format:e.progressFormat,color:"#caf982"}}),e._v(" "),a("p",[e._v("无效功率")])],1)]),e._v(" "),a("div",{staticClass:"crew-speed-echart",attrs:{id:"crew-speed-echart-"+t.GeneratorSetId}})])]),e._v(" "),a("div",[a("div",{staticClass:"mu-crew-info-item-one-title"},[a("div",{staticClass:"name",attrs:{title:t.DisplayName}},[e._v(e._s(t.DisplayName))])]),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub-label"},[a("el-row",{attrs:{type:"flex",gutter:10}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"status btn",style:{background:e.mapping.crewStatusColor[t.Status]}},[e._v("\n                    "+e._s(e.mapping.crewStatus[t.Status])+"\n                  ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"type btn"},[e._v(e._s(t.IsMain?"并机组主机":"并机组分机"))])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"btn"},[e._v("\n                    "+e._s(t.a_43_03&&"1"==t.a_43_03.Value?"合闸":"分闸")+"\n                  ")])])],1)],1),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub-info"},[a("div",{staticClass:"info"},[e._v("机组寿命："+e._s(t.statusFlagLabel||"磨合期"))]),e._v(" "),a("div",{staticClass:"info"},[e._v("平均无故障时长："+e._s(t.RunHourTotal)+"h")]),e._v(" "),a("div",{staticClass:"info"},[e._v(e._s(t.InstallationSite||" - "))])]),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub1"},[a("el-row",{staticClass:"text"},[a("el-col",{attrs:{span:12}},[e._v("环温："+e._s(t.fpie_001_03&&t.fpie_001_03.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("海拔："+e._s(t.Altitude||" - ")+"m")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("水温："+e._s(t.r_050&&t.r_050.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("油压："+e._s(t.r_051&&t.r_051.Value||" - ")+"KPa")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("转速："+e._s(t.r_047&&t.r_047.Value||" - ")+"RPM")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("油耗："+e._s(t.r_063&&t.r_063.Value||" - ")+"L/h")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU通讯状态："+e._s(t.ecu_status?"0"===(t.ecu_status&&t.ecu_status.Value||" - ")?"正常":"异常":" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU进气温度："+e._s(t.r_060&&t.r_060.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU涡轮状态："+e._s(t.r_062&&t.r_062.Value||" - ")+"bar")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU机油温度："+e._s(t.r_056&&t.r_056.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:24}},[e._v("ECU故障码："+e._s(t.ecu_code&&("000000000000"===t.ecu_code.Value.toString()?"":t.ecu_code.Value)||" - ")+"\n                  "),a("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[e.ecuCodeData.flag?a("div",e._l(e.ecuCodeData.dataArr,function(t,s){return a("div",{key:s},[a("div",{staticStyle:{background:"#e0ffe7",padding:"5px"}},[e._v("\n                          "+e._s(s+1)+"."),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" SPN:")]),e._v(e._s(t.SPN)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" FMI:")]),e._v(e._s(t.FMI)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" 厂商:")]),e._v(" "+e._s(t.Manufacturer)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" 故障名称:")]),e._v(e._s(t.Title)+"\n                        ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!t.Reason,expression:"!!e.Reason"}],staticStyle:{padding:"5px"}},[a("div",{staticStyle:{"font-weight":"bold"}},[e._v("故障原因:")]),e._v(" "),a("div",[e._v(e._s(t.Reason))])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!t.Reaction,expression:"!!e.Reaction"}],staticStyle:{padding:"5px"}},[a("div",[e._v("故障反应:")]),e._v(" "),a("div",[e._v(e._s(t.Reaction))])])])}),0):a("div",[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" SPN ")]),a("span",[e._v(e._s(e.ecuCodeData.dataObj.SPN))])]),e._v(" "),a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" FMI ")]),a("span",[e._v(e._s(e.ecuCodeData.dataObj.FMI))])]),e._v(" "),a("div",[e._v("暂无记录!")])]),e._v(" "),a("span",{staticClass:"check-ecu",attrs:{slot:"reference"},on:{click:function(a){return e.checkEcuInfo(t)}},slot:"reference"},[e._v("查看故障详情(测试)")])])],1)],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub2"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("开始前油量："+e._s(t.fpie_003_08&&t.fpie_003_08.Value||" - ")+"L")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("结束时油量："+e._s(t.fpie_003_09&&t.fpie_003_09.Value||" - ")+"L")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("加油次数："+e._s(t.fpie_003_07&&t.fpie_003_07.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("累计燃油："+e._s(t.r_064&&t.r_064.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均能耗："+e._s(t.fpie_003_18&&t.fpie_003_18.Value||" - ")+"g/Kwh")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("运行时长："+e._s(t.fpie_003_02&&t.fpie_003_02.Value||" - ")+"h")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("超功率运行时长："+e._s(t.fpie_003_19&&t.fpie_003_19.Value||" - "))])],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub3"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("最大功率："+e._s(t.RatedPower)+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("限制功率："+e._s(t.PowerSection||0)+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("实时功率："+e._s(t.r_032&&t.r_032.Value||" - ")+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("功率因数：cosδ="+e._s(t.r_044&&t.r_044.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("APF功率因数："+e._s(t.fpie_002_11&&t.fpie_002_11.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("频率："+e._s(t.r_019&&t.r_019.Value||" - ")+"Hz")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("相电压："+e._s(t.r_013&&t.r_013.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("线电压："+e._s(t.r_010&&t.r_010.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("线电流："+e._s(t.r_025&&t.r_025.Value||" - ")+"A")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("电度："+e._s(t.r_076&&t.r_076.Value||" - ")+"kWh")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("负载谐波含量："+e._s(t.fpie_002_09&&t.fpie_002_09.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("总谐波畸变率："+e._s("--"))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("三相不平衡："+e._s(t.fpie_002_12&&t.fpie_002_12.Value||" - "))])],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub4"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("负荷强度："+e._s(t.fpie_003_11&&t.fpie_003_11.Value||" - ")+"Hz")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("实时负荷率："+e._s(t.fpie_002_05&&t.fpie_002_05.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均负荷："+e._s(t.fpie_003_10&&t.fpie_003_10.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均负荷率："+e._s(t.fpie_002_06&&t.fpie_002_06.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("低负荷时长："+e._s(t.fpie_003_16&&t.fpie_003_16.Value||" - ")+"min")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("高负荷时长："+e._s(t.fpie_003_17&&t.fpie_003_17.Value||" - ")+"min")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("有功负荷强度："+e._s(t.fpie_002_15&&t.fpie_002_15.Value||" - ")+"%")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("无功负荷强度："+e._s(t.fpie_002_16&&t.fpie_002_16.Value||" - ")+"%")])],1),e._v(" "),a("div",{staticClass:"btn-box"},[a("el-button",{staticClass:"btn",on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/equipment/crewmonitor/crew-monitor-info")}}},[e._v("机组监控")]),e._v(" "),a("el-popover",{attrs:{placement:"top",trigger:"click"}},[a("div",[a("el-button",{staticStyle:{margin:"0 0 10px 0"},on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/operation/operationalChart/operationalChartDaily")}}},[e._v("日运维图")]),a("br"),e._v(" "),a("el-button",{on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/operation/operationalChart/operationalChartWeekly")}}},[e._v("周运维图")])],1),e._v(" "),a("el-button",{attrs:{slot:"reference"},slot:"reference"},[e._v("运维图")])],1)],1)],1)])])}),0)}),e._v(" "),e._l(e.crewList,function(t,s){return a("div",{key:"main"+s,staticClass:"mu-crew-info-item"},[a("div",{staticClass:"mu-crew-info-item-one"},[a("div",[a("div",{staticClass:"crew-info-echarts"},[a("div",{staticClass:"crew-info-power"},[e._m(5,!0),e._v(" "),a("div",{staticClass:"progress-box effective-power-box"},[a("el-progress",{attrs:{percentage:Number((Number(t.r_032&&t.r_032.Value||0)/5).toFixed(0)),format:e.progressFormat,color:"#ec808d"}}),e._v(" "),a("p",[e._v("有效功率")])],1),e._v(" "),a("div",{staticClass:"progress-box invalid-power-box"},[a("el-progress",{attrs:{percentage:Number((Number(t.r_032&&t.r_032.Value||0)/5).toFixed(0)),format:e.progressFormat,color:"#caf982"}}),e._v(" "),a("p",[e._v("无效功率")])],1)]),e._v(" "),a("div",{staticClass:"crew-speed-echart",attrs:{id:"crew-speed-echart-"+t.GeneratorSetId}})])]),e._v(" "),a("div",[a("div",{staticClass:"mu-crew-info-item-one-title"},[a("div",{staticClass:"name"},[e._v(e._s(t.DisplayName))])]),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub-label"},[a("el-row",{attrs:{type:"flex",gutter:10}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"btn"},[e._v("\n                    "+e._s(t.a_43_03&&"1"==t.a_43_03.Value?"合闸":"分闸")+"\n                  ")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"btn status",style:{background:e.mapping.crewStatusColor[t.Status]}},[e._v("\n                    "+e._s(e.mapping.crewStatus[t.Status])+"\n                  ")])]),e._v(" "),a("el-col",{attrs:{span:8}}),e._v(" "),a("el-col",{attrs:{span:8}}),e._v(" "),a("el-col",{attrs:{span:8}})],1)],1),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub-info"},[a("div",{staticClass:"info"},[e._v("机组寿命："+e._s(t.statusFlagLabel||"磨合期"))]),e._v(" "),a("div",{staticClass:"info"},[e._v("平均无故障时长："+e._s(t.RunHourTotal)+"h")]),e._v(" "),a("div",{staticClass:"info"},[e._v(e._s(t.InstallationSite||" - "))])]),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub1"},[a("el-row",{staticClass:"text"},[a("el-col",{attrs:{span:12}},[e._v("环温："+e._s(t.fpie_001_03&&t.fpie_001_03.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("海拔："+e._s(t.Altitude||" - ")+"m")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("水温："+e._s(t.r_050&&t.r_050.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("油压："+e._s(t.r_051&&t.r_051.Value||" - ")+"KPa")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("转速："+e._s(t.r_047&&t.r_047.Value||" - ")+"RPM")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("油耗："+e._s(t.r_063&&t.r_063.Value||" - ")+"L/h")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU通讯状态："+e._s(t.ecu_status?"0"===(t.ecu_status&&t.ecu_status.Value||" - ")?"正常":"异常":" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU进气温度："+e._s(t.r_060&&t.r_060.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU涡轮状态："+e._s(t.r_062&&t.r_062.Value||" - ")+"bar")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("ECU机油温度："+e._s(t.r_056&&t.r_056.Value||" - ")+"℃")]),e._v(" "),a("el-col",{attrs:{span:24}},[e._v("ECU故障码："+e._s(t.ecu_code&&("000000000000"===t.ecu_code.Value.toString()?"":t.ecu_code.Value)||" - ")+"\n                  "),a("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[e.ecuCodeData.flag?a("div",e._l(e.ecuCodeData.dataArr,function(t,s){return a("div",{key:s},[a("div",{staticStyle:{background:"#e0ffe7",padding:"5px"}},[e._v("\n                          "+e._s(s+1)+"."),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" SPN:")]),e._v(e._s(t.SPN)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" FMI:")]),e._v(e._s(t.FMI)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" 厂商:")]),e._v(" "+e._s(t.Manufacturer)+"\n                          "),a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" 故障名称:")]),e._v(e._s(t.Title)+"\n                        ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!t.Reason,expression:"!!e.Reason"}],staticStyle:{padding:"5px"}},[a("div",{staticStyle:{"font-weight":"bold"}},[e._v("故障原因:")]),e._v(" "),a("div",[e._v(e._s(t.Reason))])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!t.Reaction,expression:"!!e.Reaction"}],staticStyle:{padding:"5px"}},[a("div",[e._v("故障反应:")]),e._v(" "),a("div",[e._v(e._s(t.Reaction))])])])}),0):a("div",[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" SPN ")]),a("span",[e._v(e._s(e.ecuCodeData.dataObj.SPN))])]),e._v(" "),a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v(" FMI ")]),a("span",[e._v(e._s(e.ecuCodeData.dataObj.FMI))])]),e._v(" "),a("div",[e._v("暂无记录!")])]),e._v(" "),a("span",{staticClass:"check-ecu",attrs:{slot:"reference"},on:{click:function(a){return e.checkEcuInfo(t)}},slot:"reference"},[e._v("查看故障详情(测试)")])])],1)],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub2"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("开始前油量："+e._s(t.fpie_003_08&&t.fpie_003_08.Value||" - ")+"L")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("结束时油量："+e._s(t.fpie_003_09&&t.fpie_003_09.Value||" - ")+"L")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("加油次数："+e._s(t.fpie_003_07&&t.fpie_003_07.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("累计燃油："+e._s(t.r_064&&t.r_064.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均能耗："+e._s(t.fpie_003_18&&t.fpie_003_18.Value||" - ")+"g/Kwh")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("运行时长："+e._s(t.fpie_003_02&&t.fpie_003_02.Value||" - ")+"h")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("超功率运行时长："+e._s(t.fpie_003_19&&t.fpie_003_19.Value||" - "))])],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub3"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("最大功率："+e._s(t.RatedPower)+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("限制功率："+e._s(t.PowerSection||0)+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("实时功率："+e._s(t.r_032&&t.r_032.Value||" - ")+"Kw")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("功率因数：cosδ="+e._s(t.r_044&&t.r_044.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("APF功率因数："+e._s(t.fpie_002_11&&t.fpie_002_11.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("频率："+e._s(t.r_019&&t.r_019.Value||" - ")+"Hz")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("相电压："+e._s(t.r_013&&t.r_013.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("线电压："+e._s(t.r_010&&t.r_010.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("线电流："+e._s(t.r_025&&t.r_025.Value||" - ")+"A")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("电度："+e._s(t.r_076&&t.r_076.Value||" - ")+"kWh")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("负载谐波含量："+e._s(t.fpie_002_09&&t.fpie_002_09.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("总谐波畸变率："+e._s("--"))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("三相不平衡："+e._s(t.fpie_002_12&&t.fpie_002_12.Value||" - "))])],1)],1),e._v(" "),a("div",{staticClass:"split"}),e._v(" "),a("div",{staticClass:"mu-crew-info-item-one-sub4"},[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("负荷强度："+e._s(t.fpie_003_11&&t.fpie_003_11.Value||" - ")+"Hz")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("实时负荷率："+e._s(t.fpie_002_05&&t.fpie_002_05.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均负荷："+e._s(t.fpie_003_10&&t.fpie_003_10.Value||" - ")+"V")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("平均负荷率："+e._s(t.fpie_002_06&&t.fpie_002_06.Value||" - "))]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("低负荷时长："+e._s(t.fpie_003_16&&t.fpie_003_16.Value||" - ")+"min")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("高负荷时长："+e._s(t.fpie_003_17&&t.fpie_003_17.Value||" - ")+"min")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("有功负荷强度："+e._s(t.fpie_002_15&&t.fpie_002_15.Value||" - ")+"%")]),e._v(" "),a("el-col",{attrs:{span:12}},[e._v("无功负荷强度："+e._s(t.fpie_002_16&&t.fpie_002_16.Value||" - ")+"%")])],1),e._v(" "),a("div",{staticClass:"btn-box"},[a("el-button",{staticClass:"btn",on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/equipment/crewmonitor/crew-monitor-info")}}},[e._v("机组监控")]),e._v(" "),a("el-popover",{attrs:{placement:"top",trigger:"click"}},[a("div",[a("el-button",{staticStyle:{margin:"0 0 10px 0"},on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/operation/operationalChart/operationalChartDaily")}}},[e._v("日运维图")]),a("br"),e._v(" "),a("el-button",{on:{click:function(a){return e.linkTo(t.GeneratorSetId,"/operation/operationalChart/operationalChartWeekly")}}},[e._v("周运维图")])],1),e._v(" "),a("el-button",{attrs:{slot:"reference"},slot:"reference"},[e._v("运维图")])],1)],1)],1)])])])})],2)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"chart"},[t("div",{staticClass:"inner",staticStyle:{width:"0%",background:"#84d4f7"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"real-label"},[t("span",{staticClass:"label1"},[this._v("低负荷运行时长：-h(测试)")]),this._v(" "),t("span",{staticClass:"label2"},[this._v("高负荷运行时长：-h(测试)")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"target-power-box"},[t("span")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"left"},[t("p",{attrs:{title:"=机组开始前油量之和"}},[this._v("开始前油量：-")]),this._v(" "),t("p",{attrs:{title:"=机组结束时油量之和"}},[this._v("结束时油量：-")]),this._v(" "),t("p",{attrs:{title:"=机组加油次数之和"}},[this._v("累计加油次数：-")]),this._v(" "),t("p",{attrs:{title:"=总燃油量/总发电量"}},[this._v("能耗：-")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"target-power-box"},[a("em",{staticClass:"left-text"},[e._v("目"),a("br"),e._v("标"),a("br"),e._v("功"),a("br"),e._v("率")]),e._v(" "),a("span"),e._v(" "),a("em",{staticClass:"right-text"},[e._v("500"),a("br"),e._v("Kw")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"target-power-box"},[a("em",{staticClass:"left-text"},[e._v("目"),a("br"),e._v("标"),a("br"),e._v("功"),a("br"),e._v("率")]),e._v(" "),a("span"),e._v(" "),a("em",{staticClass:"right-text"},[e._v("300"),a("br"),e._v("Kw")])])}]};var Ge=a("VU/8")(Te,xe,!1,function(e){a("bkrD"),a("ofIw")},"data-v-83de29c4",null).exports,$e=a("cxxR"),ke=a("Ayik"),Fe={name:"GensetProgress",components:{ProjectProgressRecords:$e.default},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&(this.$set(this,"ProjectId",e.ProjectId),this.$set(this,"projectStatus",e.Status))},deep:!0,immediate:!0}},data:function(){return{loading:!1,ProjectId:null,projectStatus:null,crewColumns:ke.a.crewManageColumns(this),crewDataSource:[],eventTypeEnum:ke.a.eventTypeEnum,eventStatusEnum:ke.a.eventStatusEnum,searchForm:{type:"",type1:""},columns:ke.a.projectProgressColumns(this),dataSource:[],options:{index:!0,labelIndex:"序号",props:{width:126}},selectItem:null,RecordsDialogVisible:!1,recordParmas:null}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,this.initData()},methods:{initData:function(){this.queryTableData()},queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId,ProgressType:1};this.$api.project.GetGensetProjectProgressSetting(t).then(function(t){1===t.Code&&e.$set(e,"dataSource",t.Data),e.loading=!1}).catch(function(){e.loading=!1})},reset:function(){this.$set(this,"searchForm",{type:"",type1:""})},handleProjectProgressClick:function(e){this.recordParmas={ProjectId:this.ProjectId,ProjectProgressId:e.ProgressId,IsGenset:e.IsGenset,IsGensetMult:e.IsGensetMult,projectStatus:this.projectStatus},this.RecordsDialogVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleBackClick:function(){this.$router.push({path:"/project/crew-manage",query:{ProjectId:this.ProjectId}})}}},Le={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"project-progress-manage"},[a("p",{staticClass:"content-title"},[e._v("项目机组工程进度（整体）")]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleProjectProgressClick(t.row)}}},[e._v("\n            工程进度管理\n          ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("el-dialog",{staticClass:"progress-records-dialog",attrs:{title:"工程进度记录",width:"60%",visible:e.RecordsDialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0},on:{"update:visible":function(t){e.RecordsDialogVisible=t},close:function(t){return e.closeDialog("RecordsDialogVisible")}}},[e.RecordsDialogVisible?a("ProjectProgressRecords",{attrs:{recordParmas:e.recordParmas}}):e._e()],1)],1)},staticRenderFns:[]};var Re=a("VU/8")(Fe,Le,!1,function(e){a("eh7k")},"data-v-5f704add",null).exports,Ve=a("rgaR"),Ee=[{value:1,label:"收入"},{value:2,label:"支出"}],Me={CostTypeEnum:Ee,costManageColumns:function(e){return[{label:"开支类型",prop:"Type",minWidth:"20%",formatter:function(e,t,a){return e.Type?Ee.find(function(t){return t.value==e.Type}).label:""}},{label:"开支项目",prop:"SortName",minWidth:"20%"},{label:"项目金额",prop:"Money",minWidth:"20%",unit:"元"},{label:"开支说明",prop:"CostDetail",minWidth:"35%"},{label:"开支图片",prop:"FileUrl",minWidth:"18%",formatter:function(e,t,a){return e.FileUrl?'<span style="color:#409EFF;cursor: pointer">点击查看</span>':""},click:function(t,a){console.log(t,a,e),e.handleClickShowImg(t,a)}},{label:"修改人",prop:"CreateUserName",minWidth:"20%"},{label:"修改时间",prop:"CreateTime",minWidth:"25%",formatter:function(t,a,s){return t.CreateTime?e.$moment(t.CreateTime).format("yyyy-MM-DD HH:mm:ss"):""}}]},costAggregationColumns:function(e){return[{label:"开支类型",prop:"Type",minWidth:"25%",formatter:function(e,t,a){return e.Type?Ee.find(function(t){return t.value==e.Type}).label:""}},{label:"开支项目",prop:"SortName",minWidth:"25%"},{label:"项目总金额",prop:"AllMoney",minWidth:"25%",unit:"元",formatter:function(e,t,a){return e.AllMoney||0}},{label:"项目笔数",prop:"AllCount",minWidth:"25%",formatter:function(e,t,a){return e.AllCount||0}}]},CompletionReportColumns:function(e){return[{label:"完工报告",prop:"ProgressName",minWidth:"25%"},{label:"完成情况",prop:"CollectorToken",minWidth:"25%",formatter:function(e,t,a){return 0==e.RecordCount?"待完成":"已完成"}},{label:"修改人",prop:"LastCreateUserName",minWidth:"25%",formatter:function(e,t,a){return e.LastCreateUserName||"-"}},{label:"修改时间",prop:"LastCreateTime",minWidth:"25%",formatter:function(t,a,s){return t.RecordCount>0?t.LastCreateTime?e.$moment(t.LastCreateTime).format("yyyy-MM-DD HH:mm:ss"):"":"-"}}]},CustomerSatisfactionColumns:function(e){return[{label:"客户满意度",prop:"ProgressName",minWidth:"25%"},{label:"完成情况",prop:"CollectorToken",minWidth:"25%",formatter:function(e,t,a){return 0==e.RecordCount?"待完成":"已完成"}},{label:"修改人",prop:"LastCreateUserName",minWidth:"25%",formatter:function(e,t,a){return e.LastCreateUserName||"-"}},{label:"修改时间",prop:"LastCreateTime",minWidth:"25%",formatter:function(t,a,s){return t.RecordCount>0?t.LastCreateTime?e.$moment(t.LastCreateTime).format("yyyy-MM-DD HH:mm:ss"):"":"-"}}]},OperationReportColumns:function(e){return[{label:"运维报告",prop:"ProgressName",minWidth:"25%"},{label:"完成情况",prop:"CollectorToken",minWidth:"25%",formatter:function(e,t,a){return 0==e.RecordCount?"待完成":"已完成"}},{label:"上传人",prop:"LastCreateUserName",minWidth:"25%",formatter:function(e,t,a){return e.LastCreateUserName||"-"}},{label:"上传时间",prop:"LastCreateTime",minWidth:"50%",formatter:function(t,a,s){return t.RecordCount>0?t.LastCreateTime?e.$moment(t.LastCreateTime).format("yyyy-MM-DD HH:mm:ss"):"":"-"}}]}},Ne={name:"AddOrEditSpendingDialog",components:{ImageUpload:Ve.a},props:{ProjectId:{type:Number,default:null},recordInfo:{type:Object,default:null}},data:function(){return{dialigVisible:!0,formLabelWidth:"100px",form:{Type:"",Sort:"",Money:"",CostDetail:"",fileList:[]},rules:{Type:[{required:!0,message:"请选择开支类型",trigger:"change"}],Sort:[{required:!0,message:"请选择开支项目",trigger:"change"}],Money:[{required:!0,message:"请输入项目金额",trigger:"blur"},{pattern:/^(0|[1-9][0-9]{0,7})([.][0-9]{1,2})?$/,message:"限制整数位不超过8位,小数点不超过2位",trigger:"blur"}],CostDetail:[{required:!0,message:"请输入开支说明",trigger:"blur"}],fileList:[{required:!0,message:"请选择文件",trigger:"change"}]},CostTypeEnum:Me.CostTypeEnum,CostItemsEnum:[],FileUrl:""}},watch:{"form.fileList":{handler:function(e,t){console.log(e),this.FileUrl=e.map(function(e){return e.url}).join(";"),console.log(this.FileUrl)},deep:!0}},mounted:function(){this.GetGensetProjectCostType(),console.log(this.recordInfo),this.recordInfo&&(this.form=N()({},this.recordInfo,{fileList:this.recordInfo.FileUrlArrays.map(function(e){return{url:e}})}),console.log(this.form))},methods:{GetGensetProjectCostType:function(){var e=this,t={Type:this.form.Type||-1};this.$api.project.GetGensetProjectCostType(t).then(function(t){1===t.Code&&(console.log(t),e.CostItemsEnum=t.Data)})},costTypeChange:function(){this.form.Sort="",this.GetGensetProjectCostType()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=i()({},t.form,{ProjectId:t.ProjectId,FileUrl:t.FileUrl});if(t.recordInfo){var s={id:t.recordInfo.ProjectCostId};t.editProjectCost(a,s)}else t.addProjectCost(a)})},addProjectCost:function(e){var t=this;this.$api.project.AddGensetProjectCost(e).then(function(e){1===e.Code?t.$message({type:"success",message:"添加用户成功!"}):t.$message({type:"error",message:"添加用户失败，请重新提交!"}),t.$emit("closeDialog",{refresh:!0})})},editProjectCost:function(e,t){var a=this;this.$api.project.EditGensetProjectCost(e,t).then(function(e){1===e.Code?a.$message({type:"success",message:"编辑用户成功!"}):a.$message({type:"error",message:"编辑用户失败，请重新提交!"}),a.$emit("closeDialog",{refresh:!0})})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},close:function(){this.$emit("closeDialog")}}},Oe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"spending-addedit-dialog",attrs:{title:e.recordInfo?"编辑开支":"添加开支",width:"600px",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("el-form",{ref:"spendingForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-form-item",{attrs:{label:"开支类型:",prop:"Type"}},[a("el-select",{attrs:{placeholder:"请选择开支类型"},on:{change:function(t){return e.costTypeChange()}},model:{value:e.form.Type,callback:function(t){e.$set(e.form,"Type",t)},expression:"form.Type"}},e._l(e.CostTypeEnum,function(e,t){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"开支项目:",prop:"Sort"}},[a("el-select",{attrs:{placeholder:"请选择开支项目"},model:{value:e.form.Sort,callback:function(t){e.$set(e.form,"Sort",t)},expression:"form.Sort"}},e._l(e.CostItemsEnum,function(e,t){return a("el-option",{key:e.Sort,attrs:{label:e.SortName,value:e.Sort}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目金额:",prop:"Money"}},[a("el-input",{attrs:{placeholder:"请输入项目金额",autocomplete:"off"},model:{value:e.form.Money,callback:function(t){e.$set(e.form,"Money",t)},expression:"form.Money"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("元")])],1),e._v(" "),a("el-form-item",{attrs:{label:"开支说明:",prop:"CostDetail"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"字数不超过50个字",maxlength:"50","show-word-limit":""},model:{value:e.form.CostDetail,callback:function(t){e.$set(e.form,"CostDetail",t)},expression:"form.CostDetail"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开支图片:",prop:"fileList"}},[a("ImageUpload",{attrs:{tip:"（仅支持不超过5M的.jpg/jpge/png图片文件；最多上 传3张图片）",limit:3},model:{value:e.form.fileList,callback:function(t){e.$set(e.form,"fileList",t)},expression:"form.fileList"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("spendingForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("spendingForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var Ae=a("VU/8")(Ne,Oe,!1,function(e){a("5XzJ")},"data-v-41987218",null).exports,Ue={name:"SpendingImgDialog",props:{imgUrlArr:{type:Array,default:function(){return[]}}},data:function(){return{dialigVisible:!0,fit:"fill"}},mounted:function(){console.log(this.imgUrlArr,"http://www.fortrustyun.com:8022")},methods:{previewUrl:function(e){return"http://www.fortrustyun.com:8022/"+e},close:function(){this.$emit("closeDialog")}}},Be={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"show-img-dialog",attrs:{title:"查看开支图片",width:"540px",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[e._l(e.imgUrlArr,function(t){return[a("el-image",{staticClass:"img-item",attrs:{src:e.previewUrl(t),fit:e.fit}})]})],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.close()}}},[e._v("确 定")])],1)])},staticRenderFns:[]};var qe=a("VU/8")(Ue,Be,!1,function(e){a("LYfj")},"data-v-36ad5644",null).exports,He=a("dzIa"),Ye=C.a.ProjectTypeEnum,We={name:"RecordFormDialog",components:{ProjectRecordSheet:He.a},props:{ProjectProgressId:{type:Number,default:null},RecordId:{type:Number,default:null},OperateType:{type:Number,default:null},GensetList:{type:Array,default:function(){return[]}}},computed:i()({},Object(r.c)(["currentProject"]),{title:function(){var e="";switch(this.operateType){case 1:e="新增";break;case 2:e="查看";break;case 4:e="编辑";break;default:e=""}return(13==this.ProjectProgressId?"客户满意度":"完工报告")+e},isEdit:function(){return 1==this.operateType||4==this.operateType}}),watch:{currentProject:{handler:function(e){1!==n()(e).length&&this.$set(this,"ProjectId",e.ProjectId)},deep:!0,immediate:!0}},data:function(){return{loading:!1,dialigVisible:!0,ProjectId:parseInt(this.$route.query.ProjectId),IsGenset:this.$route.query.IsGenset,IsGensetMult:this.$route.query.IsGensetMult,operateType:this.OperateType,dataList:[],ProjectTypeEnum:Ye}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,console.log(this.ProjectProgressId,this.RecordId,this.OperateType,this.GensetList,this.ProjectId),this.RecordId?this.getProgressFormData():this.GetProgressStencil()},methods:{GetProgressStencil:function(){var e=this,t={ProgressId:this.ProjectProgressId,ProjectId:this.ProjectId};this.$api.project.GetGensetProjectProgressStencilProject(t).then(function(t){if(1===t.Code){var a=t.Data.ProjectDetail,s=i()({ProjectDetail:i()({},a,{ProjectTypeStr:a.ProjectType?e.ProjectTypeEnum.find(function(e){return e.value==a.ProjectType}).label:"",StartDateStr:e.$moment(a.StartDate).format("YYYY-MM-DD"),EndDateStr:e.$moment(a.EndDate).format("YYYY-MM-DD")})},t.Data.StencilDetail);s.StencilList=_.cloneDeep(s.StencilModel),s.ItemList=_.cloneDeep(s.ItemModel)||[{}],console.log(t,s),s.IsGenset&&(s.GensetList=_.cloneDeep(e.GensetList)),e.$set(e,"dataList",_.cloneDeep(s))}})},getProgressFormData:function(){var e=this,t={RecordId:this.RecordId};this.$api.project.GetGensetProjectProgressRecordDetail({},t).then(function(t){if(1===t.Code){console.log("bianji",t);var a=t.Data;e.$set(a,"GensetList",a.GensetList?a.GensetList.map(function(e){return i()({RecordJoinGensetId:e.RecordJoinGensetId},e.GeneratorSet)}):[]),e.$set(a,"ProjectDetail",i()({},a.ProjectDetail,{ProjectTypeStr:a.ProjectDetail.ProjectType?e.ProjectTypeEnum.find(function(e){return e.value==a.ProjectDetail.ProjectType}).label:"",StartDateStr:e.$moment(a.ProjectDetail.StartDate).format("YYYY-MM-DD"),EndDateStr:e.$moment(a.ProjectDetail.EndDate).format("YYYY-MM-DD")})),e.$nextTick(function(){e.$set(e,"dataList",_.cloneDeep(a))})}})},close:function(){this.$emit("closeDialog")},addSave:function(){var e=this;this.$refs.ProjectRecordSheet.$refs.generateSheet.getData().then(function(t){console.log("formdata-----------",e.dataList,t);var a={ProjectId:e.ProjectId,ProgressId:e.ProjectProgressId,IsGenset:e.dataList.IsGenset,GensetList:e.GensetList?e.GensetList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}):[],FileUrl:"",StencilList:e.dataList.StencilModel?_.cloneDeep(e.dataList.StencilModel):null,ItemList:t.key_table||e.dataList.ItemModel};a.StencilList&&a.StencilList.forEach(function(e){e.KeyValue=t["key_"+e.KeyId]}),t.key_image&&(a.FileUrl=t.key_image.map(function(e){return e.url}).join(";")),console.log("params",a),e.$api.project.AddGensetProjectProgressRecord(a).then(function(t){1===t.Code&&(console.log(t),e.$emit("closeDialog",{refresh:!0}))})})},editSave:function(){var e=this,t={id:this.RecordId};this.$refs.ProjectRecordSheet.$refs.generateSheet.getData().then(function(a){console.log("formdata-----------",e.dataList,a);var s={ProjectId:e.ProjectId,ProgressId:e.ProjectProgressId,IsGenset:e.dataList.IsGenset,IsGensetMult:e.dataList.IsGensetMult,GensetList:e.dataList.GensetList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),FileUrl:"",StencilList:e.dataList.StencilList?_.cloneDeep(e.dataList.StencilList):null,ItemList:a.key_table||e.dataList.ItemModel};s.StencilList&&s.StencilList.forEach(function(e){e.KeyValue=a["key_"+e.KeyId]}),a.key_image&&(s.FileUrl=a.key_image.map(function(e){return e.url}).join(";")),console.log("params",s),e.$api.project.EditGensetProjectProgressRecord(s,t).then(function(t){1===t.Code&&(console.log(t),e.$emit("closeDialog",{refresh:!0}))})})},handleCancelClick:function(){this.close()},downloadTemplate:function(){},uploadFile:function(){},handleBackList:function(){this.close()},downloadFile:function(){Object(F.c)({title:"页面导出PDF文件名",contentId:"#ProjectRecordSheet"})},handleAppPreview:function(){var e=this.$router.resolve({path:"/project/app-record-form",query:{RecordId:this.RecordId}});window.open(e.href,"_blank")}}},ze={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"progress-record-detail-dialog",attrs:{title:e.title,width:"60%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[1===e.operateType?a("div",{staticClass:"operation-box"},[a("div",{staticClass:"box-left"}),e._v(" "),a("div",{staticClass:"box-right"})]):e._e(),e._v(" "),4===e.operateType?a("div",{staticClass:"operation-box"},[a("div",{staticClass:"box-left"}),e._v(" "),a("div",{staticClass:"box-right"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleCancelClick()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editSave()}}},[e._v("保存")])],1)]):e._e(),e._v(" "),2==e.operateType?a("div",{staticClass:"operation-box"},[a("div",{staticClass:"box-left"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleBackList()}}},[e._v("返回列表")])],1),e._v(" "),a("div",{staticClass:"box-right"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.downloadFile()}}},[e._v("下载")])],1)]):e._e(),e._v(" "),a("ProjectRecordSheet",{ref:"ProjectRecordSheet",attrs:{id:"ProjectRecordSheet",edit:e.isEdit},model:{value:e.dataList,callback:function(t){e.dataList=t},expression:"dataList"}})],1),e._v(" "),1==e.operateType?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.close()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSave()}}},[e._v("保存")])],1):e._e()])],1)},staticRenderFns:[]};var Je={name:"ProjectCompletion",components:{RecordFormDialog:a("VU/8")(We,ze,!1,function(e){a("yVty")},"data-v-28260062",null).exports},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&this.$set(this,"ProjectId",e.ProjectId)},deep:!0,immediate:!0}},data:function(){return{loading:!1,loading_1:!1,loading_2:!1,options:{index:!0,labelIndex:"序号",props:{width:156}},CompletionReportColumns:Me.CompletionReportColumns(this),CompletionReportData:[],CustomerSatisfactionColumns:Me.CustomerSatisfactionColumns(this),CustomerSatisfactionData:[],ProjectId:null,ProjectProgressId:null,RecordId:null,OperateType:null,RecordFormDialogVisible:!1,OperationReportColumns:Me.OperationReportColumns(this),OperationReportData:[],fileList:[]}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,this.initData()},methods:{initData:function(){this.queryCompletionReportTableData(),this.queryCustomerSatisfactionTableData(),this.queryOperationReportTableData()},handleBackClick:function(){this.$router.push({path:"/project/project-list"})},queryCompletionReportTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId,ProgressType:2};this.$api.project.GetGensetProjectProgressSetting(t).then(function(t){1===t.Code&&e.$set(e,"CompletionReportData",t.Data),e.loading=!1})},queryCustomerSatisfactionTableData:function(){var e=this;this.loading_1=!0;var t={ProjectId:this.ProjectId,ProgressType:3};this.$api.project.GetGensetProjectProgressSetting(t).then(function(t){1===t.Code&&e.$set(e,"CustomerSatisfactionData",t.Data),e.loading_1=!1})},queryOperationReportTableData:function(){var e=this;this.loading_2=!0;var t={ProjectId:this.ProjectId,ProgressType:4};this.$api.project.GetGensetProjectProgressSetting(t).then(function(t){1===t.Code&&e.$set(e,"OperationReportData",t.Data),e.loading_2=!1})},handleAdd:function(e){this.ProjectProgressId=e.ProgressId,this.RecordId=null,this.OperateType=1,this.RecordFormDialogVisible=!0},handleEdit:function(e){this.ProjectProgressId=e.ProgressId,this.RecordId=e.LastRecordId,this.OperateType=4,this.RecordFormDialogVisible=!0},handleShow:function(e){this.ProjectProgressId=e.ProgressId,this.RecordId=e.LastRecordId,this.OperateType=2,this.RecordFormDialogVisible=!0},handleDownloadClick:function(e,t){if(t){var a=this.$api.project.DoDownloadProgressRecordFileUrl+"?RecordId="+e.LastRecordId;Object(F.b)(a)}},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&(this.queryCompletionReportTableData(),this.queryCustomerSatisfactionTableData())},handleDownloadTemplate:function(){var e=this.$api.project.DoDownloadProgressRecordTemplateUrl+"?ProgressId="+this.OperationReportData[0].ProgressId;Object(F.b)(e)},handleDelete:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"删除记录",message:a("div",[a("p",[a("span","确定删除当前记录吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.LastRecordId};t.$api.project.DeleteGensetProjectProgressRecord(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除记录成功!"}),t.queryOperationReportTableData()):t.$message({type:"error",message:"删除记录失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},getValChange:function(e,t){var a=e.raw.type;return["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/pdf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/msword","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint"].includes(a)?e.size/1024<=30720?void this.getfileUpload(e,t):(t.splice(t.indexOf(e),1),this.$message.warning("上传文件大小不能超过 30MB!"),!1):(t.splice(t.indexOf(e),1),this.$message.error("文件类型错误!"),!1)},getfileUpload:function(e,t){var a=this,s=this.$loading({lock:!0,text:"处理中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),n=new FormData;n.append("file",e.raw),this.$api.common.uploadFile(n).then(function(e){if(1==e.Code){var t=[];e.Data.map(function(e){var a={url:e};t.push(a)}),a.$set(a,"fileList",a.fileList.concat(t)),a.handleUploadOperationReport()}else a.fileList=[];setTimeout(function(){s.close()},300)})},handleUploadOperationReport:function(){var e=this;return y()(h.a.mark(function t(){var a,s,n,o;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={ProgressId:e.OperationReportData[0].ProgressId,ProjectId:e.ProjectId},t.next=3,e.$api.project.GetGensetProjectProgressStencilProject(a).then(function(e){return e.Data});case 3:if(s=t.sent,n={ProjectId:s.ProjectDetail.ProjectId,ProgressId:s.StencilDetail.ProgressId,IsGenset:s.StencilDetail.IsGenset,GensetList:[],FileUrl:e.fileList.map(function(e){return e.url}).join(";"),StencilList:s.StencilDetail.StencilModel,ItemList:s.StencilDetail.ItemModel},e.OperationReportData[0].LastRecordId){t.next=8;break}return e.$api.project.AddGensetProjectProgressRecord(n).then(function(t){1===t.Code&&(e.$message.success("上传报告成功!"),e.queryOperationReportTableData())}),t.abrupt("return");case 8:o={id:e.OperationReportData[0].LastRecordId},e.$api.project.EditGensetProjectProgressRecord(n,o).then(function(t){1===t.Code&&(e.$message.success("重新上传报告成功!"),e.queryOperationReportTableData())});case 10:case"end":return t.stop()}},t,e)}))()}}},Ke={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"project-completion"},[a("p",{staticClass:"content-title"},[e._v("完工报告")]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.CompletionReportColumns,dataSource:e.CompletionReportData,border:""}},[a("el-table-column",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.RecordCount?a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleAdd(t.row)}}},[e._v(" 添加 ")])],1):a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleShow(t.row)}}},[e._v(" 查看 ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v(" 编辑 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("p",{staticClass:"content-title"},[e._v("\n    运维报告\n    "),a("span",{staticClass:"operation-btns"},[a("el-button",{staticClass:"comColor",attrs:{type:"primary"},on:{click:function(t){return e.handleDownloadTemplate()}}},[e._v("下载模板")])],1)]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.OperationReportColumns,dataSource:e.OperationReportData,border:""}},[a("el-table-column",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading_2,expression:"loading_2"}],attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[t.row.RecordCount?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("\n            删除\n          ")]):e._e(),e._v(" "),t.row.RecordCount?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDownloadClick(t.row,1)}}},[e._v("\n            下载\n          ")]):e._e(),e._v(" "),a("el-upload",{class:["avatar-uploader"],staticStyle:{display:"inline-block"},attrs:{accept:".xls,.xlsx,.doc,.docx",action:"#","on-change":e.getValChange,"file-list":e.fileList,"auto-upload":!1,"show-file-list":!1}},[a("el-button",{attrs:{type:"text"}},[e._v(e._s(t.row.RecordCount?"重新上传":"上传报告"))])],1)],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("p",{staticClass:"content-title"},[e._v("客户满意度")]),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.CustomerSatisfactionColumns,dataSource:e.CustomerSatisfactionData,border:""}},[a("el-table-column",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading_1,expression:"loading_1"}],attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.RecordCount?a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleAdd(t.row)}}},[e._v(" 添加 ")])],1):a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleShow(t.row)}}},[e._v(" 查看 ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v(" 编辑 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),e.RecordFormDialogVisible?a("RecordFormDialog",{attrs:{ProjectProgressId:e.ProjectProgressId,RecordId:e.RecordId,OperateType:e.OperateType},on:{closeDialog:function(t){return e.closeDialog("RecordFormDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var Qe=a("VU/8")(Je,Ke,!1,function(e){a("PoLq")},"data-v-2375929f",null).exports,Xe={name:"ProjectCostManage",mixins:[W.a],components:{BasicInfoList:w,AddOrEditSpendingDialog:Ae,SpendingImgDialog:qe,ProjectCompletion:Qe},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&this.$set(this,"ProjectId",e.ProjectId)},deep:!0,immediate:!0}},data:function(){return{loading:!1,loading_1:!1,ProjectId:null,projectBasicInfo:{id:20},activeName:"first",searchForm:{Type:"",Sort:""},CostTypeEnum:Me.CostTypeEnum,CostItemsEnum:[],columns:Me.costManageColumns(this),dataSource:[],options:{index:!0,labelIndex:"序号",props:{width:86}},data:[],allIncome:null,allExpend:null,costAggregationColumns:Me.costAggregationColumns(this),recordInfo:null,spendingDialogVisible:!1,spendingImgDialogVisible:!1,imgUrlArr:[]}},mounted:function(){this.ProjectId=this.currentProject.ProjectId,this.GetGensetProjectCostType(),this.queryTableData(),this.GetGensetProjectCostStats()},methods:{initData:function(){this.GetGensetProjectCostType(),this.queryTableData(),this.GetGensetProjectCostStats(),this.$refs.projectCompletion.initData()},getProjectBasicInfo:function(){var e=this;this.loading=!0;var t={id:this.ProjectId};this.$api.project.GetGensetProject(t).then(function(t){1===t.Code&&e.$set(e,"projectBasicInfo",t.Data),e.loading=!1}).catch(function(){e.loading=!1})},GetGensetProjectCostType:function(){var e=this,t={Type:this.searchForm.Type||-1};this.$api.project.GetGensetProjectCostType(t).then(function(t){1===t.Code&&(e.CostItemsEnum=t.Data)})},queryTableData:function(){var e=this;this.loading_1=!0;var t={Page:this.paginationCfg.currentPage,PageSize:this.paginationCfg.pageSize},a=i()({},this.searchForm,{ProjectId:this.ProjectId});this.$api.project.GetGensetProjectCostManage(a,t).then(function(t){1===t.Code&&(e.dataTotal=t.Data.TotalItemCount,e.$set(e,"dataSource",t.Data.Data)),e.loading_1=!1}).catch(function(){e.loading_1=!1})},costTypeChange:function(){this.searchForm.Sort="",this.GetGensetProjectCostType()},GetGensetProjectCostStats:function(){var e=this;this.loading_1=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectCostStats(t).then(function(t){1===t.Code&&(e.allIncome=t.Data.AllTypeOne,e.allExpend=t.Data.AllTypeTwo,e.$set(e,"data",t.Data.allList)),e.loading_1=!1})},reset:function(){this.$set(this,"searchForm",{Type:"",Sort:""})},handleAdd:function(){this.recordInfo=null,this.spendingDialogVisible=!0},handleEdit:function(e){this.recordInfo=e,this.spendingDialogVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleDelete:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"删除开支项目",message:a("div",[a("p",[a("span","确定删除当前开支项目吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.ProjectCostId};t.$api.project.DeleteGensetProjectCost({},a).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除开支项目成功!"}),t.queryTableData()):t.$message({type:"error",message:"删除开支项目失败，请重新提交!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleClickShowImg:function(e,t){e.FileUrl&&(this.$set(this,"imgUrlArr",e.FileUrlArrays),this.spendingImgDialogVisible=!0)},handleBackClick:function(){this.$router.push({path:"/project/project-list"})},handleClick:function(e,t){"second"==this.activeName&&this.GetGensetProjectCostStats()}}},Ze={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"completion-record-container"},[a("div",{staticClass:"completion-record"},[a("div",{staticClass:"cost-info"},[a("p",{staticClass:"content-title"},[e._v("费用明细")]),e._v(" "),a("div",{staticClass:"search-box"},[a("div",{staticClass:"search-item"},[a("span",[e._v("开支类型:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择开支类型"},on:{change:function(t){return e.costTypeChange()}},model:{value:e.searchForm.Type,callback:function(t){e.$set(e.searchForm,"Type",t)},expression:"searchForm.Type"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.CostTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("开支项目:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择开支项目"},model:{value:e.searchForm.Sort,callback:function(t){e.$set(e.searchForm,"Sort",t)},expression:"searchForm.Sort"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.CostItemsEnum,function(e){return a("el-option",{key:e.Sort,attrs:{label:e.SortName,value:e.Sort}})})],2)],1),e._v(" "),a("div",{staticClass:"search-btn-box"},[a("el-button",{staticClass:"reset-btn",attrs:{type:"text"},on:{click:function(t){return e.reset()}}},[e._v("清空筛选")]),e._v(" "),a("el-button",{staticClass:"query-btn",attrs:{type:"primary"},on:{click:function(t){return e.resetCurrentParams()}}},[e._v("查 询")])],1)]),e._v(" "),a("div",{staticClass:"operation-box"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:function(t){return e.handleAdd()}}},[e._v("添加开支")])],1),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_1,expression:"loading_1"}],attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,dataTotal:e.dataTotal,pagination:e.paginationCfg,border:""},on:{handleChangePage:e.handleChangePage,handleChangeSize:e.handleChangeSize}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v(" 编辑 ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v(" 删除 ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),a("p",{staticClass:"content-title cost-aggregation"},[e._v("费用汇总")]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_1,expression:"loading_1"}],attrs:{options:e.options,columns:e.costAggregationColumns,dataSource:e.data,border:""}}),e._v(" "),a("p",{staticClass:"cost-summary"},[a("span",[e._v("\n          项目总收入："),a("em",[e._v(e._s(e.allIncome||0))]),e._v(" 元\n        ")]),e._v(" "),a("span",[e._v("\n          项目总支出："),a("em",[e._v(e._s(e.allExpend||0))]),e._v(" 元\n        ")])])],1),e._v(" "),a("ProjectCompletion",{ref:"projectCompletion"})],1),e._v(" "),e.spendingDialogVisible?a("AddOrEditSpendingDialog",{attrs:{ProjectId:e.ProjectId,recordInfo:e.recordInfo},on:{closeDialog:function(t){return e.closeDialog("spendingDialogVisible",t)}}}):e._e(),e._v(" "),e.spendingImgDialogVisible?a("SpendingImgDialog",{attrs:{imgUrlArr:e.imgUrlArr},on:{closeDialog:function(t){return e.closeDialog("spendingImgDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var et=[{key:"1",value:"项目信息",componentName:"ProjectDetails"},{key:"2",value:"项目机组",componentName:"ProjectGensets"},{key:"3",value:"项目监控",componentName:"ProjectMonitoring"},{key:"4",value:"工程管理",componentName:"ProjectProgressManage"},{key:"5",value:"完工记录",componentName:"ProjectCompletionRecord"}],tt={name:"sensorMonitor",inject:["reload"],components:{ProjectInfo:v,ProjectDetails:H,ProjectGensets:we,ProjectMonitoring:Ge,ProjectProgressManage:Re,ProjectCompletionRecord:a("VU/8")(Xe,Ze,!1,function(e){a("jGxF")},"data-v-1bf8d1e4",null).exports},beforeRouteEnter:function(e,t,a){a(function(e){})},computed:i()({},Object(r.c)(["currentProject"])),watch:{currentProject:{handler:function(e){1!==n()(e).length&&(this.$set(this,"projectId",e.ProjectId),this.$set(this,"projectStatus",e.Status))},deep:!0,immediate:!0},$route:{handler:function(e,t){var a=this;this.activeName=this.$route.query.active||e.meta.activeNum,this.currentView=this.tabList.filter(function(e){return e.key==a.activeName})[0].componentName},deep:!0,immediate:!0}},data:function(){return{hasBackBtn:!1,projectId:null,projectBasicInfo:{},projectStatus:null,tabList:et,activeName:"1",currentView:""}},mounted:function(){},methods:{handleClickTab:function(){var e=this;this.currentView=this.tabList.filter(function(t){return t.key==e.activeName})[0].componentName},handleRefresh:function(){this.$refs.projectInfo.getMchInfo(),this.$refs.subComponent.initData&&this.$refs.subComponent.initData()}},beforeDestroy:function(){}},at={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-main",[a("div",{attrs:{id:"project-mould-page"}},[a("project-info",{ref:"projectInfo",attrs:{projectBasicInfo:e.projectBasicInfo,hasBackBtn:e.hasBackBtn},on:{handleRefresh:e.handleRefresh}}),e._v(" "),a("el-tabs",{staticClass:"project-tabs",on:{"tab-click":e.handleClickTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"项目信息",name:"1"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"项目机组",name:"2"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"项目监控",name:"3"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"工程管理",name:"4"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"完工记录",name:"5"}})],1),e._v(" "),a(e.currentView,{ref:"subComponent",tag:"component"})],1)])],1)],1)},staticRenderFns:[]};var st=a("VU/8")(tt,at,!1,function(e){a("nhSc")},"data-v-6a7c65fa",null);t.default=st.exports},SyOr:function(e,t){},XMeO:function(e,t){},YTY5:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("oCG/"),n=a("Ayik"),o={name:"GensetProgress",components:{GensetProgressRecordsDialog:s.a},props:["configData"],data:function(){return{loading:!1,loading_1:!1,ProjectId:null,GensetId:null,crewColumns:n.a.crewInfoColumns(this),crewDataSource:[],searchForm:{type:"",type1:""},columns:n.a.gensetProgressColumns(this),dataSource:[],options:{index:!0,labelIndex:"序号",props:{width:126}},selectItem:null,RecordsDialogVisible:!1}},watch:{configData:{handler:function(e,t){console.log("configData",e),this.ProjectId=e.projectId,this.GensetId=e.gensetId},deep:!0,immediate:!0}},mounted:function(){console.log(this.ProjectId,this.GensetId),this.queryTableData()},methods:{getGensetDetail:function(){var e=this,t={GeneratorSetId:this.GensetId};this.$api.project.GetGensetProjectJoinGensetDetail({},t).then(function(t){1===t.Code&&e.$set(e,"crewDataSource",[t.Data])})},queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId,ProgressType:1,GeneratorSetId:this.GensetId};this.$api.project.GetGensetProjectProgressSetting(t).then(function(t){1===t.Code&&e.$set(e,"dataSource",t.Data),e.loading=!1}).catch(function(){e.loading=!1})},reset:function(){this.$set(this,"searchForm",{type:"",type1:""})},handleProjectProgressClick:function(e){this.selectItem=e,this.RecordsDialogVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleBackClick:function(){this.$router.push({path:"/project/project-detail",query:{active:2}})}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"genset-progress-manage"},[a("p",{staticClass:"content-title"},[e._v("工程进度")]),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_1,expression:"loading_1"}],attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text",disabled:0==t.row.RecordCount},on:{click:function(a){return e.handleProjectProgressClick(t.row)}}},[e._v("\n              工程进度管理\n            ")])],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1),e._v(" "),e.RecordsDialogVisible?a("GensetProgressRecordsDialog",{attrs:{ProjectProgressId:e.selectItem.ProgressId,ProjectId:e.ProjectId,GensetId:e.GensetId},on:{closeDialog:function(t){return e.closeDialog("RecordsDialogVisible",t)}}}):e._e()],1)])},staticRenderFns:[]};var r=a("VU/8")(o,i,!1,function(e){a("EThk")},"data-v-59098d48",null);t.default=r.exports},aFK5:function(e,t,a){e.exports={default:a("gAsd"),__esModule:!0}},bkrD:function(e,t){},"ciO/":function(e,t){},cxxR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),o=a("Xxa5"),i=a.n(o),r=a("exGp"),l=a.n(r),c=a("prnJ"),u=a("Ayik"),d={name:"GensetProgressRecordsDialog",props:{recordParmas:{type:Object,default:null},RecordId:{type:Number,default:null},OperateType:{type:Number,default:null}},components:{RecordFormDialog:c.a},watch:{recordParmas:{handler:function(e,t){console.log("recordParmas",e),this.projectStatus=e.projectStatus,this.ProjectId=e.ProjectId,this.ProjectProgressId=e.ProjectProgressId,this.IsGensetMult=e.IsGensetMult},deep:!0,immediate:!0}},data:function(){return{loading:!1,dialigVisible:!0,title:"第一步：关联机组",projectStatus:null,ProjectId:null,ProjectProgressId:null,IsGensetMult:null,columns:u.a.GensetRalatedColumns(this),options:{index:!0,labelIndex:"序号",selection:!0,props:{width:80}},gensetTableData:[],selectList:[],RecordFormDialogVisible:!1}},computed:{selectText:function(){return this.selectList.map(function(e){return e.CollectorToken}).join(" 、 ")},GensetList:function(){return this.selectList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}})}},mounted:function(){console.log(this.recordParmas),1==this.OperateType?this.title="第一步：关联机组":this.title="关联机组",this.queryTableData()},methods:{querySelectList:function(){var e=this;return l()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={RecordId:e.RecordId},t.next=3,e.$api.project.GetGensetProjectProgressRecordDetail({},a).then(function(e){if(1===e.Code){var t=e.Data;return t.GensetList?t.GensetList.map(function(e){return n()({},e.GeneratorSet)}):[]}});case 3:s=t.sent,e.$set(e,"selectList",s);case 5:case"end":return t.stop()}},t,e)}))()},queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId};this.$api.project.GetGensetProjectJoinGensetByAll(t).then(function(t){1===t.Code&&(e.gensetTableData=t.Data.map(function(e){return n()({ID:e.ProjectJoinGensetId,IsParallel:e.IsParallel},e.GeneratorSet)}),2==e.OperateType&&e.querySelectList()),e.loading=!1}).catch(function(){e.loading=!1})},handleBatchRelated:function(e){var t=this,a={id:this.RecordId},s={GensetList:this.GensetList};this.$api.project.EditGensetProjectProgressRecordGenset(s,a).then(function(e){1===e.Code&&(t.$message.success(e.Message),t.$emit("closeDialog",{refresh:!0}))})},handleSelectionChange:function(e){this.selectList=e},nextStep:function(){0!=this.selectList.length?this.selectList.length>1&&"false"==this.IsGensetMult?this.$message.warning("请选择一台机组！"):this.RecordFormDialogVisible=!0:this.$message.warning("请选择机组！")},close:function(){this.$emit("closeDialog")},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.$emit("closeDialog",{refresh:!0})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"progress-records-dialog",attrs:{title:e.title,width:"60%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"genset-list-table",attrs:{options:e.options,columns:e.columns,dataSource:e.gensetTableData,defaultSelectData:e.selectList,border:""},on:{handleSelectionChange:e.handleSelectionChange}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("p",{staticClass:"select-text SingleLineHiding"},[a("em",[e._v("当前已选择：")]),e._v(" "),a("span",{attrs:{title:e.selectText}},[e._v(e._s(e.selectText))])]),e._v(" "),a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),1==e.OperateType?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]):e._e(),e._v(" "),2==e.OperateType&&3!==e.projectStatus?a("el-button",{attrs:{type:"primary",disabled:!(this.selectList&&this.selectList.length>0)},on:{click:function(t){return e.handleBatchRelated()}}},[e._v("保存")]):e._e()],1)]),e._v(" "),e.RecordFormDialogVisible?a("RecordFormDialog",{attrs:{recordParmas:e.recordParmas,RecordId:e.RecordId,OperateType:e.OperateType,GensetList:e.selectList},on:{closeDialog:function(t){return e.closeDialog("RecordFormDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var f=a("VU/8")(d,p,!1,function(e){a("jgFS")},"data-v-3983b970",null).exports,m=a("oCG/"),v={name:"ProjectProgressRecords",props:{recordParmas:{type:Object,default:null}},components:{GensetRelatedDialog:f,RecordFormDialog:c.a,GensetProgressRecordsDialog:m.a},data:function(){return{loading:!1,loading_1:!1,dialigVisible:!0,projectStatus:null,ProjectId:null,ProjectProgressId:null,IsGenset:null,IsGensetMult:null,GensetId:null,columns:u.a.projectProgressRecordsColumns(this),gensetRecord:u.a.progressRecordsColumns(this),options:{index:!0,labelIndex:"序号",props:{width:240}},dataSource:[],data:[],GensetRelatedDialogVisible:!1,RecordFormDialogVisible:!1,OperateType:null,RecordId:null,RecordsDialogVisible:!1}},watch:{recordParmas:{handler:function(e,t){console.log("recordParmas",e),this.projectStatus=e.projectStatus,this.ProjectId=e.ProjectId,this.ProjectProgressId=e.ProjectProgressId,this.IsGenset=e.IsGenset,this.IsGensetMult=e.IsGensetMult},deep:!0,immediate:!0}},mounted:function(){this.queryTableData()},methods:{queryTableData:function(){var e=this;this.loading=!0;var t={ProjectId:this.ProjectId,ProgressId:this.ProjectProgressId};this.$api.project.GetGensetProjectProgressRecord(t).then(function(t){1===t.Code&&(console.log(t),e.$set(e,"dataSource",t.Data)),e.loading=!1}).catch(function(){e.loading=!1})},queryGensetTableData:function(){var e=this;this.loading_1=!0;var t={ProjectId:this.ProjectId,ProgressId:this.ProjectProgressId};this.$api.project.GetGensetProjectProgressGensetByAll(t).then(function(t){if(1===t.Code){console.log(t);var a=t.Data.map(function(e){return n()({IsParallel:e.IsParallel,ProgressName:e.ProgressName,ProjectJoinGensetId:e.ProjectJoinGensetId,RecordCount:e.RecordCount,Type:e.Type},e.GeneratorSet)});e.$set(e,"data",a)}e.loading_1=!1})},close:function(){this.$emit("closeDialog")},addProgressRecord:function(){this.RecordId=null,this.OperateType=1,1==this.IsGenset?this.GensetRelatedDialogVisible=!0:this.RecordFormDialogVisible=!0},showProgressRecord:function(e){this.RecordId=e.RecordId,this.OperateType=2,this.RecordFormDialogVisible=!0},deleteProgressRecord:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"删除记录",message:a("div",[a("p",[a("span","确定删除当前记录吗？")])]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e.RecordId};t.$api.project.DeleteGensetProjectProgressRecord(a).then(function(e){1===e.Code?(t.$message({type:"success",message:"删除记录成功!"}),t.queryTableData()):t.$message({type:"error",message:"删除记录失败，请重新尝试!"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleDownloadClick:function(e){console.log(e)},relatedGenset:function(e){this.RecordId=e.RecordId,this.OperateType=2,this.GensetRelatedDialogVisible=!0},showGensetProgressRecord:function(e){console.log(e),this.GensetId=e.GeneratorSetId,this.RecordsDialogVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleBackClick:function(){this.$router.push({path:"/project/project-detail",query:{active:4}})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"project-progress-records"},[a("p",{staticClass:"content-title"},[e._v("\n      项目工程进度记录\n      "),a("el-button",{staticClass:"comColor",attrs:{type:"primary",disabled:3===e.projectStatus},on:{click:function(t){return e.addProgressRecord()}}},[e._v("添 加")])],1),e._v(" "),a("TableList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"record-list-table",attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,border:""}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.showProgressRecord(t.row)}}},[e._v(" 查看 ")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:3===e.projectStatus},on:{click:function(a){return e.deleteProgressRecord(t.row)}}},[e._v("\n              删除\n            ")]),e._v(" "),1==e.IsGenset?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.relatedGenset(t.row)}}},[e._v("\n              关联机组\n            ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1),e._v(" "),e.GensetRelatedDialogVisible?a("GensetRelatedDialog",{attrs:{recordParmas:e.recordParmas,ProjectProgressId:e.ProjectProgressId,RecordId:e.RecordId,OperateType:e.OperateType},on:{closeDialog:function(t){return e.closeDialog("GensetRelatedDialogVisible",t)}}}):e._e(),e._v(" "),e.RecordFormDialogVisible?a("RecordFormDialog",{attrs:{recordParmas:e.recordParmas,RecordId:e.RecordId,OperateType:e.OperateType},on:{closeDialog:function(t){return e.closeDialog("RecordFormDialogVisible",t)}}}):e._e(),e._v(" "),e.RecordsDialogVisible?a("GensetProgressRecordsDialog",{attrs:{ProjectProgressId:e.ProjectProgressId,GensetId:e.GensetId},on:{closeDialog:function(t){return e.closeDialog("RecordsDialogVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var h=a("VU/8")(v,g,!1,function(e){a("Mn87")},"data-v-792d8dea",null);t.default=h.exports},"eJM+":function(e,t){},eh7k:function(e,t){},eu7e:function(e,t){},gAsd:function(e,t,a){a("G5/o");var s=a("FeBl").Object;e.exports=function(e){return s.getOwnPropertyNames(e)}},jGxF:function(e,t){},jgFS:function(e,t){},nAqi:function(e,t){},nhSc:function(e,t){},oVaw:function(e,t,a){"use strict";var s=a("Dd8w"),n=a.n(s),o=a("j9eq"),i=a("/eJN").a.ProjectTypeEnum,r={name:"AddOrEditProjectDialog",props:{projectId:{type:Number,default:null}},components:{PositionCascader:o.a},data:function(){return{ProjectTypeEnum:i,dialigVisible:!0,formLabelWidth:"100px",form:{ProjectName:"",ProjectNumber:"",ProjectType:"",ProjectArea:"",ProjectAddress:"",contractTime:"",TotalPower:null,Quantity:null,TotalMoney:null},rules:{ProjectName:[{type:"string",required:!0,message:"请输入项目名称",trigger:"blur"},{max:15,message:"长度不超过 15 个字符",trigger:"blur"}],ProjectNumber:[{type:"string",required:!0,message:"请输入项目编号",trigger:"blur"},{max:20,message:"长度不超过 20 个字符",trigger:"blur"}],ProjectType:[{required:!0,message:"请选择项目类型",trigger:"change"}],ProjectArea:[{required:!0,message:"请选择项目地址",trigger:"change"}],contractTime:[{required:!0,message:"请选择项目起止时间",trigger:"change"}],TotalPower:[{required:!0,message:"请输入功率需求",trigger:"blur"},{pattern:/^(0|[1-9][0-9]{0,5})([.][0-9]{1,2})?$/,message:"限制整数位不超过6位,小数点不超过2位",trigger:"blur"}],Quantity:[{required:!0,message:"请输入租赁台数",trigger:"blur"},{pattern:/^[1-9]\d?$/,message:"仅可输入不超过两位数的非零正整数",trigger:"blur"}],TotalMoney:[{required:!0,message:"请输入项目租金",trigger:"blur"},{pattern:/^(0|[1-9][0-9]{0,7})([.][0-9]{1,2})?$/,message:"限制整数位不超过8位,小数点不超过2位",trigger:"blur"}]}}},mounted:function(){var e=this;if(this.projectId){var t={id:this.projectId};this.$api.project.GetGensetProject(t).then(function(t){if(1===t.Code){var a=t.Data.StartDate,s=t.Data.EndDate;a&&s&&(t.Data.contractTime=[e.$moment(a).format("YYYY-MM-DD"),e.$moment(s).format("YYYY-MM-DD")]),t.Data.ProjectType=parseInt(t.Data.ProjectType),e.$nextTick(function(){e.$set(e,"form",t.Data)})}})}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=n()({},t.form,{StartDate:t.form.contractTime[0],EndDate:t.form.contractTime[1]});if(t.projectId){var s={id:t.projectId};t.editProject(a,s)}else t.addProject(a)})},addProject:function(e){var t=this;this.$api.project.AddGensetProject(e).then(function(e){1===e.Code?(t.$message({type:"success",message:"新建项目成功!"}),t.$emit("closeDialog",{refresh:!0})):t.$message({type:"error",message:"新建项目失败，请重新提交!"})})},editProject:function(e,t){var a=this;console.log(e,t),this.$api.project.EditGensetProject(e,t).then(function(e){1===e.Code?a.$message({type:"success",message:"编辑项目成功!"}):a.$message({type:"error",message:"编辑项目失败，请重新提交!"}),a.$emit("closeDialog",{refresh:!0})})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},close:function(){this.$emit("closeDialog")},positionChange:function(e){this.form.ProjectArea=e.crewPosition,this.form.ProjectAddress=e.crewPosition}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"project-addedit-dialog",attrs:{title:e.projectId?"编辑项目":"新增项目",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目名称",prop:"ProjectName"}},[a("el-input",{attrs:{placeholder:"请输入项目名称",autocomplete:"off"},model:{value:e.form.ProjectName,callback:function(t){e.$set(e.form,"ProjectName",t)},expression:"form.ProjectName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目编号",prop:"ProjectNumber"}},[a("el-input",{attrs:{placeholder:"请输入项目编号",autocomplete:"off"},model:{value:e.form.ProjectNumber,callback:function(t){e.$set(e.form,"ProjectNumber",t)},expression:"form.ProjectNumber"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目类型",prop:"ProjectType"}},[a("el-select",{attrs:{placeholder:"请选择项目类型"},model:{value:e.form.ProjectType,callback:function(t){e.$set(e.form,"ProjectType",t)},expression:"form.ProjectType"}},e._l(e.ProjectTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目地址",prop:"ProjectArea"}},[a("position-cascader",{attrs:{defaultPosition:e.form.ProjectArea},on:{positionChange:e.positionChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"ProjectAddress"}},[a("el-input",{attrs:{placeholder:"请输入详细地址",autocomplete:"off"},model:{value:e.form.ProjectAddress,callback:function(t){e.$set(e.form,"ProjectAddress",t)},expression:"form.ProjectAddress"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目起止时间",prop:"contractTime"}},[a("el-date-picker",{staticClass:"input-with-select",attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",placement:"bottom-start"},model:{value:e.form.contractTime,callback:function(t){e.$set(e.form,"contractTime",t)},expression:"form['contractTime']"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"功率需求",prop:"TotalPower"}},[a("el-input",{attrs:{placeholder:"请输入项目功率需求",autocomplete:"off"},model:{value:e.form.TotalPower,callback:function(t){e.$set(e.form,"TotalPower",t)},expression:"form.TotalPower"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("Kw")])],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"租赁台数",prop:"Quantity"}},[a("el-input",{attrs:{placeholder:"请输入租赁台数",autocomplete:"off"},model:{value:e.form.Quantity,callback:function(t){e.$set(e.form,"Quantity",t)},expression:"form.Quantity"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("台")])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目租金",prop:"TotalMoney"}},[a("el-input",{attrs:{placeholder:"请输入项目租金",autocomplete:"off"},model:{value:e.form.TotalMoney,callback:function(t){e.$set(e.form,"TotalMoney",t)},expression:"form.TotalMoney"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("元")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("projectForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("projectForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,l,!1,function(e){a("+9gy")},"data-v-3dbd9e4a",null);t.a=c.exports},ofIw:function(e,t){},pzGC:function(e,t){},yVty:function(e,t){},ylaL:function(e,t){}});
//# sourceMappingURL=4.2288f669581d8b96dd9c.js.map