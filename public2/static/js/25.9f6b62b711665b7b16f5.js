webpackJsonp([25],{"+9gy":function(e,t){},"+cGf":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("Dd8w"),r=a.n(o),n=a("NYxO"),s=a("fALy"),i=a("j9eq"),c=a("oVaw"),l=a("ARIM"),u=a("/eJN"),p={name:"ProjectList",mixins:[s.a],components:{PositionCascader:i.a,AddOrEditProjectDialog:c.a,OpenProjectDialog:l.a},data:function(){return{ProjectTypeEnum:u.a.ProjectTypeEnum,ProjectStatusEnum:u.a.ProjectStatusEnum,searchForm:{ProjectName:"",ProjectType:"",position:"",Status:"",effectTime:"",creatTime:""},checked:!1,columns:u.a.listColumns(this),dataSource:[],options:{index:!0,labelIndex:"序号",props:{width:266}},loading:!1,dialogAddVisible:!1,dialogOpenVisible:!1,selProject:null}},watch:{checked:function(e,t){this.queryTableData()}},mounted:function(){this.queryTableData()},methods:r()({},Object(n.b)(["toggleCurrentProject"]),{queryTableData:function(){var e=this;this.loading=!0;var t={Page:this.paginationCfg.currentPage,PageSize:this.paginationCfg.pageSize},a=r()({},this.searchForm,{StartTime:this.searchForm.effectTime&&this.searchForm.effectTime[0],EndTime:this.searchForm.effectTime&&this.searchForm.effectTime[1],StartCreateTime:this.searchForm.creatTime&&this.searchForm.creatTime[0],EndCreateTime:this.searchForm.creatTime&&this.searchForm.creatTime[1],IsDue:this.checked});this.$api.project.GetGensetProjectManage(a,t).then(function(t){1===t.Code&&(e.$set(e,"dataSource",t.Data.Data),e.dataTotal=t.Data.TotalItemCount),e.loading=!1}).catch(function(){e.loading=!1})},reset:function(){this.$set(this,"searchForm",{ProjectName:"",ProjectType:"",position:"",Status:"",effectTime:"",creatTime:""})},positionChange:function(e){this.searchForm.position=e.crewPosition},handleAddProject:function(){this.dialogAddVisible=!0},closeDialog:function(e,t){this[e]=!1,t&&t.refresh&&this.queryTableData()},handleOpen:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"开启项目",message:a("div",[a("p",[a("span","确定开启项目“"),a("em",{style:"color: #1ABC9C;margin: 0 4px;"},e.ProjectName),a("span","”吗？")]),a("p","开启操作不可取消，请谨慎操作。")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.changeProjectStatus(e.ProjectId,2)}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleOpenConfirm:function(e){console.log(e),this.changeProjectStatus(e.projectId,e.status)},handleOpenV1:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"开启项目",message:a("div",[a("p",[a("span","确定开启项目"),a("em",{style:"color: #1ABC9C;margin: 0 4px;"},e.ProjectName),a("span","吗？")]),a("p","开启操作不可取消，请谨慎操作。")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.changeProjectStatus(e.ProjectId,2)}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleClose:function(e){var t=this,a=this.$createElement;this.$confirm("操作提示",{title:"完结项目",message:a("div",[a("p",[a("span","确定完结项目“"),a("em",{style:"color: #1ABC9C,margin: 0 4px;"},e.ProjectName),a("span","”吗？")]),a("p","完结后，项目相关信息将不再支持编辑，操作不可取消，请谨慎操作。")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.changeProjectStatus(e.ProjectId,3)}).catch(function(){t.$message({type:"info",message:"已取消"})})},changeProjectStatus:function(e,t){var a=this,o={id:e,status:t};this.$api.project.ChangeGensetProjectStatus(o).then(function(e){console.log("project-status",e),1===e.Code&&(a.queryTableData(),a.$message({type:"success",message:e.Message}))})},handleShowDetail:function(e){e&&this.toggleCurrentProject(e),window.open("/#/project/project-detail")},handleManageCrew:function(e){e&&this.toggleCurrentProject(e),window.open("/#/project/crew-manage")},handleManageCost:function(e){e&&this.toggleCurrentProject(e),window.open("/#/project/completion-record")}})},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中"}},[a("BMainTopComponent"),e._v(" "),a("div",{staticClass:"project-list"},[a("div",{staticClass:"search-box"},[a("div",{staticClass:"search-item"},[a("span",[e._v("项目名称:")]),e._v(" "),a("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.searchForm.ProjectName,callback:function(t){e.$set(e.searchForm,"ProjectName",t)},expression:"searchForm.ProjectName"}})],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("项目类型:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择项目类型"},model:{value:e.searchForm.ProjectType,callback:function(t){e.$set(e.searchForm,"ProjectType",t)},expression:"searchForm.ProjectType"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.ProjectTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("项目地址:")]),e._v(" "),a("position-cascader",{attrs:{defaultPosition:e.searchForm.position},on:{positionChange:e.positionChange}})],1),e._v(" "),a("div",{staticClass:"search-item"},[a("span",[e._v("项目状态:")]),e._v(" "),a("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"请选择项目状态"},model:{value:e.searchForm.Status,callback:function(t){e.$set(e.searchForm,"Status",t)},expression:"searchForm.Status"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.ProjectStatusEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),e._v(" "),a("div",{staticClass:"search-item date-type"},[a("span",[e._v("项目生效时间:")]),e._v(" "),a("el-date-picker",{staticClass:"input-with-select",attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",placement:"bottom-start"},model:{value:e.searchForm.effectTime,callback:function(t){e.$set(e.searchForm,"effectTime",t)},expression:"searchForm['effectTime']"}})],1),e._v(" "),a("div",{staticClass:"search-item date-type"},[a("span",[e._v("项目创建时间:")]),e._v(" "),a("el-date-picker",{staticClass:"input-with-select",attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",placement:"bottom-start"},model:{value:e.searchForm.creatTime,callback:function(t){e.$set(e.searchForm,"creatTime",t)},expression:"searchForm['creatTime']"}})],1),e._v(" "),a("div",{staticClass:"search-btn-box"},[a("el-button",{staticClass:"reset-btn",attrs:{type:"text"},on:{click:function(t){return e.reset()}}},[e._v("清空筛选")]),e._v(" "),a("el-button",{staticClass:"query-btn",attrs:{type:"primary"},on:{click:function(t){return e.resetCurrentParams()}}},[e._v("查 询")])],1)]),e._v(" "),a("div",{staticClass:"operation-box"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:function(t){return e.handleAddProject()}}},[e._v("新建项目")]),e._v(" "),a("el-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v(" 即将到期项目")])],1),e._v(" "),a("TableList",{attrs:{options:e.options,columns:e.columns,dataSource:e.dataSource,dataTotal:e.dataTotal,pagination:e.paginationCfg,border:""},on:{handleChangePage:e.handleChangePage,handleChangeSize:e.handleChangeSize}},[a("el-table-column",e._b({attrs:{slot:"operation",label:"操作",align:"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-group",staticStyle:{"text-align":"right"}},[1===t.row.Status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleOpen(t.row)}}},[e._v("\n              开启项目\n            ")]):e._e(),e._v(" "),2===t.row.Status?a("el-button",{staticStyle:{color:"#d9001b"},attrs:{type:"text"},on:{click:function(a){return e.handleClose(t.row)}}},[e._v("\n              完结项目\n            ")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleShowDetail(t.row)}}},[e._v(" 项目详情 ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleManageCrew(t.row)}}},[e._v(" 工程管理 ")]),e._v(" "),1!==t.row.Status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleManageCost(t.row)}}},[e._v("\n              完工记录\n            ")]):e._e()],1)]}}])},"el-table-column",e.options&&e.options.props,!1))],1)],1),e._v(" "),e.dialogAddVisible?a("AddOrEditProjectDialog",{on:{closeDialog:function(t){return e.closeDialog("dialogAddVisible",t)}}}):e._e(),e._v(" "),e.dialogOpenVisible?a("OpenProjectDialog",{attrs:{projectInfo:e.selProject},on:{handleOpenConfirm:e.handleOpenConfirm,closeDialog:function(t){return e.closeDialog("dialogOpenVisible",t)}}}):e._e()],1)},staticRenderFns:[]};var d=a("VU/8")(p,m,!1,function(e){a("IuOr")},"data-v-29fcd122",null);t.default=d.exports},ARIM:function(e,t,a){"use strict";var o=a("Dd8w"),r=a.n(o),n=a("/eJN"),s={name:"OpenProjectDialog",props:{projectInfo:{type:Object,default:{}}},watch:{projectInfo:{handler:function(e,t){console.log("projectInfo",e,t),this.project=e},deep:!0}},computed:{allNum:function(){return this.gensetTableData.length},selectNum:function(){return this.gensetTableData.filter(function(e){return 1==e.checked}).length}},data:function(){return{ProjectTypeEnum:n.a.ProjectTypeEnum,ProjectStatusEnum:n.a.ProjectStatusEnum,loading:!1,dialigVisible:!0,project:this.projectInfo,gensetTableData:[]}},mounted:function(){this.queryGensetData()},methods:{queryGensetData:function(){var e=this,t={ProjectId:this.project.ProjectId};this.$api.project.GetGensetProjectJoinGensetManageExpand(t,{Page:1,PageSize:99}).then(function(t){1===t.Code&&(e.gensetTableData=t.Data.Data.map(function(e){return r()({ID:e.ProjectJoinGensetId,IsParallel:e.IsParallel,IsFenceOpen:e.IsFenceOpen,IsStrategy:e.IsStrategy},e.GeneratorSet,{checked:!1})}),console.log(e.gensetTableData))})},submitForm:function(){this.$emit("handleOpenConfirm",{projectId:this.project.ProjectId,status:2})},close:function(){this.$emit("closeDialog")}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"open-project-dialog",attrs:{title:"开启项目",width:"70%",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"project-baseinfo"},[a("p",[a("span",[e._v("项目名称：")]),e._v(" "),a("span",[e._v(e._s(e.project.ProjectName))])]),e._v(" "),a("p",[a("span",[e._v("项目编号：")]),e._v(" "),a("span",[e._v(e._s(e.project.ProjectNumber))])]),e._v(" "),a("p",[a("span",[e._v("项目状态：")]),e._v(" "),a("span",[e._v(e._s(e.ProjectStatusEnum.find(function(t){return t.value==e.project.Status}).label))])]),e._v(" "),a("p",[a("span",[e._v("项目创建时间：")]),e._v(" "),a("span",[e._v(e._s(e.$moment(e.project.CreateTime).format("yyyy-MM-DD HH:mm:ss")))])])]),e._v(" "),e.gensetTableData&&e.gensetTableData.length>0?a("p",{staticClass:"clear-tip"},[e._v("\n      提示：请先选择需要重置累计数据的机组，提交确认开启项目后将同时执行数据重置\n    ")]):e._e(),e._v(" "),a("div",{staticClass:"genset-list-container"},e._l(e.gensetTableData,function(t){return a("div",{key:t.GeneratorSetId,staticClass:"genset-item-container",class:{"genset-checked":t.checked}},[a("div",{staticClass:"genset-box genset-info"},[a("el-checkbox",{staticClass:"checkbox",model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"gensetItem.checked"}},[e._v("确认重置")]),e._v(" "),a("p",[a("span",[e._v("机组名称："+e._s(t.DisplayName))])]),e._v(" "),a("p",[a("span",[e._v("机组编号："+e._s(t.CollectorToken))])])],1),e._v(" "),a("div",{staticClass:"genset-box genset-data"},[a("p",[e._v("期初底座油箱油量：300L")]),e._v(" "),a("p",[e._v("期末底座油箱油量：30L")]),e._v(" "),a("p",[e._v("加油次数：3")]),e._v(" "),a("p",[e._v("机组燃油用量：470L")]),e._v(" "),a("p",[e._v("机组平均油耗：33.33g/Kwh")]),e._v(" "),a("p",[e._v("机组平均运行时间：480 h 35 min")]),e._v(" "),a("p",[e._v("机组发电量：2345.55Kwh")]),e._v(" "),a("p",[e._v("机组无故障时间：2000 h 35 min")]),e._v(" "),a("p",[e._v("机组超功率运行时间：72 h 35 min")])])])}),0)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.gensetTableData&&e.gensetTableData.length>0?a("p",{staticClass:"tip"},[a("span",[e._v("已选择"+e._s(e.selectNum)+"台，")]),e._v(" "),a("span",[e._v("共"+e._s(e.allNum)+"台")])]):e._e(),e._v(" "),a("el-button",{on:{click:function(t){return e.close()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确认开启项目")])],1)])},staticRenderFns:[]};var c=a("VU/8")(s,i,!1,function(e){a("pzGC")},"data-v-b37923c2",null);t.a=c.exports},IuOr:function(e,t){},oVaw:function(e,t,a){"use strict";var o=a("Dd8w"),r=a.n(o),n=a("j9eq"),s=a("/eJN").a.ProjectTypeEnum,i={name:"AddOrEditProjectDialog",props:{projectId:{type:Number,default:null}},components:{PositionCascader:n.a},data:function(){return{ProjectTypeEnum:s,dialigVisible:!0,formLabelWidth:"100px",form:{ProjectName:"",ProjectNumber:"",ProjectType:"",ProjectArea:"",ProjectAddress:"",contractTime:"",TotalPower:null,Quantity:null,TotalMoney:null},rules:{ProjectName:[{type:"string",required:!0,message:"请输入项目名称",trigger:"blur"},{max:15,message:"长度不超过 15 个字符",trigger:"blur"}],ProjectNumber:[{type:"string",required:!0,message:"请输入项目编号",trigger:"blur"},{max:20,message:"长度不超过 20 个字符",trigger:"blur"}],ProjectType:[{required:!0,message:"请选择项目类型",trigger:"change"}],ProjectArea:[{required:!0,message:"请选择项目地址",trigger:"change"}],contractTime:[{required:!0,message:"请选择项目起止时间",trigger:"change"}],TotalPower:[{required:!0,message:"请输入功率需求",trigger:"blur"},{pattern:/^(0|[1-9][0-9]{0,5})([.][0-9]{1,2})?$/,message:"限制整数位不超过6位,小数点不超过2位",trigger:"blur"}],Quantity:[{required:!0,message:"请输入租赁台数",trigger:"blur"},{pattern:/^[1-9]\d?$/,message:"仅可输入不超过两位数的非零正整数",trigger:"blur"}],TotalMoney:[{required:!0,message:"请输入项目租金",trigger:"blur"},{pattern:/^(0|[1-9][0-9]{0,7})([.][0-9]{1,2})?$/,message:"限制整数位不超过8位,小数点不超过2位",trigger:"blur"}]}}},mounted:function(){var e=this;if(this.projectId){var t={id:this.projectId};this.$api.project.GetGensetProject(t).then(function(t){if(1===t.Code){var a=t.Data.StartDate,o=t.Data.EndDate;a&&o&&(t.Data.contractTime=[e.$moment(a).format("YYYY-MM-DD"),e.$moment(o).format("YYYY-MM-DD")]),t.Data.ProjectType=parseInt(t.Data.ProjectType),e.$nextTick(function(){e.$set(e,"form",t.Data)})}})}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=r()({},t.form,{StartDate:t.form.contractTime[0],EndDate:t.form.contractTime[1]});if(t.projectId){var o={id:t.projectId};t.editProject(a,o)}else t.addProject(a)})},addProject:function(e){var t=this;this.$api.project.AddGensetProject(e).then(function(e){1===e.Code?(t.$message({type:"success",message:"新建项目成功!"}),t.$emit("closeDialog",{refresh:!0})):t.$message({type:"error",message:"新建项目失败，请重新提交!"})})},editProject:function(e,t){var a=this;console.log(e,t),this.$api.project.EditGensetProject(e,t).then(function(e){1===e.Code?a.$message({type:"success",message:"编辑项目成功!"}):a.$message({type:"error",message:"编辑项目失败，请重新提交!"}),a.$emit("closeDialog",{refresh:!0})})},resetForm:function(e){this.$refs[e].resetFields(),this.close()},close:function(){this.$emit("closeDialog")},positionChange:function(e){this.form.ProjectArea=e.crewPosition,this.form.ProjectAddress=e.crewPosition}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"project-addedit-dialog",attrs:{title:e.projectId?"编辑项目":"新增项目",visible:e.dialigVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialigVisible=t},close:function(t){return e.close()}}},[a("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目名称",prop:"ProjectName"}},[a("el-input",{attrs:{placeholder:"请输入项目名称",autocomplete:"off"},model:{value:e.form.ProjectName,callback:function(t){e.$set(e.form,"ProjectName",t)},expression:"form.ProjectName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目编号",prop:"ProjectNumber"}},[a("el-input",{attrs:{placeholder:"请输入项目编号",autocomplete:"off"},model:{value:e.form.ProjectNumber,callback:function(t){e.$set(e.form,"ProjectNumber",t)},expression:"form.ProjectNumber"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目类型",prop:"ProjectType"}},[a("el-select",{attrs:{placeholder:"请选择项目类型"},model:{value:e.form.ProjectType,callback:function(t){e.$set(e.form,"ProjectType",t)},expression:"form.ProjectType"}},e._l(e.ProjectTypeEnum,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目地址",prop:"ProjectArea"}},[a("position-cascader",{attrs:{defaultPosition:e.form.ProjectArea},on:{positionChange:e.positionChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"ProjectAddress"}},[a("el-input",{attrs:{placeholder:"请输入详细地址",autocomplete:"off"},model:{value:e.form.ProjectAddress,callback:function(t){e.$set(e.form,"ProjectAddress",t)},expression:"form.ProjectAddress"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目起止时间",prop:"contractTime"}},[a("el-date-picker",{staticClass:"input-with-select",attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",placement:"bottom-start"},model:{value:e.form.contractTime,callback:function(t){e.$set(e.form,"contractTime",t)},expression:"form['contractTime']"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"功率需求",prop:"TotalPower"}},[a("el-input",{attrs:{placeholder:"请输入项目功率需求",autocomplete:"off"},model:{value:e.form.TotalPower,callback:function(t){e.$set(e.form,"TotalPower",t)},expression:"form.TotalPower"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("Kw")])],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"租赁台数",prop:"Quantity"}},[a("el-input",{attrs:{placeholder:"请输入租赁台数",autocomplete:"off"},model:{value:e.form.Quantity,callback:function(t){e.$set(e.form,"Quantity",t)},expression:"form.Quantity"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("台")])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目租金",prop:"TotalMoney"}},[a("el-input",{attrs:{placeholder:"请输入项目租金",autocomplete:"off"},model:{value:e.form.TotalMoney,callback:function(t){e.$set(e.form,"TotalMoney",t)},expression:"form.TotalMoney"}}),e._v(" "),a("span",{staticClass:"unit"},[e._v("元")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("projectForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("projectForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var l=a("VU/8")(i,c,!1,function(e){a("+9gy")},"data-v-3dbd9e4a",null);t.a=l.exports},pzGC:function(e,t){}});
//# sourceMappingURL=25.9f6b62b711665b7b16f5.js.map