webpackJsonp([46],{FZgp:function(e,t){},Szwq:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),a=n.n(i),o=n("NYxO"),s=n("0Yr5"),l=(n("X2Oc"),{name:"crew-location",components:{ToggleCrew:n("5w7s").a},data:function(){return{id:"crew-location",fenceFlag:!1,dialogVisible:!1,fenceRadius:500,fenceCenterPoint:null,beginDate:this.$moment().add(-3,"days").format("YYYY-MM-DD"),endTime:this.$moment().format("YYYY-MM-DD HH:mm"),dataObj:null,bMap:null,fenceMap:null,centerPoint:null,infoWindow:null,loading:!1,loadingMsg:"地图加载中，请您稍候...",backBtnShow:!1,isOpen:!1}},computed:a()({},Object(o.c)(["selectCrew"])),watch:{fenceFlag:function(e,t){var n=this;e&&0==this.isOpen&&(this.dialogVisible=!0,this.renderFenceMap()),e||1!=this.isOpen||this.$confirm("是否确定关闭电子围栏？").then(function(e){n.commitHandler(!1)}).catch(function(e){n.fenceFlag=!0})},selectCrew:function(e,t){this.renderBMap()}},methods:{renderBMap:function(){var e=this;this.loadingMsg="地图加载中，请您稍候...",this.loading=!0,Object(s.a)().then(function(t){e.$api.project.GetGensetFenceSetting({id:e.selectCrew.ID}).then(function(n){e.loading=!1,e.dataObj=!!n&!!n.Data&&n.Data;var i=t,a=(new i.Size(48,48),new i.Map(e.id+"-map-box",{enableMapClick:!1})),o=e.dataObj;o.GensetMap={};var s=new i.Point(103,31);if(o){var l=[o.Genset.Longitude,o.Genset.Latitude],c=l[0],r=l[1];o.GensetMap={Longitude:o.Genset.Longitude,Latitude:o.Genset.Latitude},s=new i.Point(c,r),e.centerPoint=s;var d=new i.Marker(s),f={width:300,height:100,title:"<div style='font-size:1.2rem;font-weight:600'>"+o.Genset.DisplayName+"</div>",offset:new i.Size(0,-10)},u=new i.InfoWindow('<el-card class="box-card">\n                    <div  class="text item">\n                        经度：'+c+'\n                    </div>\n                    <div  class="text item">\n                        纬度：'+r+'\n                    </div>\n                    <div  class="text item">\n                        '+o.Genset.InstallationSite+"\n                    </div>\n                  </el-card>\n                  ",f);if(e.infoWindow=u,d.addEventListener("click",function(e){a.openInfoWindow(u,s)}),a.openInfoWindow(u,s),a.addOverlay(d),a.enableScrollWheelZoom(),a.centerAndZoom(s,16),o.IsOpen){var h=new i.Point(o.Longitude,o.Latitude);e.fenceFlag=!0,e.isOpen=!0,e.fenceRadius=o.Range;var g=new i.Circle(h,e.fenceRadius,{strokeColor:"red",strokeWeight:2,strokeOpacity:.5,fillOpacity:.1,fillColor:"tomato"});a.addOverlay(g)}}else a.centerAndZoom(s,5)}).catch(function(e){})})},renderFenceMap:function(){var e=this;this.dataObj.GensetMap.Longitude?Object(s.a)("o7gALXwtch6SNk9jjH4DmFffcFt1PhFL").then(function(t){var n=t||void 0,i=new n.Map("crew-location-fence-box",{enableMapClick:!1}),a=e.dataObj.GensetMap,o=new n.Point(a.Longitude,a.Latitude);e.fenceCenterPoint=o;var s={strokeColor:"red",strokeWeight:2,strokeOpacity:.5,fillOpacity:.1,fillColor:"tomato"},l=new n.Marker(o,{offset:new n.Size(0,5)}),c=function(t){var a=t.point,o=new n.Circle(a,e.fenceRadius,s);i.clearOverlays(),i.addOverlay(o),e.setOverlayEditing(o),o.addEventListener("lineupdate",function(t){e.fenceRadius=t.target.getRadius().toFixed(0),e.fenceCenterPoint=t.target.getCenter()})};i.disableDoubleClickZoom(),i.enableScrollWheelZoom(),i.centerAndZoom(o,15),c({point:o}),i.addEventListener("click",c),l.disableMassClear(),l.setAnimation(BMAP_ANIMATION_BOUNCE),i.addOverlay(l),e.fenceMap=i}).catch(function(e){alert(e)}):(this.$message("未获取到该机组位置信息！"),this.dialogVisible=!1,setTimeout(function(t){e.fenceFlag=!1},300))},commitHandler:function(e){this.dialogVisible=!1,this.loadingMsg="数据提交中，请您稍候...",this.loading=!0;var t={IsOpen:!1};e&&(t={IsOpen:!0,Range:this.fenceRadius,Longitude:this.fenceCenterPoint.lng,Latitude:this.fenceCenterPoint.lat});var n={id:this.selectCrew.ID||0};console.info("%c提交参数","color:red;background:yellow;font-size:1.1rem",{params:t,query:n}),this.loading=!1,this.isOpen=!1},handleClose:function(e){var t=this;this.$confirm("确认关闭？").then(function(n){t.closeHandler(),e()}).catch(function(e){})},closeHandler:function(){this.loading=!1,this.fenceMap=null,this.fenceFlag=!1,this.fenceRadius=500},setOverlayEditing:function(e){setTimeout(function(){e.enableEditing()},0)},queryByTime:function(){this.$moment(this.endTime).diff(this.$moment(this.beginDate),"seconds")>0?this.renderBMap():this.$message({message:"开始日期必须在结束时间之前！请检查。",type:"warning"})},backHandler:function(){this.bMap.closeInfoWindow(),this.bMap.panTo(this.centerPoint),this.bMap.openInfoWindow(this.infoWindow,this.centerPoint),this.backBtnShow=!1}},mounted:function(){this.renderBMap()}}),c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("BMainTopComponent"),e._v(" "),n("el-container",[n("el-main",[n("div",{attrs:{id:e.id}},[n("el-row",{staticClass:"time-fixed-box",attrs:{type:"flex",align:"middle"}},[n("el-col",{staticClass:"no-warp",attrs:{span:20}},[n("el-row",{staticClass:"fence-fixed-box",attrs:{type:"flex",align:"middle",justify:"start"}},[n("el-col",{attrs:{span:10,push:2}},[e._v("电子围栏：")]),e._v(" "),n("el-col",{attrs:{span:12,push:0}},[n("el-switch",{attrs:{"active-text":"开启","inactive-text":"关闭"},model:{value:e.fenceFlag,callback:function(t){e.fenceFlag=t},expression:"fenceFlag"}})],1)],1)],1),e._v(" "),n("el-col",{attrs:{span:4}})],1),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.backBtnShow,expression:"backBtnShow"}],staticClass:"back-to-center",attrs:{title:"返回机组当前位置",icon:"el-icon-refresh-left"},on:{click:e.backHandler}}),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:e.id+"-map-box","element-loading-text":e.loadingMsg,"element-loading-background":"rgba(0, 0, 0, 0.6)"}}),e._v(" "),n("el-dialog",{attrs:{title:"设置电子围栏",visible:e.dialogVisible,width:"70%","before-close":e.handleClose,"destroy-on-close":!0,center:!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("h3",{staticClass:"current-radius"},[e._v("当前半径:"+e._s(e.fenceRadius)+"米")]),e._v(" "),n("div",{attrs:{id:e.id+"-fence-box"}}),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1,e.closeHandler()}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.commitHandler}},[e._v("确 定")])],1)])],1)]),e._v(" "),n("toggle-crew")],1)],1)},staticRenderFns:[]};var r=n("VU/8")(l,c,!1,function(e){n("FZgp")},"data-v-745ba394",null);t.default=r.exports}});
//# sourceMappingURL=46.d3788eb08481b525f389.js.map