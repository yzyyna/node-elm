webpackJsonp([30],{TQmG:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),i=a.n(n),r=a("fZjL"),l=a.n(r),s=[{prop:"date",label:"日期",width:"150"},{prop:"name",label:"姓名",width:"150"},{prop:"sex",label:"年龄",width:"150"},{prop:"province",label:"省份",width:""},{prop:"city",label:"城市",width:"150"},{prop:"address",label:"地址",width:"150"}],o=[{date:"2022-3-14",name:"爱新觉罗",province:"上海",city:"普陀区",address:"上海市普陀区金沙江路 1518 弄",zip:200333,sex:18},{date:"2022-3-14",sex:18,name:"爱新觉罗",province:"上海",city:"普陀区",address:"上海市普陀区金沙江路 1518 弄",zip:200333},{date:"2022-3-14",name:"爱新觉罗",sex:18,province:"上海",city:"普陀区",address:"上海市普陀区金沙江路 1518 弄",zip:200333}],d=a("M4fF"),u=a.n(d),c={data:function(){return{new_date_json:{},multipleSelection:[],is_edit:!0,is_delete:!0,selection:!1,radio:!0,space_color:!1,table_data:[]}},props:{labelText:{type:Object,default:function(e){return{add:"添加项目",edit:"编辑",save:"确定",delete:"删除"}}},table_columns:{type:Array,default:function(e){return s}},dataArray:{type:Array,default:function(e){return o}}},watch:{space_color:function(){this.$nextTick(function(){this.tableRowClassName()})},table_data:{handler:function(e,t){console.log(e,t),this.$emit("dataChange",{data:e}),this.$nextTick(function(){this.tableRowClassName()})},deep:!0}},methods:{tableRowClassName:function(){var e=this.$refs.myTable.$el.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(var t in e)t%2==0&&(this.space_color?e[t].style.backgroundColor="#f0f9eb":e[t].style.backgroundColor="")},handleSelectionChange:function(e){this.multipleSelection=e},handleEdit:function(e,t){t.edit=!0},handleDelete:function(e,t){var a=this;this.$confirm("","",{message:'是否确定<span style="color:red;font-weight:bold">删除</span>该项目？',dangerouslyUseHTMLString:!0}).then(function(t){a.table_data.splice(e,1),a.$message({message:"删除成功！",type:"success"})})},handleSave:function(e,t){t.edit=!1,delete this.table_data[e].add,this.$message({message:"操作成功！",type:"success"})},handleAdd:function(){var e={};for(var t in this.new_date_json)"edit"===t?delete e[t]:"add"===t?delete e[t]:e[t]="";e.edit=!0,e.add=!0,this.table_data.push(e)},initEditAttribute:function(){this.edit;var e=u.a.cloneDeep(this.dataArray);if(e.length>0){for(var t in e)e[t].edit=!0,this.table_data.push(e[t]);0===l()(this.new_date_json).length&&this.initAddDataJson(e[0])}},initAddDataJson:function(e){var t=e,a={};for(var n in t)a[n]="edit"===n?"true":"";a.add=!0,this.new_date_json=a}},created:function(){},mounted:function(){this.initEditAttribute(),this.$nextTick(function(){this.tableRowClassName()})}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{staticClass:"add-btn",attrs:{size:"mini"},on:{click:function(t){return e.handleAdd()}}},[e._v(e._s(e.labelText.add))])],1),e._v(" "),a("el-table",{ref:"myTable",staticStyle:{width:"100%"},attrs:{data:e.table_data},on:{"selection-change":e.handleSelectionChange}},[e.radio?a("el-table-column",{attrs:{type:"index",width:"50"}}):e._e(),e._v(" "),e.selection?a("el-table-column",{attrs:{type:"selection",width:"55"}}):e._e(),e._v(" "),e._l(e.table_columns,function(t,n,i){return a("el-table-column",{key:i,attrs:{align:"center",item:t,index:n,label:t.label},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.edit&&"ItemContent"===t.prop?a("el-input",{attrs:{size:"small",placeholder:"请输入"+t.label},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[item.prop]"}}):e._e(),e._v(" "),n.row.edit&&"ItemContent"!==t.prop?a("el-input-number",{attrs:{min:0,"controls-position":"right",placeholder:"请输入"+t.label},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[item.prop]"}}):e._e(),e._v(" "),n.row.edit?e._e():a("span",[e._v(e._s(n.row[t.prop]))])]}}],null,!0)})}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.is_delete?a("el-button",{attrs:{size:"mini",plain:!0,type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v(e._s(e.labelText.delete))]):e._e()]}}])})],2)],1)},staticRenderFns:[]};var p=a("VU/8")(c,m,!1,function(e){a("uom/")},"data-v-07e3caaa",null).exports,f=a("izrR"),h={name:"MaintenanceStrategyAdd",components:{EditTable:p},data:function(){return{table_columns:Object(f.a)(this).editTable.table_columns,dropdown:Object(f.a)(this).dropdown,form:{StrategyName:"",EngineBrandId:null,EngineSeriesId:null,Status:null,Type:null,StrategyItemList:[]}}},computed:{title:function(){return(this.$route.query&&this.$route.query.form?"编辑":"新增")+"维保策略（新）"},cycleDuration:function(){return this.form.BeatLength&&this.form.BeatCount?this.form.BeatLength*this.form.BeatCount:null},totalDuration:function(){return this.cycleDuration&&this.form.CycleCount?this.cycleDuration*this.form.CycleCount:null}},methods:{getEngineBrandList:function(){var e=this;this.$api.operation.GetMaintenanceGensetEngineBrand().then(function(t){if(1===t.Code){var a=t.Data.map(function(e){return{value:e.EngineBrandId,label:e.BrandName}});e.$set(e.dropdown,"model",a)}})},getEngineSeriesList:function(){var e=this;this.$api.operation.GetMaintenanceGensetEngineSeries({},{EngineBrandId:this.form.EngineBrandId}).then(function(t){if(1===t.Code){var a=t.Data.map(function(e){return{value:e.EngineSeriesId,label:e.SeriesName}});e.$set(e.dropdown,"seriesList",a)}})},EngineBrandChange:function(){console.log("EngineBrandChange",this.form.EngineBrandId),this.form.EngineBrandId&&this.getEngineSeriesList(),this.$set(this.form,"EngineSeriesId","")},tableDataChange:function(e){console.log("tableDataChange",e),this.$set(this.form,"StrategyItemList",e.data)},handleSave:function(){this.form.StrategyName?this.form.EngineBrandId?this.form.EngineSeriesId?this.form.BeatLength?this.form.BeatCount?this.form.CycleCount?this.form.Type?!this.form.StrategyItemList||this.form.StrategyItemList&&0==this.form.StrategyItemList.length?this.$message({type:"warning",message:"请添加维保事项!"}):(console.log(this.form),this.$route.query&&this.$route.query.form?this.editFun():this.saveFun()):this.$message({type:"warning",message:"请选择策略主备分类!"}):this.$message({type:"warning",message:"请填写维保周期个数!"}):this.$message({type:"warning",message:"请填写周期节拍个数!"}):this.$message({type:"warning",message:"请填写节拍时长!"}):this.$message({type:"warning",message:"请选择发动机系列!"}):this.$message({type:"warning",message:"请选择发动机品牌!"}):this.$message({type:"warning",message:"请填写维保策略名称!"})},saveFun:function(){var e=this,t=this.form.StrategyItemList.map(function(e,t){return i()({},e,{OrderBy:t+1})}),a=i()({},this.form,{ItemList:t});this.$api.operation.AddMaintenanceGensetStrategy(a).then(function(t){1===t.Code&&(console.log(t),e.$message({type:"success",message:"添加机组维保策略成功!"}),e.$router.push({path:"/setting/agreement-management/maintenance-strategy-new"}))})},editFun:function(){var e=this,t=this.form.StrategyItemList.map(function(e,t){return i()({},e,{OrderBy:t+1})}),a=i()({},this.form,{ItemList:t}),n={StrategyId:this.form.StrategyId};this.$api.operation.EditMaintenanceGensetStrategy(a,n).then(function(t){1===t.Code&&(console.log(t),e.$message({type:"success",message:"编辑机组维保策略成功!"}),e.$router.push({path:"/setting/agreement-management/maintenance-strategy-new"}))})},cancel:function(){this.$route.query&&this.$route.query.form?this.$router.push({path:"/setting/agreement-management/maintenance-strategy-new-check",query:{rawData:this.form}}):this.$router.back()},handleBackClick:function(){this.$router.push({path:"/setting/agreement-management/maintenance-strategy-new-check",query:{rawData:this.form}})}},created:function(){if(this.$route.query&&this.$route.query.form){var e=this.$route.query.form;this.getEngineBrandList(),e.EngineBrandId&&this.getEngineSeriesList(),console.log(e),this.$set(this,"form",e)}else if(this.$route.query&&this.$route.query.list){this.getEngineBrandList();var t=this.$route.query.list;this.$set(this.form,"StrategyItemList",t)}else this.getEngineBrandList()}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BMainTopComponent",{attrs:{title:e.title}}),e._v(" "),a("div",{staticClass:"maintenance-strategy-add"},[a("el-row",{staticClass:"title",attrs:{type:"flex",align:"middle"}},[a("el-col",{attrs:{span:12}},[a("el-row",{attrs:{type:"flex",justify:"start"}},[e._v("维保策略")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-popconfirm",{attrs:{"confirm-button-text":"是","cancel-button-text":"否",icon:"el-icon-info","icon-color":"red",title:"您所做的更改可能未保存,是否确定返回？"},on:{confirm:e.cancel}},[a("el-button",{staticClass:"cancel-btn",attrs:{slot:"reference",type:"info",plain:"",size:"mini"},slot:"reference"},[e._v("取消")])],1),e._v(" "),a("el-button",{staticClass:"save-btn",attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleSave()}}},[e._v("保存")])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"base-info"},[a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("维保策略名称：")]),a("el-input",{attrs:{maxlength:"20",type:"text",placeholder:"请输入","show-word-limit":""},model:{value:e.form.StrategyName,callback:function(t){e.$set(e.form,"StrategyName",t)},expression:"form.StrategyName"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("发动机品牌：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.EngineBrandChange()}},model:{value:e.form.EngineBrandId,callback:function(t){e.$set(e.form,"EngineBrandId",t)},expression:"form.EngineBrandId"}},e._l(e.dropdown.model,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("发动机系列：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.EngineSeriesId,callback:function(t){e.$set(e.form,"EngineSeriesId",t)},expression:"form.EngineSeriesId"}},e._l(e.dropdown.seriesList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("节拍时长：")]),e._v(" "),a("el-input-number",{attrs:{"controls-position":"right",min:0,max:100,placeholder:"请输入"},model:{value:e.form.BeatLength,callback:function(t){e.$set(e.form,"BeatLength",t)},expression:"form.BeatLength"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("周期节拍个数：")]),e._v(" "),a("el-input-number",{attrs:{"controls-position":"right",min:0,max:100,placeholder:"请输入"},model:{value:e.form.BeatCount,callback:function(t){e.$set(e.form,"BeatCount",t)},expression:"form.BeatCount"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("维保周期时长：")]),e._v(" "),a("el-input",{attrs:{disabled:"",placeholder:"请输入"},model:{value:e.cycleDuration,callback:function(t){e.cycleDuration=t},expression:"cycleDuration"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("维保周期个数：")]),e._v(" "),a("el-input-number",{attrs:{min:0,max:20,"controls-position":"right",placeholder:"请输入"},model:{value:e.form.CycleCount,callback:function(t){e.$set(e.form,"CycleCount",t)},expression:"form.CycleCount"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("检修周期时长：")]),e._v(" "),a("el-input",{attrs:{disabled:"",placeholder:"请输入"},model:{value:e.totalDuration,callback:function(t){e.totalDuration=t},expression:"totalDuration"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",[a("span",[e._v("策略主备分类：")]),e._v(" "),a("el-select",{model:{value:e.form.Type,callback:function(t){e.$set(e.form,"Type",t)},expression:"form.Type"}},e._l(e.dropdown.strategyType,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("label",{attrs:{"label-last":""}},[a("span",[e._v("维保事项：")])])])],1)],1),e._v(" "),a("el-row",{staticClass:"items"},[a("edit-table",{attrs:{table_columns:e.table_columns,dataArray:e.form.StrategyItemList},on:{dataChange:e.tableDataChange}})],1)],1)],1)},staticRenderFns:[]};var y=a("VU/8")(h,g,!1,function(e){a("wvv8")},"data-v-cfd2be16",null);t.default=y.exports},izrR:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n=function(e){return{dropdown:{model:[{value:0,label:"全部"},{value:1,label:"上柴"},{value:2,label:"潍柴"},{value:3,label:"玉柴"},{value:4,label:"孚创柴"}],seriesList:[],strategyType:[{value:1,label:"备用机"},{value:2,label:"主用机"}],strategyState:[{value:0,label:"全部"},{value:2,label:"启用"},{value:1,label:"禁用"}]},table:{columns:[{label:"维保策略名称",prop:"StrategyName",minWidth:"15%"},{label:"发动机品牌",prop:"EngineBrandName",minWidth:"15%"},{label:"发动机系列",prop:"EngineSeriesName",minWidth:"15%"},{label:"策略主备分类",prop:"Type",minWidth:"15%",formatter:function(t,a,n){return t.Type?e.dropdown.strategyType.find(function(e){return e.value==t.Type}).label:""}},{label:"策略主备状态",prop:"IsUsing",minWidth:"15%",formatter:function(e,t,a){return e.IsUsing?"启用":"禁用"}},{label:"最后编辑人",prop:"UpDateUserName",minWidth:"15%"},{label:"最后编辑时间",prop:"UpDateTime",minWidth:"20%",formatter:function(t,a,n){return t.UpDateTime?e.$moment(t.UpDateTime).format("yyyy-MM-DD HH:mm:ss"):""}}],dataSource:[{name:"上柴E系列维保方案",brand:"上柴",model:"E",type:"备用机",state:"启用",lastEditor:"李娜",lastEditorTime:"2022-3-11",rawData:{ID:1,name:"上柴策略A",model:"上柴",series:"E",state:"启用",beatDuration:8,beatTotal:60,periodDuration:"8*60",periodTotal:4,duration:"8*60*4",type:"备用机",items:[{name:"维保事项名字",operatingTime:"120小时",absoluteTime:"5天",lastEditTime:"2022-3-15 11:12:18",username:"张三"}]}}]},editTable:{table_columns:[{prop:"ItemContent",label:"维保事项",width:"100"},{prop:"DefaultHourSetting",label:"运行时间",width:"100"},{prop:"DefaultDaySetting",label:"绝对时间",width:"100"}],dataArray:[]}}}},"uom/":function(e,t){},wvv8:function(e,t){}});
//# sourceMappingURL=30.ce6e9c0265735908a237.js.map