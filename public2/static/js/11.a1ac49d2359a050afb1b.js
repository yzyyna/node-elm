webpackJsonp([11],{abnW:function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=t("Dd8w"),n=t.n(a),l=t("X2Oc"),r={name:"AdvertisementApp",components:{},data:function(){var e=this;return{dialogFormVisible:!1,form:{picType:"",picName:"",picSize:"",picFile:"",website:"",picMemo:""},formCurrentPicUrl:"",formCurrentPicId:"",formLabelWidth:"120px",picLimit:1,picSizeLimit:5242880,picSizeLimitText:"5MB",picProportionLimit:2,picProportionLimitText:"2:1",dialogImageUrl:"",dialogVisiblePic:!1,dataSource:[],dataTotal:0,options:{height:"100%",index:!0,labelIndex:"序号",props:{width:140}},paginationCfg:{currentPage:1,pageSize:10,layout:"total, sizes, prev, pager, next, jumper",pageSizes:[10,20,30,40]},data:[],columns:[{label:"图片名称",prop:"picName",minWidth:"15%"},{label:"图片类型",prop:"picType",minWidth:"15%",formatter:function(e,i,t){return e.picType}},{label:"缩略图",render:function(e,i){var t=i.row.picUrl;return[e("el-image",{attrs:{src:t,previewSrcList:[t]}})]},minWidth:"10%"},{label:"排序",prop:"picIndex",minWidth:"15%",render:function(i,t){return[i("input",{ref:"refInputNumber",class:{"el-input__inner":!0},style:{width:"60%",height:"30px",background:"禁用"!==t.row.picState?"gray":""},attrs:n()({value:t.row.picIndex,type:"number",min:0},t.row,{disabled:"禁用"!==t.row.picState}),on:{change:function(i){var a=new FormData,n=i.target,l=t.row;console.log("change",l),e.picTypeOpt.forEach(function(e){e.label===l.picType&&(l.picType=e.value)}),a.append("OrderBy",n.value),a.append("Type",l.picType),a.append("Title",l.picName),a.append("Describe",l.picMemo),a.append("Website",l.website),e.$api.setting.EditGensetProjectBanner(a,{id:t.row.id}).then(function(i){e.getTableData()})}},key:t.row.id})]}},{label:"URL",prop:"website",minWidth:"15%"},{label:"备注",prop:"picMemo",minWidth:"15%"},{label:"状态",prop:"picState",minWidth:"15%"},{label:"操作人",prop:"operator",minWidth:"15%"},{label:"最后修改时间",prop:"lastEditTime",minWidth:"15%"},{label:"id",prop:"id",minWidth:"15%",isShow:function(e){return!1}}],columnsMapping:{Title:"picName",Type:"picType",OrderBy:"picIndex",FileUrl:"picUrl",Website:"website",Describe:"picMemo",IsPublish:"picState",OperUserName:"operator",OperTime:"lastEditTime",BannerId:"id"},activeName:"Advertisement-app"===this.$route.name?"app":"applet",picType:0,picTypeOpt:[{value:-1,label:"全部"},{value:0,label:"首页轮播图"}],editType:"edit",picEdit:!0}},provide:function(){return{}},computed:{},watch:{activeName:function(e){this.queryTableData(),this.handleChangePage(1)},dialogFormVisible:function(e){if(!e){for(var i in this.form)this.form[i]="";this.$refs.refUploadPics&&this.$refs.refUploadPics.uploadFiles&&(this.$refs.refUploadPics.uploadFiles.length=0),this.handlePicState(),this.getTableData()}},"$route.name":{handler:function(e){this.activeName="Advertisement-app"===e?"app":"applet"}}},methods:{setActionColumn:function(e){return[{label:"禁用",isShow:function(e){return"使用中"===e.picState},method:function(i){e.handleActions(0,i)}},{label:"启用",isShow:function(e){return"禁用"===e.picState},method:function(i){e.handleActions(1,i)}},{label:"编辑",isShow:function(e){return"禁用"===e.picState},method:function(i){e.handleActions(2,i)}},{label:"删除",disabled:function(e){return"使用中"===e.picState},method:function(i){e.handleActions(3,i)}}]},handleActions:function(e,i){var t=this;switch(e){case 0:this.publish(i.id,"禁用");break;case 1:this.publish(i.id,"使用中");break;case 2:for(var a in this.dialogFormVisible=!0,this.editType="edit",this.picEdit=!0,this.formCurrentPicUrl=i.picUrl,this.formCurrentPicId=i.id,this.form)this.form[a]=i[a];break;default:var n=this.$createElement;this.$confirm("删除提示",{title:"删除提示",message:n("div",[n("p","此操作将导致数据无法恢复，请谨慎操作!"),n("p","是否确定删除数据?")]),confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.setting.DeleteGensetProjectBanner({},{id:i.id}).then(function(e){t.$message({type:"success",message:"删除成功!"}),t.getTableData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}},publish:function(e,i){var t=this;this.$confirm("是否确定"+i+"?").then(function(a){t.$api.setting.PublishOrCancelGensetProjectBanner({id:e}).then(function(e){t.$message({type:"success",message:i+"成功!"}),t.getTableData()}).catch(function(){t.$message({type:"info",message:"已取消"})})})},queryTableData:function(){this.getTableData()},handleNewJump:function(e){},handleChangePage:function(e){this.paginationCfg.currentPage=e,this.queryTableData()},handleChangeSize:function(e){this.paginationCfg.currentPage=1,this.paginationCfg.pageSize=e,this.queryTableData()},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisiblePic=!0},handleRemove:function(e){if(e){var i=e.uid,t=this.$refs.refUploadPics.uploadFiles;try{t.forEach(function(e,a){e.uid===i&&t.splice(a,1)}),this.handlePicState()}catch(e){this.$message({type:"error",message:"删除失败！"}),console.error(e)}}else this.formCurrentPicUrl="",this.formCurrentPicId="",this.picEdit=!1},onChangePic:function(e,i){var t=this;Object(l.h)(e.raw,2).then(function(a){var n=!0,l="";a?e.size>t.picSizeLimit&&(n=!1,l="上传图片大小不能超过"+t.picSizeLimitText+"!"):(n=!1,l="上传的图片宽/高比例必须为"+t.picProportionLimitText+"！");n?t.handlePicState():(i.splice(i.indexOf(e),1),t.$message.warning(l))}).catch(function(e){console.error(e)})},handlePicState:function(){var e=this.$refs.refUploadPics,i=!!e.$children&&e.$children.length>1&&e.$children[1];!i||(i.$el.style.display?i.$el.style.display="":i.$el.style.display="none")},dialogFormSubmit:function(){var e=this.$refs.refUploadPics||{uploadFiles:null},i=!!e.uploadFiles&&e.uploadFiles||[];if(i.length>0){var t=[];i.forEach(function(e){t.push(e.raw)}),this.form.picFile=t}this.validateForm()&&("edit"===this.editType?this.editRecord():this.addRecord())},validateForm:function(){var e="",i=this.form;if(i.picType)if(i.picName){if(i.picFile||this.picEdit)return!0;e="请上传图片！"}else e="请填写图片名称！";else e="请选择图片类型！";return this.$message.warning(e),!1},addPicHandler:function(){this.dialogFormVisible=!0,this.editType="add",this.picEdit=!1,this.formCurrentPicUrl="",this.formCurrentPicId=""},getTableData:function(){var e=this,i={Type:this.picType},t={Page:this.paginationCfg.currentPage,PageSize:this.paginationCfg.pageSize},a=this.columnsMapping,n=new Array,r=this.$loading({lock:!0,text:"数据加载中，请稍后...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$api.setting.GetGensetProjectBannerManage(i,t).then(function(i){(!!i.Data&&!!i.Data.Data&&i.Data.Data||[]).forEach(function(i){var t=new Object;for(var r in i)"null"!==i[r]||(i[r]=""),t[a[r]]=i[r];for(var o in t.picUrl=e.handlePicUrl(t.picUrl),t.picState=t.picState?"使用中":"禁用",t.picIndex=t.picIndex.toString(),t.lastEditTime=Object(l.c)(t.lastEditTime).format("yyyy-MM-DD HH:mm:ss"),e.picTypeOpt){var s=e.picTypeOpt[o];s.value===t.picType&&(t.picType=s.label)}i.IsUsing&&n.push(t)}),e.dataSource=n,r.close()}).catch(function(e){r.close()})},addRecord:function(){var e=this,i=this.form,t=new FormData;t.append("Type",this.picType),t.append("Title",i.picName),t.append("Describe",i.picMemo),t.append("Website",i.website),t.append("FileUrl",i.picFile[0]),this.$api.setting.AddGensetProjectBanner(t).then(function(i){e.dialogFormVisible=!1,e.formCurrentPicUrl="",e.formCurrentPicId="",e.picEdit=!1})},editRecord:function(e){var i=this,t=this.form,a=new FormData;a.append("Type",this.picType),a.append("Title",t.picName),a.append("Describe",t.picMemo),a.append("Website",t.website),a.append("FileUrl",t.picFile&&t.picFile.length>0&&t.picFile[0]||""),this.$api.setting.EditGensetProjectBanner(a,{id:this.formCurrentPicId}).then(function(e){i.dialogFormVisible=!1})},handlePicUrl:function(e){return"http://www.fortrustyun.com:8022/"+e}},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){this.queryTableData()},beforeUpdated:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){}},o={render:function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",[t("BMainTopComponent"),e._v(" "),t("div",{attrs:{id:"advertisement-app"}},[t("el-tabs",{model:{value:e.activeName,callback:function(i){e.activeName=i},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"APP",name:"app"}}),e._v(" "),t("el-tab-pane",{attrs:{label:"小程序",name:"applet"}})],1),e._v(" "),t("el-row",{staticClass:"pic-type-select-container",attrs:{type:"flex",align:"middle"}},[t("el-col",{attrs:{span:2}},[t("div",{staticClass:"text"},[e._v("图片类型：")])]),e._v(" "),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"pic-type-select"},[t("el-select",{attrs:{placeholder:"请选择图片类型"},model:{value:e.picType,callback:function(i){e.picType=i},expression:"picType"}},e._l(e.picTypeOpt,function(e,i){return t("el-option",{key:i,attrs:{label:e.label,value:e.value}})}),1)],1)]),e._v(" "),t("el-col",{attrs:{span:17}},[t("el-row",{attrs:{type:"flex",justify:"end",align:"middle"}},[t("div",{staticClass:"add-btn"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addPicHandler}},[e._v("新增图片")])],1)])],1)],1),e._v(" "),t("TableList",{attrs:{options:e.options,columns:e.columns,dataTotal:e.dataTotal,dataSource:e.dataSource,operates:e.setActionColumn(this),pagination:e.paginationCfg},on:{handleChangePage:e.handleChangePage,handleChangeSize:e.handleChangeSize}})],1),e._v(" "),t("el-dialog",{attrs:{title:"edit"===e.editType?"编辑":"新增",width:"30%",visible:e.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(i){e.dialogFormVisible=i}}},[t("el-form",{ref:"refForm",attrs:{model:e.form}},[t("el-form-item",{attrs:{required:"",label:"图片类型","label-width":e.formLabelWidth}},[t("el-select",{style:{width:"100%"},attrs:{placeholder:"请选择图片类型"},model:{value:e.form.picType,callback:function(i){e.$set(e.form,"picType",i)},expression:"form.picType"}},[t("el-option",{attrs:{label:"首页轮播图",value:"1"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{required:"",label:"图片名称","label-width":e.formLabelWidth},model:{value:e.form.picName,callback:function(i){e.$set(e.form,"picName",i)},expression:"form.picName"}},[t("el-input",{model:{value:e.form.picName,callback:function(i){e.$set(e.form,"picName",i)},expression:"form.picName"}})],1),e._v(" "),e.picEdit?t("el-form-item",{attrs:{required:"",label:"上传图片","label-width":e.formLabelWidth}},[t("el-image",{attrs:{fit:"contain",src:e.formCurrentPicUrl,"preview-src-list":[e.formCurrentPicUrl]}}),e._v(" "),t("span",{style:{fontSize:"1.2rem",color:"#eee",position:"absolute",right:"5px",top:"0px",cursor:"pointer"},on:{click:function(i){return e.handleRemove()}}},[t("i",{staticClass:"el-icon-delete"})])],1):t("el-form-item",{attrs:{required:"",label:"上传图片","label-width":e.formLabelWidth}},[t("el-upload",{ref:"refUploadPics",attrs:{action:"#",multiple:!0,limit:e.picLimit,"auto-upload":!1,"list-type":"picture-card","on-change":e.onChangePic,accept:".jpg, .jpeg, .png"},scopedSlots:e._u([{key:"file",fn:function(i){var a=i.file;return t("div",{},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:a.url,alt:""}}),e._v(" "),t("span",{staticClass:"el-upload-list__item-actions"},[t("span",{staticClass:"el-upload-list__item-preview",on:{click:function(i){return e.handlePictureCardPreview(a)}}},[t("i",{staticClass:"el-icon-zoom-in"})]),e._v(" "),t("span",{staticClass:"el-upload-list__item-delete",on:{click:function(i){return e.handleRemove(a)}}},[t("i",{staticClass:"el-icon-delete"})])])])}}])},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),e._v(" "),t("el-form-item",{attrs:{label:" ","label-width":e.formLabelWidth}},[t("div",{style:{color:"red",fontSize:".9rem",fontWeight:"bold"}},[e._v("\n          请上传宽/高比例为2:1且小于5M的图片！\n        ")])]),e._v(" "),t("el-form-item",{attrs:{label:"URL","label-width":e.formLabelWidth}},[t("el-input",{model:{value:e.form.website,callback:function(i){e.$set(e.form,"website",i)},expression:"form.website"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"备注","label-width":e.formLabelWidth}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.picMemo,callback:function(i){e.$set(e.form,"picMemo",i)},expression:"form.picMemo"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(i){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.dialogFormSubmit}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{visible:e.dialogVisiblePic},on:{"update:visible":function(i){e.dialogVisiblePic=i}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var s=t("VU/8")(r,o,!1,function(e){t("jWZV")},"data-v-57c91f31",null);i.default=s.exports},jWZV:function(e,i){}});
//# sourceMappingURL=11.a1ac49d2359a050afb1b.js.map