webpackJsonp([42],{"+JGm":function(e,t){},wP4s:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("Dd8w"),s=o.n(r),n=o("dzIa"),i=o("/eJN"),a=o("oFuF"),c=i.a.ProjectTypeEnum,d={name:"AppRecordForm",components:{ProjectRecordSheet:n.a},data:function(){return{ProjectId:parseInt(this.$route.query.ProjectId),ProjectProgressId:parseInt(this.$route.query.ProjectProgressId),IsGenset:this.$route.query.IsGenset,IsGensetMult:this.$route.query.IsGensetMult,operateType:this.$route.query.OperateType,RecordId:this.$route.query.RecordId,dataList:[],ProjectTypeEnum:c}},computed:{title:function(){var e="";switch(this.operateType){case 1:e="新增";break;case 2:e="查看";break;case 4:e="编辑";break;default:e=""}return(13==this.ProjectProgressId?"客户满意度":"完工报告")+e},isEdit:function(){return 1==this.operateType||4==this.operateType}},mounted:function(){console.log(this.ProjectProgressId,this.RecordId,this.OperateType,this.GensetList,this.ProjectId),this.RecordId?this.getProgressFormData():this.GetProgressStencil()},methods:{GetProgressStencil:function(){var e=this,t={ProgressId:this.ProjectProgressId,ProjectId:this.ProjectId};this.$api.project.GetGensetProjectProgressStencilProject(t).then(function(t){if(1===t.Code){var o=t.Data.ProjectDetail,r=s()({ProjectDetail:s()({},o,{ProjectTypeStr:o.ProjectType?e.ProjectTypeEnum.find(function(e){return e.value==o.ProjectType}).label:"",StartDateStr:e.$moment(o.StartDate).format("YYYY-MM-DD"),EndDateStr:e.$moment(o.EndDate).format("YYYY-MM-DD")})},t.Data.StencilDetail);r.StencilList=_.cloneDeep(r.StencilModel),r.ItemList=_.cloneDeep(r.ItemModel)||[{}],console.log(t,r),r.IsGenset&&(r.GensetList=_.cloneDeep(e.GensetList)),e.$set(e,"dataList",_.cloneDeep(r))}})},getProgressFormData:function(){var e=this,t={RecordId:this.RecordId};this.$api.project.GetGensetProjectProgressRecordDetailWeb({},t).then(function(t){if(1===t.Code){console.log("bianji",t);var o=t.Data;e.$set(o,"GensetList",o.GensetList?o.GensetList.map(function(e){return s()({RecordJoinGensetId:e.RecordJoinGensetId},e.GeneratorSet)}):[]),e.$set(o,"ProjectDetail",s()({},o.ProjectDetail,{ProjectTypeStr:o.ProjectDetail.ProjectType?e.ProjectTypeEnum.find(function(e){return e.value==o.ProjectDetail.ProjectType}).label:"",StartDateStr:e.$moment(o.ProjectDetail.StartDate).format("YYYY-MM-DD"),EndDateStr:e.$moment(o.ProjectDetail.EndDate).format("YYYY-MM-DD")})),e.$nextTick(function(){e.$set(e,"dataList",_.cloneDeep(o))})}})},close:function(){this.$emit("closeDialog")},addSave:function(){var e=this;this.$refs.ProjectRecordSheet.$refs.generateSheet.getData().then(function(t){console.log("formdata-----------",e.dataList,t);var o={ProjectId:e.ProjectId,ProgressId:e.ProjectProgressId,IsGenset:e.dataList.IsGenset,GensetList:e.GensetList?e.GensetList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}):[],FileUrl:"",StencilList:e.dataList.StencilModel?_.cloneDeep(e.dataList.StencilModel):null,ItemList:t.key_table||e.dataList.ItemModel};o.StencilList&&o.StencilList.forEach(function(e){e.KeyValue=t["key_"+e.KeyId]}),t.key_image&&(o.FileUrl=t.key_image.map(function(e){return e.url}).join(";")),console.log("params",o),e.$api.project.AddGensetProjectProgressRecord(o).then(function(t){1===t.Code&&(console.log(t),e.$emit("closeDialog",{refresh:!0}))})})},editSave:function(){var e=this,t={id:this.RecordId};this.$refs.ProjectRecordSheet.$refs.generateSheet.getData().then(function(o){console.log("formdata-----------",e.dataList,o);var r={ProjectId:e.ProjectId,ProgressId:e.ProjectProgressId,IsGenset:e.dataList.IsGenset,IsGensetMult:e.dataList.IsGensetMult,GensetList:e.dataList.GensetList.map(function(e){return{GeneratorSetId:e.GeneratorSetId}}),FileUrl:"",StencilList:e.dataList.StencilList?_.cloneDeep(e.dataList.StencilList):null,ItemList:o.key_table||e.dataList.ItemModel};r.StencilList&&r.StencilList.forEach(function(e){e.KeyValue=o["key_"+e.KeyId]}),o.key_image&&(r.FileUrl=o.key_image.map(function(e){return e.url}).join(";")),console.log("params",r),e.$api.project.EditGensetProjectProgressRecord(r,t).then(function(t){1===t.Code&&(console.log(t),e.$emit("closeDialog",{refresh:!0}))})})},handleCancelClick:function(){this.close()},downloadTemplate:function(){},uploadFile:function(){},handleBackList:function(){this.close()},downloadFile:function(){Object(a.c)({title:"页面导出PDF文件名",contentId:"#ProjectRecordSheet"})}}},l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"dialog-content"},[o("ProjectRecordSheet",{ref:"ProjectRecordSheet",attrs:{id:"ProjectRecordSheet",edit:e.isEdit},model:{value:e.dataList,callback:function(t){e.dataList=t},expression:"dataList"}})],1)},staticRenderFns:[]};var u=o("VU/8")(d,l,!1,function(e){o("+JGm")},"data-v-ec3a543c",null);t.default=u.exports}});
//# sourceMappingURL=42.ccbd5f0606d5cbb4feaf.js.map